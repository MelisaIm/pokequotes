// 2368191
;

/* bq/visible/jquery.almostVisible */
(function($){$.fn.almostVisible=function(aboveBuffer,belowBuffer){if(this.length<1)return;var $t=this.length>1?this.eq(0):this,t=$t.get(0),wHeight=$(window).outerHeight();var almostVisible=false;if($t.is(":visible")){var rec=t.getBoundingClientRect();var tViz=rec.top>=-aboveBuffer&&rec.top<wHeight+aboveBuffer;var bViz=rec.bottom>-belowBuffer&&rec.bottom<=wHeight+belowBuffer;almostVisible=tViz||bViz}return almostVisible}})(jQuery);
;

/* bq/visible/AlmostVisibleMonitor */
var AlmostVisibleMonitor={handlerOn:false,floatId:0,watchByEl:{},notifyWhenVisible:function(elementId,pxAbove,pxBelow,handler){$(function(){if($("#"+elementId).length==0)throw"Could not find element with ID\x3d"+elementId;if(!AlmostVisibleMonitor.handlerOn)AlmostVisibleMonitor._createHandler();var replaced=false;AlmostVisibleMonitor.watchByEl[elementId]={cb:handler,elId:elementId,pxAbove:pxAbove,pxBelow:pxBelow};AlmostVisibleMonitor._checkVis("init")})},_checkVis:function(reason){var keepWatches=
[];for(var elementId in AlmostVisibleMonitor.watchByEl){var data=AlmostVisibleMonitor.watchByEl[elementId];var elToCheck=$("#"+data.elId);if(elToCheck.almostVisible(data.pxAbove,data.pxBelow)){delete AlmostVisibleMonitor.watchByEl[elementId];try{data.cb(data.elId)}catch(err){BQErrorLog.logError("AVM cb error "+data.elId+" elId\x3d"+elementId,err)}}}},_handleScroll:function(){AlmostVisibleMonitor._checkVis("scroll")},_handleResize:function(){AlmostVisibleMonitor._checkVis("resize")},_createHandler:function(){$(window).scroll(AlmostVisibleMonitor._handleScroll);
$(window).resize(AlmostVisibleMonitor._handleResize);AlmostVisibleMonitor.handlerOn=true},_removeHandler:function(){$(window).unbind("scroll",AlmostVisibleMonitor._handleScroll);$(window).unbind("resize",AlmostVisibleMonitor._handleResize);AlmostVisibleMonitor.handlerOn=false}};
;

/* /js/jquery_plugins/jquery.sticky */
(function($){var defaults={topSpacing:0,bottomSpacing:0,className:"is-sticky",wrapperClassName:"sticky-wrapper",center:false,getWidthFrom:""},$window=$(window),$document=$(document),sticked=[],windowHeight=$window.height(),scroller=function(){var scrollTop=$window.scrollTop(),documentHeight=$document.height(),dwh=documentHeight-windowHeight,extra=scrollTop>dwh?dwh-scrollTop:0;for(var i=0;i<sticked.length;i++){var s=sticked[i],elementTop=s.stickyWrapper.offset().top,etse=elementTop-s.topSpacing-extra;
if(scrollTop<=etse){if(s.currentTop!==null){s.stickyElement.css("position","").css("top","");s.stickyElement.parent().removeClass(s.className);s.currentTop=null;if(typeof bqStickyCallback=="function")bqStickyCallback.call(this,{show:1})}}else{var newTop=documentHeight-s.stickyElement.outerHeight()-s.topSpacing-s.bottomSpacing-scrollTop-extra;if(newTop<0)newTop=newTop+s.topSpacing;else newTop=s.topSpacing;if(s.currentTop!=newTop){s.stickyElement.css("position","fixed").css("top",newTop);if(typeof s.getWidthFrom!==
"undefined")s.stickyElement.css("width",$(s.getWidthFrom).width());s.stickyElement.parent().addClass(s.className);s.currentTop=newTop;if(typeof bqStickyCallback=="function")bqStickyCallback.call(this,{show:0})}}}},resizer=function(){windowHeight=$window.height()},methods={init:function(options){var o=$.extend(defaults,options);return this.each(function(){var stickyElement=$(this);stickyId=stickyElement.attr("id");wrapper=$("\x3cdiv\x3e\x3c/div\x3e").attr("id",stickyId+"-sticky-wrapper").addClass(o.wrapperClassName);
stickyElement.wrapAll(wrapper);if(o.center)stickyElement.parent().css({width:stickyElement.outerWidth(),marginLeft:"auto",marginRight:"auto"});if(stickyElement.css("float")=="right")stickyElement.css({"float":"none"}).parent().css({"float":"right"});var stickyWrapper=stickyElement.parent();var h2=40;stickyWrapper.css("height",h2);sticked.push({topSpacing:o.topSpacing,bottomSpacing:o.bottomSpacing,stickyElement:stickyElement,currentTop:null,stickyWrapper:stickyWrapper,className:o.className,getWidthFrom:o.getWidthFrom})})},
update:scroller};if(window.addEventListener){window.addEventListener("scroll",scroller,false);window.addEventListener("resize",resizer,false)}else if(window.attachEvent){window.attachEvent("onscroll",scroller);window.attachEvent("onresize",resizer)}$.fn.sticky=function(method){if(methods[method])return methods[method].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof method==="object"||!method)return methods.init.apply(this,arguments);else $.error("Method "+method+" does not exist on jQuery.sticky")};
$(function(){setTimeout(scroller,0)})})(jQuery);
;

/* /js/bootstrap3/bootstrap-transition */
if(typeof jQuery==="undefined")throw new Error("Bootstrap's JavaScript requires jQuery");+function($){var version=$.fn.jquery.split(" ")[0].split(".");if(version[0]<2&&version[1]<9||version[0]==1&&version[1]==9&&version[2]<1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher");}(jQuery);
+function($){function transitionEnd(){var el=document.createElement("bootstrap");var transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var name in transEndEventNames)if(el.style[name]!==undefined)return{end:transEndEventNames[name]};return false}$.fn.emulateTransitionEnd=function(duration){var called=false;var $el=this;$(this).one("bsTransitionEnd",function(){called=true});var callback=
function(){if(!called)$($el).trigger($.support.transition.end)};setTimeout(callback,duration);return this};$(function(){$.support.transition=transitionEnd();if(!$.support.transition)return;$.event.special.bsTransitionEnd={bindType:$.support.transition.end,delegateType:$.support.transition.end,handle:function(e){if($(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}}})}(jQuery);
;

/* /js/bootstrap3/bootstrap-dropdown */
if(typeof jQuery==="undefined")throw new Error("Bootstrap's JavaScript requires jQuery");+function($){var version=$.fn.jquery.split(" ")[0].split(".");if(version[0]<2&&version[1]<9||version[0]==1&&version[1]==9&&version[2]<1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher");}(jQuery);
+function($){var backdrop=".dropdown-backdrop";var toggle='[data-toggle\x3d"dropdown"]';var Dropdown=function(element){$(element).on("click.bs.dropdown",this.toggle)};Dropdown.VERSION="3.3.4";Dropdown.prototype.toggle=function(e){var $this=$(this);if($this.is(".disabled, :disabled"))return;var $parent=getParent($this);var isActive=$parent.hasClass("open");clearMenus();if(!isActive){if("ontouchstart"in document.documentElement&&!$parent.closest(".navbar-nav").length)$('\x3cdiv class\x3d"dropdown-backdrop"/\x3e').insertAfter($(this)).on("click",
clearMenus);var relatedTarget={relatedTarget:this};$parent.trigger(e=$.Event("show.bs.dropdown",relatedTarget));if(e.isDefaultPrevented())return;$this.trigger("focus").attr("aria-expanded","true");$parent.toggleClass("open").trigger("shown.bs.dropdown",relatedTarget)}return false};Dropdown.prototype.keydown=function(e){if(!/(38|40|27|32)/.test(e.which)||/input|textarea/i.test(e.target.tagName))return;var $this=$(this);e.preventDefault();e.stopPropagation();if($this.is(".disabled, :disabled"))return;
var $parent=getParent($this);var isActive=$parent.hasClass("open");if(!isActive&&e.which!=27||isActive&&e.which==27){if(e.which==27)$parent.find(toggle).trigger("focus");return $this.trigger("click")}var desc=" li:not(.disabled):visible a";var $items=$parent.find('[role\x3d"menu"]'+desc+', [role\x3d"listbox"]'+desc);if(!$items.length)return;var index=$items.index(e.target);if(e.which==38&&index>0)index--;if(e.which==40&&index<$items.length-1)index++;if(!~index)index=0;$items.eq(index).trigger("focus")};
function clearMenus(e){if(e&&e.which===3)return;$(backdrop).remove();$(toggle).each(function(){var $this=$(this);var $parent=getParent($this);var relatedTarget={relatedTarget:this};if(!$parent.hasClass("open"))return;$parent.trigger(e=$.Event("hide.bs.dropdown",relatedTarget));if(e.isDefaultPrevented())return;$this.attr("aria-expanded","false");$parent.removeClass("open").trigger("hidden.bs.dropdown",relatedTarget)})}function getParent($this){var selector=$this.attr("data-target");if(!selector){selector=
$this.attr("href");selector=selector&&/#[A-Za-z]/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,"")}var $parent=selector&&$(selector);return $parent&&$parent.length?$parent:$this.parent()}function Plugin(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.dropdown");if(!data)$this.data("bs.dropdown",data=new Dropdown(this));if(typeof option=="string")data[option].call($this)})}var old=$.fn.dropdown;$.fn.dropdown=Plugin;$.fn.dropdown.Constructor=Dropdown;$.fn.dropdown.noConflict=
function(){$.fn.dropdown=old;return this};$(document).on("click.bs.dropdown.data-api",clearMenus).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",toggle,Dropdown.prototype.toggle).on("keydown.bs.dropdown.data-api",toggle,Dropdown.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role\x3d"menu"]',Dropdown.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role\x3d"listbox"]',Dropdown.prototype.keydown)}(jQuery);
;

/* /js/konsole */
var konsole={log:function(args){},dir:function(args){}};if(typeof window.console!="undefined"&&typeof window.console.log=="function")konsole=window.console;
;

/* /js/bq/BQNewMsnry */
var BQNewMsnry={reportOn:true,haveGrid:false,mGridBySel:{},create:function(selector){$(function(){BQNewMsnry.mGridBySel[selector]=$(selector).masonry({transitionDuration:0,originTop:true});BQNewMsnry.haveGrid=true})},gridFor:function(selector){if(BQNewMsnry.haveGrid!=false){var g=BQNewMsnry.mGridBySel[selector];if(typeof g!==undefined)return g}return null},appended:function(selector,elements){var g=BQNewMsnry.gridFor(selector);if(g!=null){$(selector).append(elements);g.masonry("appended",elements)}else throw"No grid: "+
selector;},prepended:function(selector,elements){var g=BQNewMsnry.gridFor(selector);if(g!=null){$(selector).prepend(elements);g.masonry("prepended",elements)}else throw"No grid: "+selector;},on:function(selector,event,callback){var g=BQNewMsnry.gridFor(selector);if(g!=null)g.on(event,callback)},one:function(selector,event,callback){var g=BQNewMsnry.gridFor(selector);if(g!=null)g.one(event,callback)},off:function(selector,event,callback){var g=BQNewMsnry.gridFor(selector);if(g!=null)g.off(event,callback)},
reloadItems:function(selector){var g=BQNewMsnry.gridFor(selector);if(g!=null)g.masonry("reloadItems")},layout:function(selector){var g=BQNewMsnry.gridFor(selector);if(g!=null)g.masonry("layout")}};
;

/* /js/bq/CookieUtil */
var CookieUtil={defaultValues:{"vm":"g"},createCookieWithMinExpiry:function(name,value,min){var expires;if(min){var date=new Date;date.setTime(date.getTime()+min*60*1E3);expires="; expires\x3d"+date.toGMTString()}else expires="";document.cookie=name+"\x3d"+value+expires+"; path\x3d/"},createCookie:function(name,value,days){var expMin=days*24*60;CookieUtil.createCookieWithMinExpiry(name,value,expMin)},readCookie:function(name){var nameEQ=name+"\x3d";var ca=document.cookie.split(";");for(var i=0;i<
ca.length;i++){var c=ca[i];while(c.charAt(0)===" ")c=c.substring(1,c.length);if(c.indexOf(nameEQ)===0)return c.substring(nameEQ.length,c.length)}return null},eraseCookie:function(name){CookieUtil.createCookie(name,"",-1)},erasePreferencesCookie:function(){CookieUtil.eraseCookie("brainyPrefs")},incrementPageDepth:function(){var depth=CookieUtil.getPageDepth()+1;if(depth>20)depth=20;CookieUtil.createCookie("bqPvd",depth,.05);return depth},getPageDepth:function(){var depth=0;var pvd=CookieUtil.readCookie("bqPvd");
if(pvd)depth=Number(pvd);return depth},setBdrDrp:function(bname){CookieUtil.createCookie("bqBdrp",bname,.1)},getBdrDrp:function(){return CookieUtil.readCookie("bqBdrp")},setRndGroup:function(rndGrp){CookieUtil.createCookie("bqRnd",rndGrp,.1)},getRndGroup:function(){var rndGrp=0;var rndGrpStr=CookieUtil.readCookie("bqRnd");if(rndGrpStr)rndGrp=Number(rndGrpStr);else rndGrp=getRandomInt(1,100);CookieUtil.setRndGroup(rndGrp);return rndGrp},setLastScore:function(score){CookieUtil.setPreference("lastsc",
score.toString())},getLastScore:function(){var prefs=CookieUtil.getPreferences();var lastScore=undefined;if("lastsc"in prefs)lastScore=prefs.lastsc;return lastScore},getPreferences:function(){var prefs={};var value=CookieUtil.readCookie("brainyPrefs");if(value){var parts=value.split("_");for(var i=0;i<parts.length;i++){var part=parts[i];if(part!=="bqHasPrefs"){var nameValue=part.split("~");prefs[nameValue[0]]=nameValue[1]}}}return prefs},isLI:function(){return CookieUtil.hasCookie("bq_lim")},hasLI:function(){return CookieUtil.hasCookie("bq_hli")},
hasCookie:function(cookieName){var bq_lim=CookieUtil.readCookie(cookieName);if(typeof bq_lim!=="undefined")return bq_lim!==null;else return false},getDisplayName:function(){var bq_lim=CookieUtil.readCookie("bq_lim");return bq_lim||""},getPreference:function(name){var prefs=CookieUtil.getPreferences();return prefs[name]},setPreference:function(name,value){var prefs=CookieUtil.getPreferences();prefs[name]=value;if(CookieUtil.defaultValues[name]===value||value==="")delete prefs[name];CookieUtil.savePreferencesToCookie(prefs)},
savePreferencesToCookie:function(prefs){var cookieValue="bqHasPrefs";for(var key in prefs)if(prefs.hasOwnProperty(key))cookieValue=cookieValue+"_"+key+"~"+prefs[key];if(cookieValue==="bqHasPrefs")CookieUtil.eraseCookie("brainyPrefs");else CookieUtil.createCookie("brainyPrefs",cookieValue,365)}};
;

/* /js/bq/BQSubnavMenu */
var BQSubnavMenu={init:function(){if(!IS_MBL)$(function(){try{var $window=$(window),$stickyMenuBar=$("#secondaryStickyNav"),$stickyMenuBarAnchor=$("#secondaryStickyNavAnchor");$window.scroll(function(){var window_top=$window.scrollTop();var div_top=$stickyMenuBarAnchor.offset().top-40;if(window_top>div_top){$stickyMenuBar.addClass("stick");$stickyMenuBarAnchor.height($stickyMenuBar.height())}else{$stickyMenuBar.removeClass("stick");$stickyMenuBarAnchor.height(0)}})}catch(err){BQErrorLog.logError("Submenu init",
err)}})}};
;

/* /js/bq/BQErrorLog */
var BQErrorLog={reportOn:true,isBadBro:false,shouldSendReport:function(){return BQErrorLog.reportOn&&!(BQErrorLog.isBot()||BQErrorLog.isBadBro)},logErrorDetail:function(title,detail){if(this.shouldSendReport())BQErrorLog._rpt("error",title,detail)},logError:function(message,exception){if(typeof exception!=="undefined")konsole.log("[ERROR] ",message,exception.toString());else konsole.log("[ERROR] ",message);if(this.shouldSendReport())if(exception!==null&&typeof exception!=="undefined"){var stkTrace=
printStackTrace({e:exception});BQErrorLog._rpt("error",message,exception.toString(),stkTrace)}else BQErrorLog._rpt("error",message,"")},logWarn:function(message,exception){if(typeof exception!=="undefined")konsole.log("[WARN] ",message,exception.toString());else konsole.log("[WARN] ",message);if(this.shouldSendReport())if(exception!==null&&typeof exception!=="undefined"){var stkTrace=printStackTrace({e:exception});BQErrorLog._rpt("warn",message,exception.toString(),stkTrace)}else BQErrorLog._rpt("warn",
message,"")},setupForBrowser:function(uaStr){if(uaStr=="unsupported")BQErrorLog.isBadBro=true},isBot:function(){var botPattern="(googlebot/|Googlebot-Mobile|Googlebot-Image|Google favicon|Mediapartners-Google|bingbot|slurp|java|wget|curl|Commons-HttpClient|Python-urllib|libwww|httpunit|nutch|phpcrawl|msnbot|jyxobot|FAST-WebCrawler|FAST Enterprise Crawler|biglotron|teoma|convera|seekbot|gigablast|exabot|ngbot|ia_archiver|GingerCrawler|webmon |httrack|webcrawler|grub.org|UsineNouvelleCrawler|antibot|netresearchserver|speedy|fluffy|bibnum.bnf|findlink|msrbot|panscient|yacybot|AISearchBot|IOI|ips-agent|tagoobot|MJ12bot|dotbot|woriobot|yanga|buzzbot|mlbot|yandexbot|purebot|Linguee Bot|Voyager|CyberPatrol|voilabot|baiduspider|citeseerxbot|spbot|twengabot|postrank|turnitinbot|scribdbot|page2rss|sitebot|linkdex|Adidxbot|blekkobot|ezooms|dotbot|Mail.RU_Bot|discobot|heritrix|findthatfile|europarchive.org|NerdByNature.Bot|sistrix crawler|ahrefsbot|Aboundex|domaincrawler|wbsearchbot|summify|ccbot|edisterbot|seznambot|ec2linkfinder|gslfbot|aihitbot|intelium_bot|facebookexternalhit|yeti|RetrevoPageAnalyzer|lb-spider|sogou|lssbot|careerbot|wotbox|wocbot|ichiro|DuckDuckBot|lssrocketcrawler|drupact|webcompanycrawler|acoonbot|openindexspider|gnam gnam spider|web-archive-net.com.bot|backlinkcrawler|coccoc|integromedb|content crawler spider|toplistbot|seokicks-robot|it2media-domain-crawler|ip-web-crawler.com|siteexplorer.info|elisabot|proximic|changedetection|blexbot|arabot|WeSEE:Search|niki-bot|CrystalSemanticsBot|rogerbot|360Spider|psbot|InterfaxScanBot|Lipperhey SEO Service|CC Metadata Scaper|g00g1e.net|GrapeshotCrawler|urlappendbot|brainobot|fr-crawler|binlar|SimpleCrawler|Livelapbot|Twitterbot|cXensebot|smtbot|bnf.fr_bot|A6-Indexer|ADmantX|Facebot|Twitterbot|OrangeBot|memorybot|AdvBot|MegaIndex|SemanticScholarBot|ltx71|nerdybot|xovibot|BUbiNG|Qwantify|archive.org_bot|Applebot|TweetmemeBot|crawler4j|findxbot|SemrushBot|yoozBot|lipperhey|y!j-asr|Domain Re-Animator Bot|AddThis)";
var re=new RegExp(botPattern,"i");return re.test(navigator.userAgent)},_rpt:function(logLevel,message,detail,stkTrace){if(angular.isDefined(stkTrace))konsole.log("[ERROR] ",detail," Stack trace:\n",stkTrace.join("\n"));else{konsole.log("[ERROR] message\x3d",message," dt\x3d",detail);stkTrace=null}if(typeof JsLOG===undefined)JsLOG=["JsLOG was undefined"];JsLOG.push("[ERROR] "+message+" happened");konsole.log("....Waiting to send error report");setTimeout(function(){konsole.log("....Sending error report");
var revEn;if(typeof REV==="undefined")revEn=true;else revEn=REV;$.ajax({type:"POST",url:"/error/jsError",contentType:"application/json",context:this,dataType:"json",data:JSON.stringify({level:logLevel,user_agent:navigator.userAgent,js_svr_id:document.jsErrSrc,message:document.jsErrVer+" "+message,rev:revEn,lg:JsLOG,on_url:window.location.href,d_name:CookieUtil.getDisplayName(),detail:detail,stk_trace:stkTrace}),error:function(req,textStatus,errorThrown){konsole.log("[ERROR] BQErrorLog AJAX error:",
textStatus,errorThrown)}})},2500)}};
;

/* /js/bq/BQPredFactory */
var BQPredFactory=function(bqAdConfig,unitLookupIn,lookupTableIn,score,smth,cdIn,sdIn){this.bqAdConfig=bqAdConfig;this.unitLookup=unitLookupIn;this.lookupTable=lookupTableIn;this.smth=smth;this.clientData=cdIn;this.serverData=sdIn;this.updateForAuctionData(1,score)};
BQPredFactory.prototype={allData:undefined,predData:undefined,baselineData:undefined,clientData:undefined,scoreData:undefined,serverData:undefined,auctionData:undefined,log:function(msg){var self=this;if(self.bqAdConfig.get("logOn")){var newArgs=["[ BQPredFactory - auction "+self.slotidx+" ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},minFloorCents:function(disc){var self=this;var flrD=self.minFloor(disc)/100;return(Math.round(flrD*
1E3)/1E3).toFixed(3)},minFloor:function(disc){var self=this;var hflrCents=self.bqAdConfig.getHardFlr();self.log("hflr",hflrCents);var minFlr;if(disc>0){var hflrCentsCeil=Math.ceil(hflrCents/10)*10;hflrCentsCeil=hflrCentsCeil+1;minFlr=hflrCentsCeil/(1-disc)}else minFlr=Math.ceil(hflrCents/10)*10;self.log("minFlr",minFlr);return minFlr},_generatePred:function(){this.allData=this.calculatePred();this.predData=this.allData.preds;this.baselineData=this.allData.baseline},updateForAuctionData:function(auctionNum,
score){var self=this;this.slotidx=auctionNum;this.auctionData={"bq_slotidx":this.slotidx};if(typeof score!=="undefined")this.scoreData={"bq_lastsc":score};self.log("this.auctionData",this.auctionData);self.log("this.scoreData",this.scoreData);this._generatePred()},getPredData:function(){return this.allData},smoothTo1:function(val,smoothF){return smoothF+(1-smoothF)*val},smoothing:function(bqVar){var rv=this.smth["default"]/10;if(bqVar in this.smth)rv=this.smth[bqVar]/10;return rv},calcPlPred:function(bqUnit,
bqVarM,bVal){var self=this;var slLu=this.lookupTable[bqUnit];var retV=bVal;if(slLu)for(var bqVar in bqVarM){var smoothF=this.smoothing(bqVar);if(slLu[bqVar]){var rtio=slLu[bqVar][bqVarM[bqVar]];self.log("calcPlPred rtio for var "+bqVar+" value "+bqVarM[bqVar],rtio);if(rtio>.01){var smoothed=this.smoothTo1(rtio,smoothF);retV*=smoothed}}}return retV},calculatePred:function(){var self=this;var allD={};var b={};var d={};for(var unitName in this.unitLookup)if(this.unitLookup.hasOwnProperty(unitName)){var adUnitCpmPre=
0;if(this.serverData){self.log("serverData",this.serverData);adUnitCpmPre=this.serverData[unitName]}self.log("unitName",unitName);self.log("unitLookup",this.unitLookup);var unitDiv=this.unitLookup[unitName];self.log("baseline",adUnitCpmPre);var currentRatio=1;currentRatio=this.calcPlPred(unitName,this.clientData,currentRatio);self.log("after client ratio",currentRatio);currentRatio=this.calcPlPred(unitName,this.auctionData,currentRatio);self.log("after slotidx ratio",currentRatio);self.log("adUnitCpmPre",
adUnitCpmPre);b[unitDiv]=currentRatio*adUnitCpmPre;self.log("baseline pred",b[unitDiv]);if(this.scoreData){d[unitDiv]=this.calcPlPred(unitName,this.scoreData,b[unitDiv]);self.log("after last score pred "+unitDiv,d[unitDiv])}else d[unitDiv]=b[unitDiv]}allD.baseline=b;allD.preds=d;return allD},getPred:function(cbIn){cbIn(this.predData)}};
;

/* /js/bq/BQCountryLookup */
var BQCountryLookup={getCountry:function(mbl,callback){var prefs=CookieUtil.getPreferences();var cc;if("cc"in prefs){cc=prefs.cc;callback(cc)}else{konsole.log("cc:lookup");$.ajax({type:"GET",url:"/iso_cc",dataType:"text",context:this,success:function(data,textStatus,req){var cc=data;if(cc!==null&&cc!==undefined){CookieUtil.setPreference("cc",cc);callback(cc)}else{konsole.log("cc:not found");callback(null)}},error:function(req,textStatus,errorThrown){callback(null);var msg="BQCountryLookup:"+textStatus;
if(req){if(req.readyState)msg=msg+" readyState: "+req.readyState;if(req.status)msg=msg+" status: "+req.status;if(req.statusText)msg=msg+" statusText: "+req.statusText}BQErrorLog.logError(msg,errorThrown);konsole.log("[ERROR] BQCountryLookup AJAX error:",req,textStatus,errorThrown)}})}}};
;

/* /js/bq/BQRedirectToHTTPS */
var BQRedirectToHTTPS={init:function(){try{if("https:"!==document.location.protocol){var actionPending=CookieUtil.readCookie("bq_act_pend");if(CookieUtil.isLI()&&(actionPending===null||typeof actionPending==="undefined")){var newUrl="https:"+window.location.href.substring(window.location.protocol.length,window.location.href.length);window.location.href=newUrl}}}catch(err){BQErrorLog.logError("BQRedirectToHTTPS",err)}}};
;

/* /js/bq/BQSimpleInit */
var BQSimpleInit=function(ism){this.isMbl=ism;try{this.init()}catch(err){BQErrorLog.logError("BQSimpleInit: ",err)}};BQSimpleInit.prototype.init=function(){$(function(){try{$("#bq-tn-id").sticky({topSpacing:0,zIndex:1002,brainyQuoteUse100percentWidth:true})}catch(err){konsole.log("WARN: snav init failed!")}});CookieUtil.incrementPageDepth()};
;

/* /js/bq/BQWait */
var BQWait=function(delay,max,condCB,successCB,failCB){this.delay=delay;this.max=max;this.conditionCB=condCB;this.sCB=successCB;this.fCB=failCB;this.sts=Date.now();this._check()};BQWait.prototype={_check:function(){var self=this;if(this.conditionCB())this.sCB();else if(Date.now()-this.sts<=this.max)setTimeout(function(){self._check()},this.delay);else self.fCB()}};
;

/* /js/bq/ga/BQGATimings */
var BQGATimings=function(timingRate){this.bqTimingRate=timingRate;this.gaReady=false};
BQGATimings.prototype={gaRef:null,pf:null,tmQueue:[],pfStarted:function(headLoadedIn,pfStart,pfObj){var self=this;self.headLoaded=headLoadedIn;self.gaRef=pfStart;self.pf=pfObj;self.pfGaKey="pubfood_main";self.record()},gaLoaded:function(){var self=this;self.gaReady=true},record:function(){var self=this;try{if(self.pf)if(Math.random()*100<self.bqTimingRate){self._logStart();self.pf.observe(function(ev){self._handlePfEvent(ev)})}}catch(err){BQErrorLog.logError("recordGATimings",err)}},_logStart:function(){var self=
this;try{var startDelay=self.gaRef-self.headLoaded;var timingSt={hitType:"timing",timingCategory:self.pfGaKey,timingVar:"STARTED",timingValue:startDelay,timingLabel:"DELAY"};self.tmQueue.push(timingSt)}catch(err){BQErrorLog.logError("logStart",err)}},_processQueue:function(){var self=this;if(self.gaReady){var queue=self.tmQueue;self.tmQueue=[];for(var i=0;i<queue.length;i++){var tmD=queue[i];gaTime(tmD)}}},_handlePfEvent:function(ev){var self=this;var timingLabel;var timingDt;try{var elapsed=ev.ts-
self.gaRef;if(ev.type.match(/COMPLETE$/)){var timingVar=ev.type;var timeout=false;if(ev.annotations.forcedDone&&ev.annotations.forcedDone.type=="timeout")timeout=true;if(ev.type.match(/BID_COMPLETE$/)){timingLabel=ev.data;if(timeout)timingVar="BID_TIMEOUT"}else{timingLabel="Google";if(timeout)timingVar="AUCTION_TIMEOUT"}timingDt={hitType:"timing",timingCategory:self.pfGaKey,timingVar:timingVar,timingValue:elapsed,timingLabel:timingLabel};self.tmQueue.push(timingDt)}else if(ev.type.match(/BID_PUSH/)){timingLabel=
ev.data.provider;timingDt={hitType:"timing",timingCategory:self.pfGaKey,timingVar:ev.type,timingValue:elapsed,timingLabel:timingLabel};self.tmQueue.push(timingDt)}else if(ev.type=="PUBFOOD_API_REFRESH"){self.gaRef=ev.ts;self.pfGaKey="pubfood_refresh"}if(ev.type=="AUCTION_COMPLETE")self._processQueue()}catch(err){BQErrorLog.logError("bq_ga_event:observe ",err)}}};
;

/* /js/bq/ga/BQGAMgr */
var BQGAMgr=function(lang){var ga_es="UA-6252296-14";var ga_fr="UA-6252296-17";var ga_en="UA-6252296-1";if(lang=="es")this.bqId=ga_es;else if(lang=="fr")this.bqId=ga_fr;else this.bqId=ga_en};
BQGAMgr.prototype={initGA:function(visitType,ab,secureSeg,bqBdrp,bqContSeq,rev,isMbl){var self=this;ga("create",self.bqId,"auto");ga("set","dimension1",visitType);if(ab)ga("set","dimension2",ab);ga("set","dimension3",secureSeg);if(bqBdrp)ga("set","dimension4",bqBdrp);ga("set","dimension5",bqContSeq);if(rev)ga("set","dimension6","n");else ga("set","dimension6","y");if(isMbl)ga("set","dimension7","y");else ga("set","dimension7","n");ga("send","pageview")},sendInfScrollPageview:function(){ga("send",
"pageview")}};
;

/* /js/bq/ga/bq_ga_event */
function removeDotHtml(str){if(str==null||str==="undefined")return str;var index=str.indexOf(".html");if(index!=-1)str=str.substring(0,index);return str}function gaEvt(cat,act,l,v){if(BQ_ABClicks)ga("send","event",cat,act,l,v,{"nonInteraction":1})}function gaTime(timingData){ga("send",timingData)}function authorCl(a,i,pos){var cat="Popular Authors";var act="Author "+pos+" Click";gaEvt(cat,act,a,i)}
function relatedCl(t,i,pos){var cat="Related Topics";var act="Topic "+pos+" Click";gaEvt(cat,act,removeDotHtml(t),i)}function topicCl(t,i,pos){var cat="Popular Topics";var act="Topic "+pos+" Click";gaEvt(cat,act,removeDotHtml(t),i)}function _qAct(act,type,item,q,pgNum){var cat=act+" click on "+type;var actP=act+" click on "+item;gaEvt(cat,actP,q,pgNum)}function qCl(type,item,q,pgNum){_qAct("Quote",type,removeDotHtml(item),removeDotHtml(q),pgNum)}
function hCl(item,q,bool){_qAct("Heart","Quote",removeDotHtml(item),q,bool)}function pCl(item,q,bool){_qAct("Plus","Quote",removeDotHtml(item),q,bool)}function kCl(quri,key,keypos,det){var cat="Keyword click on quote";if(det)cat=cat+" detail";var act="Keyword click on "+removeDotHtml(quri);gaEvt(cat,act,removeDotHtml(key),keypos)}function aCl(type,item,q,pgNum){var cat="Author click on "+type;var act="Author click on "+item;gaEvt(cat,act,q,pgNum)}
function ssCl(type,item,ss,pgNum){var cat="Slideshow click on "+type;var act="Slideshow click on "+removeDotHtml(item);gaEvt(cat,act,ss,pgNum)}function ssNav(item,slide){var cat="Slideshow page change";var act="Slideshow page change";gaEvt(cat,act,item,slide)};
;

/* /js/bq/BQCookieNotice */
var cookie_msg_options={"message":"By using our site, you agree to our use of cookies.","dismiss":"Agree","learnMore":"More Info","container":".bq-cookie-notice","link":"//www.brainyquote.com/about/privacy","theme":"light-bottom"};var cookie_msg_theme_mbl="dark-inline";
var cookie_msg_markup_mbl=['\x3cdiv class\x3d"cc_banner-wrapper {{containerClasses}}" style\x3d"margin-right: -8px;; margin-left: -8px; "\x3e','\x3cdiv class\x3d"cc_banner cc_container cc_container--open"\x3e','\x3ca href\x3d"#null" data-cc-event\x3d"click:dismiss" target\x3d"_blank" class\x3d"cc_btn cc_btn_accept_all"\x3e{{options.dismiss}}\x3c/a\x3e','\x3cp class\x3d"cc_message"\x3e{{options.message}} \x3ca data-cc-if\x3d"options.link" class\x3d"cc_more_info" href\x3d"{{options.link || "#null"}}"\x3e{{options.learnMore}}\x3c/a\x3e\x3c/p\x3e',
"\x3c/div\x3e\x3c/div\x3e"];
var BQCookieNotice={init:function(mbl,cc){BQCookieNotice.mbl=mbl;BQCookieNotice.cc=cc;$(document).ready(function(){BQCookieNotice._verify(BQCookieNotice.cc)})},_verify:function(cc){try{if(BQCookieNotice._isEU(cc)){if(BQCookieNotice.mbl===1){cookie_msg_options.theme=cookie_msg_theme_mbl;cookie_msg_options.markup=cookie_msg_markup_mbl}BQCookieNotice._cookieNotice()}}catch(err){BQErrorLog.logError("BQCookieNotice failure",err)}},_isEU:function(cc){var euLU={"AL":null,"AD":null,"AM":null,"AT":null,"BY":null,
"BE":null,"BA":null,"BG":null,"CH":null,"CY":null,"CZ":null,"DE":null,"DK":null,"EE":null,"ES":null,"FO":null,"FI":null,"FR":null,"GB":null,"GE":null,"GI":null,"GR":null,"HU":null,"HR":null,"IE":null,"IS":null,"IT":null,"LT":null,"LU":null,"LV":null,"MC":null,"MK":null,"MT":null,"NO":null,"NL":null,"PL":null,"PT":null,"RO":null,"RU":null,"SE":null,"SI":null,"SK":null,"SM":null,"TR":null,"UA":null,"VA":null};if(cc in euLU)return true;else return false},_cookieNotice:function(){(function(){window.cookieconsent_options=
cookie_msg_options;var s=document.createElement("script");s.type="text/javascript";s.async=true;s.src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js";var x=document.getElementsByTagName("script")[0];x.parentNode.insertBefore(s,x)})()}};
;

/* /js/angular/app/bqAppConfig */
BQ_APP.run(function run($http,$cookies){$http.defaults.xsrfCookieName="bq_ct";$http.defaults.xsrfHeaderName="bq_ct_h"});BQ_APP.config(["$tooltipProvider",function($tooltipProvider){$tooltipProvider.options({popupDelay:300})}]);BQ_APP.directive("ngRightClick",function($parse){return function(scope,element,attrs){var fn=$parse(attrs.ngRightClick);element.bind("contextmenu",function(event){scope.$apply(function(){event.preventDefault();fn(scope,{$event:event})})})}});
BQ_APP.factory("$exceptionHandler",$exceptionHandler);$exceptionHandler.$inject=["$injector"];function $exceptionHandler($injector){return function(exception,cause){var message="unknown";if(angular.isDefined(exception.message))message=exception.message;BQErrorLog.logError("Angular:"+message+", cause\x3d"+cause,exception);var toastr=$injector.get("toastr");toastr.error("Sorry, a client error happened.  Error\x3d"+message,"Internal Client Error")}};
;

/* /js/angular/service/bqServices */
var bqServicesModule=angular.module("bqServices",[]);
bqServicesModule.factory("bqServices",["$interval","$rootScope","$http","$document","$cookies","$log","$modal","$q","toastr",function($interval,$rootScope,$http,$document,$cookies,$log,$modal,$q,toastr){var service={};service.favoritesByQuoteId={};service.collectedByQuoteId={};service.authStateCallbacks=[];service.collectionList=null;service.isOnFavoritesPage=false;service.loginRequiredForPg=false;service.loginFailedMsg=null;service.loginShowPleaseWait=false;service.hideLoginPleaseWaitAutomatically=
true;service.hideYouJustLoggedOut=0;service.redirectUrl=null;service.didDisplayLoggedOut=false;service.USE_LOGIN_REQ=false;service.pendingActionMap=null;service.debug_cl_eh=false;service.isLI=function(){return angular.isDefined($cookies.get("bq_lim"))};service.getLoggedInDisplayName=function(){return $cookies.get("bq_lim")};service.hasLI=function(){return angular.isDefined($cookies.get("bq_hli"))};service.initLoginInfo=function(){service.loginFailedMsg=null;service.hideYouJustLoggedOut=0;service.redirectUrl=
null};service.setUpLinkEvents=function(){$(document).ready(function(){$(".oncl_q").unbind("click",service.handle_qCl);$(".oncl_q").click(service.handle_qCl);$(".oncl_a").unbind("click",service.handle_aCl);$(".oncl_a").click(service.handle_aCl);$(".oncl_k").unbind("click",service.handle_kCl);$(".oncl_k").click(service.handle_kCl);$(".favHeart").unbind("click",service.handle_hCl);$(".favHeart").click(service.handle_hCl);$(".favAddToCol").unbind("click",service.handle_pCl);$(".favAddToCol").click(service.handle_pCl)})};
service.handle_qCl=function(){var cld=service._getClickData($(this));if(service.debug_cl_eh){konsole.log("[Sending GA event] qC; pageType\x3d",cld.pageType,", linkFrom\x3d",cld.from,", linkTo\x3d",cld.to,", pgNum\x3d",cld.pgNum);event.stopPropagation();event.preventDefault()}else _qAct("Quote",cld.pageType,cld.from,cld.to,cld.pgNum)};service.handle_hCl=function(){var cld=service._getClickData($(this));if(service.debug_cl_eh){konsole.log("[Sending GA event] hCl; linkFrom\x3d",cld.from,", qUrl\x3d",
cld.qUrl);event.stopPropagation();event.preventDefault()}else hCl(cld.from,cld.qUrl,"1")};service.handle_pCl=function(){var cld=service._getClickData($(this));if(service.debug_cl_eh){konsole.log("[Sending GA event] hCl; linkFrom\x3d",cld.from,", qUrl\x3d",cld.qUrl);event.stopPropagation();event.preventDefault()}else pCl(cld.from,cld.qUrl,"1")};service.handle_kCl=function(){var cld=service._getClickData($(this));var keywordIdx=$(this).attr("data-idx");if(service.debug_cl_eh){konsole.log("[Sending GA event] kC; linkFrom\x3d",
cld.from,", linkTo\x3d",cld.to,", idx\x3d",keywordIdx,", pgNum\x3d",cld.pgNum);event.stopPropagation();event.preventDefault()}else kCl(cld.from,cld.to,keywordIdx,cld.pgNum)};service.handle_aCl=function(){var cld=service._getClickData($(this));if(service.debug_cl_eh){konsole.log("[Sending GA event] aC; pageType\x3d",cld.pageType,", linkFrom\x3d",cld.from,", linkTo\x3d",cld.to,", pgNum\x3d",cld.pgNum);event.stopPropagation();event.preventDefault()}else aCl(cld.pageType,cld.from,cld.to,cld.pgNum)};service._getClickData=
function(linkEl){try{var closest=linkEl.closest(".gaPageType");var pageType;if(typeof pageType==="undefined"||closest.length==0)pageType=GA_PG_TYPE;else pageType=$(closest).attr("data-gaptype");var linkFrom=removeDotHtml(CURL);var linkTo=removeDotHtml(linkEl.attr("href"));var qBoxEl=linkEl.closest(".bqQt");if(qBoxEl.length==0){BQErrorLog.logError("_getClickData - no .bqQt");return}var qBoxId=qBoxEl.attr("id");var pgNum=1;if(typeof qBoxId!=="undefined"&&qBoxId!=null){var parts=qBoxId.split("_");pgNum=
parts[1]}var qUrl=null;if(qBoxEl.length>0){var qtLink=qBoxEl.find(".oncl_q");if(qtLink.length>0){var anc=qtLink.first();qUrl=removeDotHtml(anc.attr("href"))}}if(typeof pgNum==="undefined")pgNum=CPAGE;return{"pageType":pageType,"from":linkFrom,"to":linkTo,"pgNum":pgNum,"qUrl":qUrl}}catch(err){BQErrorLog.logError("_getClickData error",err)}};service.askUserToLogin=function(){service.checkBrowserVersion();var doModalForLocalhost=location.hostname=="localhost";if("https:"==document.location.protocol||
doModalForLocalhost){$cookies.remove("bq_fake_s_reload");var mi=$modal.open({animation:true,windowClass:"bq-nli-modal",templateUrl:"/auth/modal_login",controller:"ModalLoginCtrl",resolve:{toastr:function(){return toastr}}});mi.result.then(function(){},function(reason){service.hModalDismiss(reason);service.clearPendingAction()})}else{if(service.getPendingAction()==null)service.setPendingAction({"act":"login"});service.savePendingActionInCookie();if(location.hostname=="localhost"){var expiresDate=new Date;
expiresDate.setTime(expiresDate.getTime()+1E3*60);$cookies.put("bq_fake_s_reload","y",{expires:expiresDate});location.reload()}else{var newUrl="https:"+window.location.href.substring(window.location.protocol.length,window.location.href.length);window.location.href=newUrl}}};service.setPendingAction=function(actionMap){service.pendingActionMap=actionMap};service.getPendingAction=function(){return service.pendingActionMap};service.clearPendingAction=function(){if(service.pendingActionMap!=null){konsole.log("clearPendingAction() - service.pendingActionMap \x3d null");
service.pendingActionMap=null}var pendActionCookie=$cookies.get("bq_act_pend");if(angular.isDefined(pendActionCookie)&&pendActionCookie!=null){konsole.log("clearPendingAction() - remove cookie ",pendActionCookie," with path\x3d",window.location.pathname);$cookies.remove("bq_act_pend",{path:window.location.pathname});$cookies.remove("bq_act_pend");var cval=$cookies.get("bq_act_pend");if(cval)konsole.log("[warn] cookie still exists, remove didn't work",cval)}};service.savePendingActionInCookieForPath=
function(cookiePath){if(service.pendingActionMap!=null){var expiresDate=new Date;expiresDate.setTime(expiresDate.getTime()+1E3*60);$cookies.put("bq_act_pend",JSON.stringify(service.pendingActionMap),{path:cookiePath,expires:expiresDate})}};service.savePendingActionInCookie=function(){service.savePendingActionInCookieForPath(window.location.pathname)};service.processPendingAction=function(){var pendActMap=service.pendingActionMap;if(pendActMap==null){var pendingActionData=$cookies.get("bq_act_pend");
if(angular.isDefined(pendingActionData))try{pendActMap=JSON.parse(pendingActionData)}catch(err){konsole.log("Error parsing action cookie")}}if(pendActMap!=null){konsole.log("processPendingAction() : ",pendActMap);if(pendActMap.act=="fv"){konsole.log("processPendingAction() - favorite "+pendActMap.id);service.setAsFavorite(pendActMap.id)}if(pendActMap.act=="add2c"){konsole.log("processPendingAction() - add2c; qid\x3d"+pendActMap.id);service.showAddToCollectionModal(pendActMap.id)}if(pendActMap.act==
"login"){konsole.log("processPendingAction() - login");service.clearPendingAction();service.askUserToLogin()}if(pendActMap.act=="t_info")toastr.success(pendActMap.msg);if(pendActMap.act=="logoutMsg"){toastr.success("You have logged out.");service.clearPendingAction()}}};service.submitLoginInfo=function(myForm,email,password){var deferred=$q.defer();service.hideYouJustLoggedOut=1;if(myForm.$valid){service.loginShowPleaseWait=true;service.post("/auth/apiValidateLogin",{email:email,pwd:password}).then(function(aResp){deferred.resolve(aResp);
service.dnWhenLoaded=service.getLoggedInDisplayName();if(service.hideLoginPleaseWaitAutomatically)service.loginShowPleaseWait=false},function(aResp){konsole.log("login failed with ",aResp.data);if(aResp.status==401){service.loginFailedMsg="Your email or password was incorrect.";service.loginShowPleaseWait=false}else if(aResp.status==400)service.goSignupSuccess(email,aResp.data.ee,"/signup_success");else if(aResp.status==429){service.showAjaxError("You have made too many bad login attempts. Please try again in a few minutes.",
aResp);service.loginShowPleaseWait=false}else{service.showAjaxError("Your login failed due to a system error.",aResp);service.loginShowPleaseWait=false}})}return deferred.promise};service.goSignupSuccess=function(email,ee,success_url){var expiresDate=new Date;expiresDate.setTime(expiresDate.getTime()+1E3*60*60);$cookies.putObject("bq_su_email",{email:email,ee:ee},{expires:expiresDate});window.location.href=success_url};service.userHasNotChanged=function(){if(angular.isDefined(service.dnWhenLoaded)&&
angular.isDefined(service.getLoggedInDisplayName())&&service.dnWhenLoaded!=service.getLoggedInDisplayName()){alert("User "+service.dnWhenLoaded+" has been logged out from another browser window or tab.");window.location.href="/";return false}return true};service.post=function(url,params){var deferred=$q.defer();if(service.userHasNotChanged()){$http.post(url,params).success(function(data,status,headers,config){deferred.resolve({data:data,status:status,headers:headers,config:config})}).error(function(data,
status,headers,config){deferred.reject({data:data,status:status,headers:headers,config:config})});return deferred.promise}};service.get=function(url){var deferred=$q.defer();if(service.userHasNotChanged()){$http.get(url).success(function(data,status,headers,config){deferred.resolve({data:data,status:status,headers:headers,config:config})}).error(function(data,status,headers,config){deferred.reject({data:data,status:status,headers:headers,config:config})});return deferred.promise}};service.setIsOnFavoritesPage=
function(onFavs){service.isOnFavoritesPage=onFavs};service.getCollectionMembership=function(quoteId){var deferred=$q.defer();var url="/uapi/col/apiCollectionMembership/"+quoteId;service.get(url).then(function(aResp){service.collectionList=aResp.data.collections;deferred.resolve(aResp)},function(aResp){deferred.reject(aResp)});return deferred.promise};service.getCollectionList=function(fromCache){var deferred=$q.defer();if(fromCache&&service.collectionList!=null)deferred.resolve({data:service.collectionList});
else service.get("/uapi/col/apiCollectionList").then(function(aResp){service.collectionList=aResp.data.collectionList;service.collectionListDisplayName=aResp.data.displayName;deferred.resolve(aResp)},function(aResp){deferred.reject(aResp)});return deferred.promise};service.addAuthListener=function(callbackFn){if(angular.isFunction(callbackFn))service.authStateCallbacks.push(callbackFn);else konsole.log("Error: not a fn",callbackFn)};service.callAuthListeners=function(){var allPromises=[];for(var i=
0;i!=service.authStateCallbacks.length;i++)allPromises.push(service.authStateCallbacks[i]());if(service.isLI())service.loginShowPleaseWait=false;$(document).trigger("Auth:Change",[]);return $q.all(allPromises)};service.getAllCollectedQuotes=function(){var deferred=$q.defer();service.post("/uapi/col/apiGetAllCollectedQuotes").then(function(aResp){service.favoritesByQuoteId=aResp.data.favorites;service.collectedByQuoteId=aResp.data.collected;$(document).trigger("Mem:Updated",[aResp.data]);deferred.resolve(aResp)},
function(aResp){deferred.reject(aResp)});return deferred.promise};service.setFavoritesByQuoteId=function(favs){service.favoritesByQuoteId=favs};service.showLoginRequired=function(mode){var mi=$modal.open({animation:true,windowClass:"bq-nli-modal",templateUrl:"/auth/modal_login_required",controller:"ModalLoginRequired",resolve:{toastr:function(){return toastr},mode:function(){return mode}}});mi.result.then(function(){},function(reason){service.hModalDismiss(reason);service.clearPendingAction()})};
service.setAsFavorite=function(quoteId){service._changeFavorite(quoteId,"f")};service.toggleFavorite=function(quoteId){service._changeFavorite(quoteId,"t")};service.toggleFavoriteRedirect=function(quoteId,quoteUrl){if(service.isLI())service.toggleFavorite(quoteId);else{service.setPendingAction({"act":"fv","id":quoteId});service.savePendingActionInCookieForPath(quoteUrl);window.location.href=quoteUrl}};service.goToMyFavorites=function(){window.location.href="/users/"+service.getLoggedInDisplayName()+
"/favorites"};service.goToMyCollections=function(){window.location.href="/users/"+service.getLoggedInDisplayName()+"/collections"};service._changeFavorite=function(quoteId,favMode){try{if(!service.isLI()){service.setPendingAction({"act":"fv","id":quoteId});if(service.hasLI()||favMode=="f")service.askUserToLogin();else if(service.USE_LOGIN_REQ)service.showLoginRequired("fv");else window.location.href="/signup?utm_source\x3dbrainyquote\x26utm_medium\x3dfavorite_btnl\x26utm_campaign\x3dmembership"}else{service.clearPendingAction();
var makeFavorite=true;if(favMode=="t")if(service.isFavoriteQuote(quoteId))makeFavorite=false;service._ajaxMarkAsFav(quoteId,makeFavorite).then(function(aResp){var toastMsg;var handlerFn;if(makeFavorite){toastMsg='A quote was added to your \x3ca ref\x3d"#na"\x3efavorites\x3c/a\x3e!';if(service.isOnFavoritesPage)toastMsg="A quote was added to your favorites!";handlerFn=function(wasClicked){if(wasClicked)if(!service.isOnFavoritesPage)service.goToMyFavorites()}}else{toastMsg='A quote was deleted from your \x3ca class\x3d"pointerCursor"\x3efavorites\x3c/a\x3e.';
if(service.isOnFavoritesPage)toastMsg='A quote was deleted from your favorites.\x3cbr\x3e\x3ca class\x3d"pointerCursor"\x3eMake it a favorite again\x3c/a\x3e';handlerFn=function(wasClicked){if(wasClicked)if(service.isOnFavoritesPage)service.toggleFavorite(quoteId);else service.goToMyFavorites()}}toastr.success(toastMsg,{allowHtml:true,closeButton:true,onHidden:handlerFn})},function(aResp){})}}catch(err){BQErrorLog.logError("_changeFavorite",err)}};service.ajaxLogout=function(noRedirects){service.post("/auth/apiLogout",
{}).then(function(aResp){service.favoritesByQuoteId={};service.collectedByQuoteId={};service.dnWhenLoaded=undefined;service.callAuthListeners().then(function(){if(service.loginRequiredForPg&&!(noRedirects==true)){service.setPendingAction({"act":"logoutMsg"});service.savePendingActionInCookie();var newUrl="http://"+window.location.host;window.location.href=newUrl;return}toastr.success("You have logged out.")},function(aResp){service.showAjaxError("Your logout failed due to a system error.",aResp)})},
function(aResp){service.showAjaxError("Sorry, logout failed due to a system error.",aResp)})};service.showAddToCollectionModal=function(quoteId){if(service.isLI()){service.clearPendingAction();var mi=$modal.open({animation:true,windowClass:"bq-atc-modal",templateUrl:"/users/"+service.getLoggedInDisplayName()+"/modal_add_to_collection",controller:"ModalAddToCollectionCtrl",resolve:{quoteId:function(){return quoteId},toastr:function(){return toastr}}});mi.result.then(function(reason){},function(reason){service.hModalDismiss(reason);
service.clearPendingAction()})}else{service.setPendingAction({"act":"add2c","id":quoteId});if(service.hasLI())service.askUserToLogin();else if(service.USE_LOGIN_REQ)service.showLoginRequired("cl");else window.location.href="/signup?utm_source\x3dbrainyquote\x26utm_medium\x3dcollect_btnl\x26utm_campaign\x3dmembership"}};service.showAddToCollectionModalRedirect=function(quoteId,quoteUrl){if(service.isLI())service.showAddToCollectionModal(quoteId);else{service.setPendingAction({"act":"add2c","id":quoteId});
service.savePendingActionInCookieForPath(quoteUrl);window.location.href=quoteUrl}};service.setQuoteAsFavoriteInModel=function(quoteId,makeFavorite){service.favoritesByQuoteId[quoteId]=makeFavorite;$rootScope.$emit("favoritesChangedInModel",quoteId,makeFavorite)};service.setQuoteAsCollectedInModel=function(quoteId){service.collectedByQuoteId[quoteId]=true;$(document).trigger("Mem:Coll",[{qId:quoteId,isColl:true}])};service.setQuoteAsNotCollectedInModel=function(quoteId){service.collectedByQuoteId[quoteId]=
false;$(document).trigger("Mem:Coll",[{qId:quoteId,isColl:false}])};service.addCollection=function(collectionName,quoteId){var deferred=$q.defer();service.post("/uapi/col/apiAddCollection",{cname:collectionName,quoteId:quoteId}).then(function(aResp){deferred.resolve(aResp)},function(aResp){deferred.reject(aResp)});return deferred.promise};service.isMobile=function(){return angular.isDefined(IS_MBL)&&IS_MBL==1};service.renameCollection=function(collectionId,collectionRenamed){var deferred=$q.defer();
service.post("/uapi/col/apiRenameCollection",{collectionId:collectionId,collectionName:collectionRenamed}).then(function(aResp){deferred.resolve(aResp)},function(aResp){deferred.reject(aResp)});return deferred.promise};service.deleteCollection=function(collectionId){var deferred=$q.defer();service.post("/uapi/col/apiDeleteCollection",{collectionId:collectionId}).then(function(aResp){deferred.resolve(aResp)},function(aResp){deferred.reject(aResp)});return deferred.promise};service.addQuoteToCollection=
function(quoteId,quoteCollectionId){var deferred=$q.defer();service.setQuoteAsCollectedInModel(quoteId);service.post("/uapi/col/apiAddQuoteToCollection",{q_id:quoteId,qc_id:quoteCollectionId}).then(function(aResp){deferred.resolve(aResp)},function(aResp){deferred.reject(aResp)});return deferred.promise};service.removeQuoteFromCollection=function(quoteId,quoteCollectionId){var deferred=$q.defer();service.post("/uapi/col/apiRemoveQuoteFromCollection",{quoteId:quoteId,collectionId:quoteCollectionId}).then(function(aResp){deferred.resolve(aResp)},
function(aResp){deferred.reject(aResp)});return deferred.promise};service._ajaxMarkAsFav=function(quoteId,makeFavorite){var originalSetting=!makeFavorite;var deferred=$q.defer();service.setQuoteAsFavoriteInModel(quoteId,makeFavorite);$(document).trigger("Mem:Fav",[{qId:quoteId,isFav:makeFavorite}]);service.post("/uapi/fv/apiEditFavorite",{quoteId:quoteId,makeFavorite:makeFavorite}).then(function(aResp){deferred.resolve(aResp);if(makeFavorite)$rootScope.$emit("favoriteAddedToDB",[quoteId,makeFavorite])},
function(aResp){service.showAjaxError("Sorry, a system error occurred.",aResp);service.setQuoteAsFavoriteInModel(quoteId,originalSetting);deferred.reject(aResp)});return deferred.promise};service.showAjaxError=function(msg,aResp){var handledError=false;if(aResp.status==0){service.showNetworkError();handledError=true}if(aResp.status==400&&angular.isObject(aResp.data))if(aResp.data.message){toastr.error(aResp.data.message,"Error");handledError=true}if(aResp.status==401){if(!service.didDisplayLoggedOut){alert("Due to inactivity, you have been logged out of your account.");
service.didDisplayLoggedOut=false}service.ajaxLogout();service.askUserToLogin();handledError=true}if(!handledError)if(typeof msg!=="undefined")toastr.error(msg,"Error")};service.hModalDismiss=function(reason){if(angular.isObject(reason)&&angular.isNumber(reason.status)&&reason.status==0)service.showNetworkError()};service.showNetworkError=function(){toastr.error("We can\u2019t connect to the server. Please check your network connection.","Network error")};service.checkBrowserVersion=function(){if(typeof BQ_OLD_IE!==
"undefined"&&BQ_OLD_IE)document.location="/error/notSupportedBrowser"};service.isFavoriteQuote=function(quoteId){if(service.favoritesByQuoteId[quoteId])return true;return false};service.isCollectedQuote=function(quoteId){if(typeof service.collectedByQuoteId!=="undefined"&&service.collectedByQuoteId[quoteId])return true;return false};service.uniqueAuthorsForQuotations=function(quotations){function onlyUnique(value,index,self){return self.indexOf(value)===index}var authors=quotations.map(function(quotation){return quotation.author});
var uniqueauthors=authors.filter(onlyUnique);return uniqueauthors.sort()};service.findById=function(id){var dEl=document.getElementById(id);if(dEl)return angular.element(dEl);return null};service.findByClass=function(cssClass){var startElem=$("body");var result=angular.element(startElem[0].querySelector(cssClass));return result};service.dnWhenLoaded=service.getLoggedInDisplayName();return service}]);
;

/* /js/angular/service/bqServerErrors */
var bqServerErrorsModule=angular.module("bqServerErrors",[]);
bqServerErrorsModule.factory("bqServerErrors",["$log","$q","toastr",function($log,$q,toastr){var service={};service.errs={};service.handleServerErrors=function(aResp){var hadErrors=false;if(aResp.data&&aResp.data.validationErrors){var ve=aResp.data.validationErrors;for(var fieldName in ve){konsole.log("Setting server error for "+fieldName+" to "+ve[fieldName]);service.setServerError(fieldName,ve[fieldName],true);hadErrors=true}}return hadErrors};service.setServerError=function(fieldName,errorName){if(!angular.isDefined(service.errs[fieldName]))service.errs[fieldName]=
{};service.errs[fieldName][errorName]=true};service.hasServerError=function(fieldName,errorName){return angular.isDefined(service.errs[fieldName])&&angular.isDefined(service.errs[fieldName][errorName])};service.clearServerErrors=function(fieldName){service.errs[fieldName]={}};return service}]);
;

/* /js/angular/directive/svalidateDir */
BQ_APP.directive("svalidate",function($q,$timeout,$http,$log,bqServices){return{require:"ngModel",link:function(scope,elm,attrs,ctrl){ctrl.$asyncValidators.svalidate=function(modelValue,viewValue){var def=$q.defer();var validationType=attrs["svalidate"];var reqParams={value:modelValue,validationType:validationType};if(angular.isDefined(scope.svalidateParams))reqParams.svalidateParams=scope.svalidateParams;if(!angular.isDefined(scope.svalidateErrorMsg))scope.svalidateErrorMsg={};bqServices.post("/uapi/acct/apiValidateValue",
reqParams).then(function(aResp){scope.svalidateErrorMsg[validationType]=undefined;def.resolve(aResp)},function(aResp){if(angular.isDefined(aResp.data)&&aResp.data!=null&&angular.isDefined(aResp.data.validationErrors))scope.svalidateErrorMsg[validationType]=aResp.data.validationErrors[validationType];else if(aResp.status!=400)bqServices.showAjaxError(undefined,aResp);def.reject(aResp)});return def.promise}}}});
;

/* /js/angular/ctrl/NavBarCtrl */
BQ_APP.controller("NavBarCtrl",function($scope,$http,$cookies,$modal,$log,$window,toastr,bqServices){$scope.initNav=function(config){if(config&&config.loginRequired)bqServices.loginRequiredForPg=true};$scope.showMemberButtons=function(){var result=SHOW_MBR_ACTIONS&&$scope.showLogin();return result};$scope.getMyFavoritesUrl=function(){var displayName=bqServices.getLoggedInDisplayName();return"/users/"+displayName+"/favorites"};$scope.getMyCollectionsUrl=function(){var displayName=bqServices.getLoggedInDisplayName();
return"/users/"+displayName+"/collections"};$scope.init=function(){angular.element($window).bind("resize",function(){if($window.innerWidth>767)$scope.$apply(function(){$scope.navBQCollapsed=true;$scope.navCollapsed=true})});bqServices.processPendingAction()};$scope.changeSite=function(siteName){alert("change site to "+siteName)};$scope.toggleNavBQCollapsed=function(){$scope.navBQCollapsed=!$scope.navBQCollapsed;$scope.navCollapsed=true;if(!$scope.navBQCollapsed)toastr.clear()};$scope.myBQMenuClicked=
function(){toastr.clear()};$scope.toggleNavCollapsed=function(){$scope.navCollapsed=!$scope.navCollapsed;$scope.navBQCollapsed=true;if(!$scope.navCollapsed)toastr.clear()};$scope.myBQnavBarWrapperClass=function(){return!$scope.navBQCollapsed?"":"hidden"};$scope.myBQnavBarClass=function(){return!$scope.navBQCollapsed?"in":"pull-left"};$scope.navBarClass=function(){return!$scope.navCollapsed&&"in"};$scope.loginClicked=function(){var pathName=window.location.pathname;if(pathName.indexOf("/signup")===
0||pathName.indexOf("/login")===0||pathName.indexOf("/reset_password")===0)window.location.href="/login";else bqServices.askUserToLogin()};$scope.logoutClicked=function(){bqServices.ajaxLogout()};$scope.showMemberIfLoggedOut=function(){return SHOW_MBR_ACTIONS&&!bqServices.isLI()};$scope.showMemberIfLoggedIn=function(){return SHOW_MBR_ACTIONS&&bqServices.isLI()};$scope.showMemberActions=function(){return SHOW_MBR_ACTIONS};$scope.showLogin=function(){return!bqServices.isLI()};$scope.isCollapsed=true;
$scope.navBQCollapsed=true;$scope.navCollapsed=true;$scope.config={};$scope.init()});
;

/* /js/angular/ctrl/BottomNavCtrl */
BQ_APP.controller("BottomNavCtrl",function($scope,$http,$cookies,$modal,$log,$window,toastr,bqServices){$scope.init=function(){var cval=$cookies.get("brainyPSite");if(cval=="d"&&IS_MBL)location.reload(true);if(cval=="m"&&!IS_MBL)location.reload(true)};$scope.changeSite=function(siteName){var cval=$cookies.get("brainyPSite");konsole.log("changed site to "+siteName+"; old value\x3d"+cval+" new value\x3d"+siteName);var expiresDate=new Date;expiresDate.setTime(expiresDate.getTime()+86400);$cookies.put("brainyPSite",
siteName,{expires:expiresDate,path:"/"});location.reload(true)};$scope.init()});
;

/* /js/angular/ctrl/SplashQuoteCtrl */
BQ_APP.controller("SplashQuoteCtrl",function($scope,$http,$cookies,$modal,$log,$window,$timeout,toastr,bqServices){$scope.initSplashQuote=function(){$scope.splashQuoteData=$window.splashQuoteJson;$scope.splashQuoteId=$scope.splashQuoteData[0].q_id;$scope.currentIdx=0;$scope.nextDown=false;$scope.prevDown=false};$scope.initQuoteId=function(quoteId){$scope.splashQuoteId=quoteId};$scope.getSplashQuoteId=function(){return $scope.splashQuoteId};$scope.prevClass=function(){if($scope.prevDown)return"spl-pn-disable";
return""};$scope.nextClass=function(){if($scope.nextDown)return"spl-pn-disable";return""};$scope.onNextClicked=function(){konsole.log("next at "+new Date);$scope.nextDown=true;var newIdx=$scope.currentIdx+1;if(newIdx==$scope.splashQuoteData.length)newIdx=0;$scope.setQuoteIndex(newIdx)};$scope.onPrevClicked=function(){var newIdx=$scope.currentIdx-1;$scope.prevDown=true;if(newIdx<0)newIdx=$scope.splashQuoteData.length-1;$scope.setQuoteIndex(newIdx)};$scope.setQuoteIndex=function(newIdx){$scope.currentIdx=
newIdx;$scope.showSplashQuote=false;$scope.enablePrevNextButtons=false;$timeout(function(){$scope.changeQuoteData($scope.splashQuoteData[$scope.currentIdx]);$scope.nextDown=false;$scope.prevDown=false},400,true)};$scope.changeQuoteData=function(d){var myEl=angular.element(document.querySelector("#q-splash-bn"));var children=myEl.find("a");var quoteLink=angular.element(children[0]);var authorLink=angular.element(children[1]);var quoteParentDiv=quoteLink.parent();$scope.splashQuoteId=d.q_id;quoteLink.text(d.qt);
var fs=32;var lh=32;var len=d.qt.length;if(len>=200)fs=20;else if(len>=150)fs=24;else if(len>=100)fs=28;lh=fs;var style="font-size:"+fs+"px;";quoteParentDiv.attr("style","line-height:"+lh+"px");quoteLink.attr("href",d.q_url);quoteLink.attr("style",style);quoteLink.attr("class",$scope.updateCssClass("qt_"+d.q_id,quoteLink.attr("class")));authorLink.text(d.an);authorLink.attr("href",d.a_url);authorLink.attr("class",$scope.updateCssClass("qa_"+d.q_id,authorLink.attr("class")));$scope.showSplashQuote=
true};$scope.onReloadClicked=function(){$scope.showSplashQuote=false;var ts=Date.now()/100;bqServices.get("/api/rand_q?ts\x3d"+ts+"\x26langc\x3d"+BQ_LANG_C).then(function(aResp){$timeout(function(){var d=aResp.data;$scope.changeQuoteData(d)},400,true)},function(aResp){bqServices.showAjaxError("Sorry, an error happened while reloading quotes.",aResp)})};$scope.updateCssClass=function(newCssClass,oldCssClasses){var items=oldCssClasses.split(" ");var newClass="";for(var i=0;i!=items.length;i++){var item=
items[i];var firstPart=item.substring(0,3);if(!(firstPart==="qa_"||firstPart=="qt_"))newClass=newClass+" "+item}newClass=newClass+" "+newCssClass;return newClass};$scope.showSplashQuote=true});
;

/* /js/angular/ctrl/ModalLoginRequiredCtrl */
BQ_APP.controller("ModalLoginRequired",function($scope,$log,$modal,$modalInstance,mode,bqServices,toastr){$scope.ok=function(){$modalInstance.close()};$scope.cancel=function(){$modalInstance.dismiss("cancel")};$scope.loginClicked=function(){$modalInstance.close();bqServices.askUserToLogin()};$scope.mode=mode});
;

/* /js/angular/ctrl/ModalLoginCtrl */
BQ_APP.controller("ModalLoginCtrl",function($scope,$modalInstance,$http,$sce,$cookies,$document,$log,$window,bqServices,toastr){$scope.loginFailedMsg=function(){return bqServices.loginFailedMsg};$scope.showPleaseWaitMessage=function(){return bqServices.loginShowPleaseWait};$scope.showYouJustLoggedOut=function(){return!bqServices.hideYouJustLoggedOut};$scope.submitLogin=function(myForm){bqServices.submitLoginInfo(myForm,$scope.email,$scope.password).then(function(aResp){$modalInstance.close();toastr.success("You have successfully logged in.");
konsole.log("Login succeeded.");bqServices.callAuthListeners().then(function(){bqServices.processPendingAction()},function(aResp){})},function(aResp){})};bqServices.initLoginInfo()});
;

/* /js/angular/ctrl/ShowFavoritesCtrl */
BQ_APP.controller("ShowFavoritesCtrl",function($rootScope,$compile,$scope,$http,$cookies,$modal,$q,$log,toastr,bqServices){$scope.initSFC=function(topTenQuoteIds){$scope.currentTopTenIndex=0;$scope.topTenQuoteIds=topTenQuoteIds;if(bqServices.isLI())$scope.refreshFavoritesOnPage();bqServices.setUpLinkEvents();bqServices.addAuthListener($scope.authStateChange)};$scope.setCurrentTopTenIndex=function(newIndex){$scope.$apply(function(){$scope.currentTopTenIndex=newIndex})};$scope.getCurrentTopTenQuote=
function(){var qid=$scope.topTenQuoteIds[$scope.currentTopTenIndex].id;return qid};$scope.getCurrentTopTenQuoteUrl=function(){return $scope.topTenQuoteIds[$scope.currentTopTenIndex].url};$rootScope.$on("quotesUpdated",function(event,d){$scope.refreshFavoritesOnPage()});$scope.authStateChange=function(){if(bqServices.isLI())return $scope.refreshFavoritesOnPage();else{var deferred=$q.defer();deferred.resolve({});return deferred.promise}};$scope.refreshFavoritesOnPage=function(){var deferred=$q.defer();
bqServices.getAllCollectedQuotes().then(function(aResp){deferred.resolve(aResp)},function(aResp){deferred.reject(aResp);bqServices.showAjaxError("Sorry, a system error occurred.",aResp)});return deferred.promise};$scope.showMemberButtons=function(){return SHOW_MBR_ACTIONS};$scope.onQtCl=function($event){$event.stopPropagation()};$scope.onFavoriteClicked=function(quoteId){bqServices.toggleFavorite(quoteId)};$scope.onFavoriteRedirect=function(quoteId,quoteUrl){bqServices.toggleFavoriteRedirect(quoteId,
quoteUrl)};$scope.onAddToCollectionClicked=function(quoteId){bqServices.showAddToCollectionModal(quoteId)};$scope.onAddToCollectionRedirect=function(quoteId,quoteUrl){bqServices.showAddToCollectionModalRedirect(quoteId,quoteUrl)};$scope.isFavoriteQuote=function(quoteId){return bqServices.isFavoriteQuote(quoteId)};$scope.isCollectedQuote=function(quoteId){return bqServices.isCollectedQuote(quoteId)};$scope.favCssClass=function(quoteId,screenLoc){var isFav=bqServices.isFavoriteQuote(quoteId);if(screenLoc===
"splash"){if(isFav)return"bqMIcon fa fa-heart on";return"bqMIcon fa fa-heart off"}if(isFav)return"bqMIcon fa-heart bqFav";return"bqMIcon fa-heart-o"};$scope.favTooltip=function(quoteId){if(bqServices.isFavoriteQuote(quoteId))return"Click to remove this quote from your favorites";return"Click to add this quote to your favorites"};$scope.collectionCssClass=function(quoteId,screenLoc){var isColl=bqServices.isCollectedQuote(quoteId);if(screenLoc==="splash"){if(isColl)return"bqMIcon fa fa-plus-square favCollectedAddToCol";
return"bqMIcon fa fa-plus-square off"}if(isColl)return"bqMIcon fa-plus-square favCollectedAddToCol ";return"bqMIcon fa-plus-square-o"}});
;

/* /js/bq/inf/BQInfScrollHelper */
var BQInfScrollHelper=function(nextPageLoadMargin){this.loadedPages={};this.fPageNum=null;this.lPageNum=null;this.vPageNum=null;this.retries=0;this.nextPageLoadMargin=nextPageLoadMargin;this.init()};BQInfScrollHelper.pageLoadedEvent="InfScroll:PgLoaded";BQInfScrollHelper.pageLoadedListeners=[];
BQInfScrollHelper.prototype={init:function(){var self=this;var pageUrl=window.location.pathname;var pageNumber=CPAGE;$(function(){self._addPage(pageNumber,{u:pageUrl,offset:0});$(".hideInfScroll").hide();$(".showInfScroll").show();self._setViewPage(pageNumber);self._createVisListeners()});$(function(){$(".inf-retry-btn").click(function(){$(".infText").text("Loading...");$("#inf-load-next").show();self.requestPage(self.vPageNum)})})},_reloadMasonry:function(){BQNewMsnry.reloadItems(".new-msnry-grid");
BQNewMsnry.layout(".new-msnry-grid")},_setViewPage:function(vp){if(vp!=this.vPageNum)this.vPageNum=vp},_loadNextData:function(){this.vPageNum=this.vPageNum+1;try{this.requestPage(this.vPageNum)}catch(err){BQErrorLog.logError("InfScrollHelper error requesting page "+this.vPageNum+" id\x3d"+PG_DM_ID,err)}},_hasMorePages:function(){var hasMore=this.lPageNum<LPAGE;if(hasMore){$(".infScrollFooter").hide();$("#bqBotNav").hide()}else{$(".infScrollFooter").show();$("#bqBotNav").show()}return hasMore},requestPage:function(pnToLoad){$("#inf-load-btn").hide();
var self=this;if(pnToLoad<0||pnToLoad>LPAGE){this._hasMorePages();return}CookieUtil.createCookieWithMinExpiry("abg",ABGROUP,30);$.ajax({type:"POST",url:"/api/inf",contentType:"application/json",context:this,timeout:6E3,dataType:"json",data:JSON.stringify({typ:GA_PG_TYPE,langc:BQ_LANG_C,v:document.jsErrVer,ab:ABGROUP,pg:pnToLoad,id:PG_DM_ID,vid:VID,m:IS_MBL}),success:function(data,textStatus,req){$(".infText").text("Loading...");$("#inf-load-btn").hide();self.retries=0;var qCount=data.qCount;var elid=
data.elid;var url=data.url;var ptype=data.ptype;this._addPage(pnToLoad,{u:url});var parsedHtml=$.parseHTML(data.content);var contentEl=".new-msnry-grid";if(typeof elid!=="undefined")contentEl=elid;var isNext=true;if(isNext)$(contentEl).append(parsedHtml);else $(contentEl).prepend(parsedHtml);BQFavorites.makeEHs();this._getBQServices().setUpLinkEvents();var i=0;for(i=0;i!=BQInfScrollHelper.pageLoadedListeners.length;i++)try{var callback=BQInfScrollHelper.pageLoadedListeners[i];callback({pg:pnToLoad,
pageCount:LPAGE,reason:"ajax",qCount:qCount,ptype:ptype})}catch(err){BQErrorLog.logError("InfScroll error calling callback #"+i,err)}self._reloadMasonry();this._createVisListeners()},error:function(xhr,status,errorMsg){if(self.retries<5){$(".infText").html("Failed, will retry in 3 seconds.");setTimeout(function(){$(".infText").text("Retrying...");self.retries=self.retries+1;self.requestPage(pnToLoad)},3*1E3)}else{$("#inf-load-btn").show();$("#inf-load-next").hide();this._getBQServices().showAjaxError("There was a problem loading additional quotes, check your network connection.",
xhr);if(typeof xhr!=="undefined")if(xhr.status===0)BQErrorLog.logWarn("InfScroll AjaxErr id\x3d"+PG_DM_ID+" m\x3d"+IS_MBL+" sc\x3d"+xhr.status);else BQErrorLog.logError("InfScroll AjaxErr id\x3d"+PG_DM_ID+" m\x3d"+IS_MBL+" sc\x3d"+xhr.status)}}})},_getBQServices:function(){return angular.element(document.body).injector().get("bqServices")},_addPage:function(pg,pageData){this.loadedPages[pg]=pageData;if(this.fPageNum==null||this.fPageNum>pg)this.fPageNum=pg;if(this.lPageNum==null||this.lPageNum<pg)this.lPageNum=
pg;if(this._hasMorePages())$("#inf-load-next").show();else $("#inf-load-next").hide()},addPageLoadedListener:function(listener){BQInfScrollHelper.pageLoadedListeners.push(listener)},_createVisListeners:function(){if(this._hasMorePages()){var self=this;AlmostVisibleMonitor.notifyWhenVisible("inf-load-next",self.nextPageLoadMargin,1,function(elementId){self._loadNextData()})}}};
;

/* /js/bq/inf/BQListPageUpdateHandler */
var BQListPageUpdateHandler=function(bqPv,bqAdConfig,firstInfScrollPos,infScrollSpacing,allAdPages){this._init(bqPv,bqAdConfig,firstInfScrollPos,infScrollSpacing,allAdPages)};
BQListPageUpdateHandler.prototype={_init:function(bqPv,bqAdConfig,firstInfScrollPos,infScrollSpacing,allAdPages){this.bqPv=bqPv;this.bqAdConfig=bqAdConfig;this.firstInfScrollPos=firstInfScrollPos;this.infScrollSpacing=infScrollSpacing;this.allAdPages=allAdPages},log:function(msg){var self=this;if(self.bqAdConfig.get("logOn")){var newArgs=["[ BQListPageUpdateHandler ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},elementOnListPage:function(pageNum,
quoteNum){var self=this;var el;var qtDivId="qpos_"+pageNum+"_"+quoteNum;self.log("Finding element at divId "+qtDivId+" on page "+pageNum);var elList=$(".bqQt[id\x3d'"+qtDivId+"']");if(elList.length>0)el=elList.first();else BQErrorLog.logError("No quote element at "+pageNum+":"+quoteNum);self.log("found element at qtDivId "+qtDivId,el);return el},pageBorderDivId:function(pageNum){var self=this;var el=self.elementOnListPage(pageNum,1);var elId=null;if(el)elId=el.attr("id");return elId},getListPageAdDiv:function(divId){var self=
this;var retVal="";var cssClass="m-ad-brick grid-item";var innerCssClass="bq_ad_320x250_inf_scroll";if(self.bqPv.isMobile()){cssClass="bq-m-center-300-ad";innerCssClass="bq_ad_mobile_inf_scroll"}retVal=retVal+'\x3cdiv class\x3d"'+cssClass+'"\x3e'+'\x3cdiv id\x3d"'+divId+'_edge" class\x3d"mbl_qtbox"\x3e'+'\x3cdiv id\x3d"'+divId+'" class\x3d"'+innerCssClass+'"\x3e\x3c/div\x3e'+"\x3c/div\x3e"+"\x3c/div\x3e";return retVal},addListPageSlotInstanceToPage:function(slotDef,pageNum,currentDivPosition){var self=
this;var divId=slotDef.getUniqueDivId();var adDivHtml=self.getListPageAdDiv(divId);var el=self.elementOnListPage(pageNum,currentDivPosition);if(el.length>0){var parsedHtml=$.parseHTML(adDivHtml);$(parsedHtml).insertAfter(el)}},getListPageSlotsToAdd:function(slotsForPage,pageNum,pageCount,quoteCount){var self=this;var currentDivPosition=self.firstInfScrollPos;var adSpacing=self.infScrollSpacing;if(pageNum>this.allAdPages){currentDivPosition=currentDivPosition+(pageNum-this.allAdPages)*2;adSpacing+=
pageNum-this.allAdPages}if(slotsForPage){var slotsToAdd=[];self.log("slotsForPage",slotsForPage);for(var i=0;i<slotsForPage.length;i++){var slotDef=slotsForPage[i];if(quoteCount>currentDivPosition){slotsToAdd.push(slotDef);self.addListPageSlotInstanceToPage(slotDef,pageNum,currentDivPosition);currentDivPosition=currentDivPosition+adSpacing}else self.log("not enough quotes to show "+slotDef.getSlotName())}return slotsToAdd}}};
;

/* /js/bq/BQFavorites */
var BQFavorites={init:function(){BQFavorites.makeEHs();$(document).on("Mem:Fav",BQFavorites._favChanged);$(document).on("Mem:Coll",BQFavorites._colChanged);$(document).on("Mem:Updated",BQFavorites._memberDtUpd);$(document).on("Auth:Change",BQFavorites._authStateChange)},_authStateChange:function(){if(!BQFavorites._getBQServices().isLI())BQFavorites._memberDtUpd(null,{favorites:{},collected:{}})},_memberDtUpd:function(event,eventData){try{var favorites=eventData.favorites;var collected=eventData.collected;
$("span.favHeart.bqFav").each(function(index,element){var qId=BQFavorites._findQtId($(element));BQFavorites._favChanged(null,{qId:qId,isFav:favorites[qId]})});$("span.favAddToCol.favCollectedAddToCol").each(function(index,element){var qId=BQFavorites._findQtId($(element));BQFavorites._colChanged(null,{qId:qId,isColl:collected[qId]})});for(var qId in favorites){var tile=BQFavorites._findQtElTile(qId,false);if(tile!=null)BQFavorites._setHeart(tile,true)}for(var qId in collected){var tile=BQFavorites._findQtElTile(qId,
false);if(tile!=null)BQFavorites._setColl(tile,true)}}catch(err){BQErrorLog.logError("BQF._memberDtUpd",err)}},_favChanged:function(event,eventData){var isOn=eventData.isFav;var tile=BQFavorites._findQtElTile(eventData.qId,true);if(tile!=null)BQFavorites._setHeart(tile,isOn)},_colChanged:function(event,eventData){var isOn=eventData.isColl;var isCollected=BQFavorites._getBQServices().isCollectedQuote(eventData.qId);var tile=BQFavorites._findQtElTile(eventData.qId,true);if(tile!=null)BQFavorites._setColl(tile,
isOn)},_setHeart:function(tileEl,isOn){var searchWithin=$(tileEl).closest(".bqQt");var el=searchWithin.find(".favHeart");$(el).removeClass("fa-heart bqFav fa-heart-o");if(isOn)$(el).addClass("fa-heart bqFav");else $(el).addClass("fa-heart-o")},_setColl:function(tileEl,isOn){var searchWithin=$(tileEl).closest(".bqQt");var el=searchWithin.find(".favAddToCol");$(el).removeClass("fa-plus-square favCollectedAddToCol fa-plus-square-o");if(isOn)$(el).addClass("fa-plus-square favCollectedAddToCol");else $(el).addClass("fa-plus-square-o")},
_findQtElTile:function(qId,required){try{var qsel=".b-qt.qt_"+qId;if($(qsel).length!=1)if(required)throw"Didn't find the right # of quotes for selector "+qsel+"; expected 1 got "+$(qsel).length;else return null;var parent=$(qsel).parent();return parent}catch(err){BQErrorLog.logError("BQF._findQtElTile",err)}},_getBQServices:function(){return angular.element(document.body).injector().get("bqServices")},makeEHs:function(){$(".favHeart").unbind("click",BQFavorites._heartClick);$(".favHeart").click(BQFavorites._heartClick);
$(".favAddToCol").unbind("click",BQFavorites._plusClick);$(".favAddToCol").click(BQFavorites._plusClick)},_findQtId:function(el){try{var qEl=el.closest(".bqQt").find(".b-qt");var classes=qEl.attr("class").split(/\s+/);for(var i=0;i!=classes.length;i++){var cl=classes[i];if(cl.length>3){var firstPart=cl.substring(0,3);if(firstPart=="qt_"){quoteId=parseInt(cl.substring(3));return quoteId}}}return null}catch(err){BQErrorLog.logError("BQF._findQtId",err)}},_heartClick:function(){var qId=BQFavorites._findQtId($(this));
var bqServices=BQFavorites._getBQServices();bqServices._changeFavorite(qId,"t")},_plusClick:function(){var qId=BQFavorites._findQtId($(this));var bqServices=BQFavorites._getBQServices();bqServices.showAddToCollectionModal(qId)}};
;

/* /js/angular/ctrl/ModalAddToCollectionCtrl */
BQ_APP.controller("ModalAddToCollectionCtrl",function($rootScope,$scope,$log,$modalInstance,bqServices,bqServerErrors,quoteId,toastr){bqServerErrors.clearServerErrors("collectionName");$scope.init=function(){$scope.loaded=false;var qTextElElements=bqServices.findByClass(".qt_"+$scope.quoteId);var aTextElElements=bqServices.findByClass(".qa_"+$scope.quoteId);var didCopy=false;if(qTextElElements.length>0&&aTextElElements.length>0){var qTextEl=angular.element(qTextElElements[0]);var aTextEl=angular.element(aTextElElements[0]);
if(qTextEl&&aTextEl){$scope.q_txt=qTextEl.text();$scope.q_aut=aTextEl.text();didCopy=true}}if(!didCopy)$log.error("Could not copy quote: "+$scope.quoteId+" ");var cListPromise=bqServices.getCollectionMembership($scope.quoteId);cListPromise.then(function(aResp){$scope.collectionList=aResp.data.collections;$scope.quoteCollectionMap=aResp.data.quoteCollectionMap;$scope.loaded=true;if($scope.noCollections())$scope.showAddToNew=true},function(aResp){bqServices.showAjaxError("Sorry, a problem occurred adding this quote to a collection",
aResp)})};$scope.addCollection=function(){$scope.collectionName="";$scope.addForm.$setPristine();$scope.showAddToNew=true};$scope.done=function(){$modalInstance.close()};$scope.noCollections=function(){return $scope.isLoaded()&&!(angular.isArray($scope.collectionList)&&$scope.collectionList.length>0)};$scope.isLoaded=function(){return $scope.loaded};$scope.ok=function(){$modalInstance.close()};$scope.cancel=function(){$modalInstance.dismiss("cancel")};$scope.cancelAdd=function(){$scope.showAddToNew=
false};$scope.submitAddForm=function(form){if(form.$valid){bqServerErrors.clearServerErrors("collectionName");$scope.isAddingCollection=true;bqServices.addCollection($scope.collectionName,$scope.quoteId).then(function(aResp){$scope.showAddToNew=false;$scope.init();$scope.isAddingCollection=false;$rootScope.$emit("quotesUpdated",[$scope.quoteId]);toastr.success("A quote was added to your collection!");$scope.cancel()},function(aResp){$scope.isAddingCollection=false;var hadError=bqServerErrors.handleServerErrors(aResp);
if(!hadError)bqServices.showAjaxError("Sorry, a system error occurred.",aResp)})}};$scope.handleCollectionNameChange=function(){bqServerErrors.clearServerErrors("collectionName")};$scope.hasServerError=function(fieldName,errorName){return bqServerErrors.hasServerError(fieldName,errorName)};$scope.showChecked=function(collId){return $scope.quoteCollectionMap[collId]};$scope.handleAddToCollection=function(qc_id){$scope.quoteCollectionMap[qc_id]=true;bqServices.addQuoteToCollection($scope.quoteId,qc_id).then(function(aResp){if(angular.isDefined(IS_MBL)&&
!IS_MBL)toastr.success("A quote was added to your collection!");$rootScope.$emit("quotesUpdated",[$scope.quoteId])},function(aResp){$scope.quoteCollectionMap[qc_id]=false;$rootScope.$emit("quotesUpdated",[$scope.quoteId]);bqServices.showAjaxError("Sorry, a problem occurred adding a quote to your collection.",aResp)})};$scope.handleRemoveFromCollection=function(qc_id){$scope.quoteCollectionMap[qc_id]=false;bqServices.removeQuoteFromCollection($scope.quoteId,qc_id).then(function(aResp){if(angular.isDefined(IS_MBL)&&
!IS_MBL)toastr.success("A quote was deleted from your collection.");$rootScope.$emit("quotesUpdated",[$scope.quoteId])},function(aResp){$scope.quoteCollectionMap[qc_id]=true;bqServices.showAjaxError("A problem occurred removing this quote from your collection.",aResp)})};$scope.showAddToNew=false;$scope.quoteId=quoteId;$scope.collectionList=[];$scope.loaded=false;$scope.toastr=toastr;$scope.isAddingCollection=false;$scope.q_txt="";$scope.q_aut="";$scope.init()});