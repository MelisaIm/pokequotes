// 2368191
;

/* /js/bq/advert/adframe */
var REV=true;
;

/* /js/bq/pubfood/BQPubfoodUtil */
var slotsByDivs=function(slts){var slotsByDivMap={};for(var k=0;k<slts.length;k++)slotsByDivMap[slts[k].elementId]=slts[k];return slotsByDivMap};var slotsBySlotName=function(slts){var slotsBySlName={};for(var k=0;k<slts.length;k++)slotsBySlName[slts[k].getParam("slotName")]=slts[k];return slotsBySlName};var szAryToStrAry=function(szAry){var szStrAry=[];for(var i=0;i<szAry.length;i++)try{szStrAry.push(szAry[i][0]+"x"+szAry[i][1])}catch(err){BQErrorLog.logError("sz err  ",err)}return szStrAry};
var szStringtoAry=function(szStr){var szAry;if(szStr)szAry=szStr.split("x");return szAry};var validateBidValue=function(centsVal){if(!bidCanConvertToNumber(centsVal))throw"bid !number";if(centsVal<0)throw"bid \x3c 0";if(centsVal>4E3)throw"bid \x3e 4000";};var adjustCentsBidM1=function(bid){if(bid<0)bid=0;if(bid>4E3)bid=4E3;if(bid<2E3)bid=Math.floor(bid/10)*10;if(bid>2E3)bid=Math.floor(bid/100)*100;return bid};
var adjustCentsYieldBot=function(bid){if(bid<100)bid=0;else if(bid>800)bid=800;else bid=Math.floor(bid/10)*10;return bid};var floatToCentsInteger=function(fbid){return 100*Math.round(parseFloat(fbid)*100)/100};var bqRoundD=function(rawV){var retV=0;if("undefined"!==typeof rawV){retV=rawV;var rndV=10;if(retV>3)rndV=2;if(retV>10)rndV=1;retV=Math.round(retV*rndV)/rndV;if(retV>40)retV=40}return retV};function bidCanConvertToNumber(n){return!isNaN(parseFloat(n))&&isFinite(n)}
var bqRoundC=function(rawV){var retV=0;if("undefined"!==typeof rawV){retV=bqRoundD(rawV/100);retV=Math.round(retV*100)}return retV};var bqMillRound=function(dollars){var rval=Math.round(dollars*1E3)/1E3;return rval};var bqDollarFloorToCents=function(price){var bval=Math.floor(price*10)*10;if(bval>2E3)bval=Math.floor(bval/100)*100;if(bval>4E3)bval=4E3;return bval};
var bqRoundScore=function(score){var retV=0;if("undefined"!==typeof score)if(score>0)if(score<200)retV=Math.round(score/20)*20;else if(score<500)retV=Math.round(score/50)*50;else{retV=Math.round(score/200)*200;if(retV>2E3)retV=2E3}return retV};var bqCpmFromBid=function(val){var floor;var inc=5;if(val>100)if(val>500)inc=50;else inc=10;floor=Math.round(val/inc)*inc;floor=Math.min(floor,2E3);return floor};var getRandomInt=function(min,max){return Math.floor(Math.random()*(max-min+1))+min};
var shuffleArray=function(array){for(var i=array.length-1;i>0;i--){var j=getRandomInt(0,i);var temp=array[i];array[i]=array[j];array[j]=temp}return array};var currentDyTm=function(){var nowD=new Date;var tod=6*Math.floor(nowD.getHours()/6);return nowD.getDay()+"_"+tod};var bqLoad=function(libUrl){bqLoadWithCallback(libUrl,null)};
var bqLoadWithCallback=function(libUrl,cb){var scriptTag=document.createElement("script");scriptTag.setAttribute("src",libUrl);scriptTag.setAttribute("type","text/javascript");if(cb)scriptTag.onload=cb;scriptTag.async=true;var firstScript=document.getElementsByTagName("script")[0];if(firstScript.parentNode)firstScript.parentNode.insertBefore(scriptTag,firstScript)};var calcFloorDollars=function(pred,ratio,radix){var fl=.05;if(pred){fl=ratio*pred;fl=Math.round(fl*100)/100}return fl};
var calcFloorMillis=function(pred,ratio){var fl=50;if(pred){fl=ratio*pred;fl=Math.round(fl*1E3)}return fl};var bqGetBestAd=function(ads){var ad;if(ads&&ads.length>1){var sads=ads.sort(function(ad1,ad2){return(ad2.cpm||0)-(ad1.cpm||0)});ad=sads[0]}else if(ads.length==1)ad=ads[0];return ad};
var bqFilterSizes=function(allSizes,limitToSizes){var limitedSizes=[];for(var i=0;i<allSizes.length;i++)for(var j=0;j<limitToSizes.length;j++){var sz1=allSizes[i];var sz2=limitToSizes[j];if(sz1[0]==sz2[0]&&sz1[1]==sz2[1]){limitedSizes.push(sz1);break}}return limitedSizes};
;

/* /js/bq/advertising/BQPageVars */
var BQPageVars=function(evHandler,isMobile,userAgent,delayed){this._init(evHandler,isMobile,userAgent,delayed)};BQPageVars.prototype={_init:function(evHandler,isMobile,userAgent,delayed){this.pageVars={};this.pageVars.evHandler=evHandler;this.pageVars.isMobile=isMobile;this.pageVars.userAgent=userAgent;this.pageVars.delayed=delayed},getVar:function(varName){return this.pageVars[varName]},setVar:function(varName,value){this.pageVars[varName]=value},isMobile:function(){return this.pageVars.isMobile}};
;

/* /js/bq/advertising/BQAdConfig */
var BQAdConfig=function(config,pageVars){this._init(config,pageVars)};
BQAdConfig.prototype={_init:function(config,pageVars){this.data=config;this.pageVars=pageVars;this.hbOnly=null;this.plList=[];this.plByDivId=[];this.useAFloors=true;this.allEnabledBidders={};var isHTTPS="https:"===document.location.protocol;var didRemove=false;var removed={};for(var i=0;i!==this.data.placements.length;i++){var plData=this.data.placements[i];var pl=new BQAdPlacement(plData,this.pageVars);this.plByDivId[pl.get("elementId")]=pl;this.plList.push(pl);var bidderkeys=pl.getBKeys();var only=
CookieUtil.getPreference("onlybdr");for(var bk=0;bk!==bidderkeys.length;bk++){var bidderKey=bidderkeys[bk];var bidder=pl.getBidder(bidderKey);if(bidder.get("nossl")&&isHTTPS||only&&only!==bidderKey){didRemove=true;removed[bidderKey]=true;pl.removeBidder(bidderKey)}else this.allEnabledBidders[bidderKey]=1}}if(didRemove){konsole.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");
konsole.log("Bidders for page    :",JSON.stringify(this.allEnabledBidders));konsole.log("Disqualified bidders:",JSON.stringify(removed));konsole.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d")}delete this.data.placements},getAllBidderNames:function(){return Object.keys(this.allEnabledBidders)},
addBDNames:function(bnames){bnames.push("control");bnames.push("adxonly");bnames.push("adxonlynofloors");bnames.push("hbonly");bnames.push("nofloors")},getProCfg:function(providerName){var result={};if(this.data.procfg[providerName])result=this.data.procfg[providerName];return result},hasBidder:function(bidderName){return bidderName in this.allEnabledBidders},findPlByDiv:function(divId){return this.plByDivId[divId]},getPlacements:function(){return this.plList},get:function(key){return this.data[key]},
set:function(key,value){this.data[key]=value;return this},getTValue:function(bid){var tv=null;if(bid&&bid.targeting){var t=bid.targeting;tv=t.hb_pb||t.hb_pf_bid||t.hb_svrn_bid||t.ybot_cpm||t.hbpb||t.sbi_mouse||t.hb_pp_bid;if(!tv)for(var key in t)if(t.hasOwnProperty(key))if(key.length>2&&key.substring(0,2)==="ox")tv=t[key];if(t.aolbid&&t.aolbid.length>0)tv=t.aolbid[0]}return tv},removeBidderFromPlacements:function(bidder){var plcmnts=this.getPlacements();for(var plIdx=0;plIdx<plcmnts.length;plIdx++){var pl=
plcmnts[plIdx];if(pl.hasBidder(bidder))pl.removeBidder(bidder)}if(this.allEnabledBidders[bidder])delete this.allEnabledBidders[bidder]},removeAllBiddersFromPlacements:function(){for(var bidder in this.allEnabledBidders)if(this.allEnabledBidders.hasOwnProperty(bidder))this.removeBidderFromPlacements(bidder)},disableAFloors:function(){this.useAFloors=false},setHBOnly:function(){this.hbOnly="adxsetting"},aFloorEnabled:function(){return this.useAFloors},setHardFlr:function(flr){this.hardFlr=flr},getHardFlr:function(){return this.hardFlr}};
;

/* /js/bq/advertising/BQAdPlacement */
var BQAdPlacement=function(config,pageVars){this.data=config;this.pageVars=pageVars};
BQAdPlacement.prototype={get:function(key){return this.data[key]},set:function(key,value){this.data[key]=value;return this},getBiddersForPl:function(){var bidderNames=[];var keys=this.getBKeys();var tuples=[];for(var i=0;i!==keys.length;i++){var bn=keys[i];if(this.hasBidder(bn))tuples.push([bn,this.getBData(bn).si])}tuples.sort(function(a,b){a=a[1];b=b[1];return a<b?-1:a>b?1:0});var sBidderNames=[];for(var n=0;n!==tuples.length;n++)sBidderNames.push(tuples[n][0]);return sBidderNames},removeBidder:function(key){delete this.data.bdrs[key]},
getBKeys:function(){return Object.keys(this.data.bdrs)},getBData:function(key){return this.data.bdrs[key]},hasBidder:function(key){return this.getBData(key)},getBidder:function(key){var bidderData=this.getBData(key);if(bidderData)return new BQAdPlacementBidder(key,bidderData,this.pageVars);return null}};
;

/* /js/bq/advertising/BQAdPlacementBidder */
var BQAdPlacementBidder=function(name,config,pageVars){this.bdrName=name;this.data=config;this.pageVars=pageVars};BQAdPlacementBidder.prototype={getBdrName:function(){return this.bdrName},get:function(key){var val=this.data[key];var evH=this.pageVars.getVar("evHandler");if(val&&evH)val=evH.getBidderOvr(this.getBdrName(),key,val,this.pageVars.isMobile());return val},set:function(key,value){this.data[key]=value;return this}};
;

/* /js/bq/advertising/BQAdTargeting */
var BQAdTargeting=function(bqAdConfig,lowRatio,highRatio,bkts,maxBds,mxBdPercent,pfslots){this._init(bqAdConfig,lowRatio,highRatio,bkts,maxBds,mxBdPercent,pfslots)};
BQAdTargeting.prototype={_init:function(bqAdConfig,lowRatio,highRatio,bkts,maxBds,mxBdPercent,pfslots){this.bqAdConfig=bqAdConfig;this.bkts=bkts;this.maxBds=maxBds;this.mxBdPercent=mxBdPercent;this.pfslots=pfslots;this._setup(lowRatio,highRatio)},log:function(msg){var self=this;if(self.bqAdConfig.get("logOn")){var newArgs=["[ BQAdTargeting ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},_setup:function(lowRatioIn,highRatioIn){var self=
this;var highRatio=Math.max(lowRatioIn,highRatioIn);var randRange=Math.round((highRatio-lowRatioIn)/5);var rnd=0;if(randRange>0)rnd=getRandomInt(0,randRange);this.flrPercent=rnd*5+lowRatioIn;this.adTMap={};self.log("pfslots",self.pfslots);for(var pfi=0;pfi<self.pfslots.length;pfi++){var pfSlot=self.pfslots[pfi];self.log("processing slot",pfSlot);var placement=pfSlot.getParam("placement");self.log("processing slot placement",placement);var predDivId=placement.get("elementId");self.log("predDivId",
predDivId);var bktDivId=pfSlot.elementId;self.log("bktDivId",bktDivId);if(this.bkts.hasOwnProperty(predDivId)){this.adTMap[bktDivId]={};var rawP=this.bkts[predDivId];var roundBkt=bqRoundD(rawP);this.adTMap[bktDivId].valP=roundBkt;var pflr=bqRoundD(rawP*this.flrPercent/100);this.adTMap[bktDivId].pflr=pflr;if(this.maxBds&&this.maxBds[bktDivId])this.adTMap[bktDivId].maxb=this.maxBds[bktDivId];else this.adTMap[bktDivId].maxb=0;this.adTMap[bktDivId].maxb_bkt=bqRoundD(this.adTMap[bktDivId].maxb/100);this.adTMap[bktDivId].maxb_amp_bkt=
bqRoundD(this.adTMap[bktDivId].maxb*(this.mxBdPercent/100)/100);this.adTMap[bktDivId].flr=Math.max(this.adTMap[bktDivId].pflr,this.adTMap[bktDivId].maxb_amp_bkt);var hflr=self.bqAdConfig.getHardFlr();this.adTMap[bktDivId].hflr=hflr;var hardFlrCents=bqRoundD(hflr/100);this.adTMap[bktDivId].flr=Math.max(this.adTMap[bktDivId].flr,hardFlrCents);if(this.bqAdConfig.get("logOn")){var flDtl={};flDtl.max=this.adTMap[bktDivId].maxb;flDtl["max bucket"]=this.adTMap[bktDivId].maxb_bkt;flDtl["max percent"]=this.mxBdPercent;
flDtl["max amp bucket"]=this.adTMap[bktDivId].maxb_amp_bkt;flDtl["pflr bucket"]=this.adTMap[bktDivId].pflr;flDtl["hflr bucket"]=this.adTMap[bktDivId].hflr;flDtl["final bucket"]=this.adTMap[bktDivId].flr;self.log("flr detail for "+bktDivId,flDtl)}}else throw"could not find prediction data for div "+predDivId+" in "+JSON.stringify(this.bkts);}},getPValue:function(bktDivId){return this.adTMap[bktDivId].valP},getFlr:function(bktDivId){return this.adTMap[bktDivId].flr},getHardFlr:function(bktDivId){return this.adTMap[bktDivId].hflr},
getMaxBd:function(bktDivId){return this.adTMap[bktDivId].maxb},getMaxBdBkt:function(bktDivId){return this.adTMap[bktDivId].maxb_bkt},getFloorPercent:function(){return this.flrPercent}};
;

/* /js/bq/advertising/BQAdCtrl */
var BQAdCtrl=function(bqAdConfig,bqPageVars,bqPred,gaTimings,evH){this._init(bqAdConfig,bqPageVars,bqPred,gaTimings,evH)};
BQAdCtrl.prototype={_init:function(bqAdConfig,bqPageVars,bqPred,gaTimings,evH){this.bqAdConfig=bqAdConfig;this.bqPv=bqPageVars;this.bqPred=bqPred;this.gaTimings=gaTimings;this.slotMgr=new BQSlotMgr(bqAdConfig,bqPageVars);this.mainAuction=new BQAuctionCtrl(bqAdConfig,bqPageVars,this.slotMgr,"main",1);this.auctionMap={"main":this.mainAuction};this.auctionQueue=[];this.evH=evH;this.refreshAuctCreated=0;this.footerSlots=null;this.setupHardFlrs()},log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=
["[ BQAdCtrl ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},setupHardFlrs:function(){var self=this;var hardFlr=0;if(cc=="US"){var usDrp=self.bqPv.getVar("usDrp");if(usDrp)hardFlr=usDrp}else{var intlDrp=self.bqPv.getVar("intlDrp");if(intlDrp)hardFlr=intlDrp}self.bqAdConfig.setHardFlr(hardFlr)},queueFooterAuction:function(){var self=this;if(self.footerSlots!==null){self.log("++ All pages loaded, kicking off delayed footer auction");
self.addSlotsAndRun(self.footerSlots);self.footerSlots=null}},createRefreshAuction:function(auctionId){var self=this;var auction=self.auctionMap[auctionId];if(typeof auction==="undefined"){self.log("getAuctionById",auctionId);var auctionNum=2+self.refreshAuctCreated;self.refreshAuctCreated=self.refreshAuctCreated+1;auction=new BQAuctionCtrl(self.bqAdConfig,self.bqPv,this.slotMgr,auctionId,auctionNum);self.log("auction",auction);self.auctionMap[auctionId]=auction;self.auctionQueue.push(auction);self.log("self.auctionMap",
self.auctionMap);self.log("self.auctionQueue",self.auctionQueue)}else throw"Auction already exists for id "+auctionId;return auction},getAuctionById:function(auctionId){var self=this;var auction=self.auctionMap[auctionId];return auction},getRefreshAuction:function(){var self=this;return self.refreshAuction},addSlotInstances:function(slotInstances){var self=this;for(var i=0;i<slotInstances.length;i++){var slotInstance=slotInstances[i];var auctionId=slotInstance.getAuctionId();var auctCtrl=self.getAuctionById(auctionId);
var divId=slotInstance.getUniqueDivId();self.log("slot divId",divId);if($("#"+divId)==null){var msg="Invalid BQSlotInstance object. Unique div id "+divId+" yet this div does not appear on the page";throw msg;}if(typeof auctCtrl==="undefined")auctCtrl=self.createRefreshAuction(auctionId);auctCtrl.addSlotDivCombo(slotInstance)}},addSlotsAndRun:function(slotInstances){var self=this;if(slotInstances&&slotInstances.length>0){self.addSlotInstances(slotInstances);self.runIfIdle()}},setFooterSlots:function(slotInstances){var self=
this;self.footerSlots=slotInstances},setupLogging:function(){var self=this;if(self.bqPv.getVar("bqbids"))CookieUtil.setPreference("bqbids","1");else CookieUtil.setPreference("bqbids","");if(self.bqAdConfig.get("logOn"))CookieUtil.setPreference("tracelog","on");else CookieUtil.setPreference("tracelog","off")},_pfSlot:function(pfSlotName,divId,placement){var self=this;var slotName=placement.get("name");var bidders=placement.getBiddersForPl();if(self.bqAdConfig.get("logOn")){konsole.log(" --------------------------------------------------");
konsole.log("elementId           \x3d ",divId);konsole.log("pfSlot                \x3d ",pfSlotName);konsole.log("slot                \x3d ",slotName);konsole.log("hbSizes             \x3d ",JSON.stringify(placement.get("hbSizes")));konsole.log("sizes               \x3d ",JSON.stringify(placement.get("sizes")));konsole.log("bidders (unsorted)    \x3d ",bidders)}var keys=placement.getBKeys();for(var kidx=0;kidx!=keys.length;kidx++){var key=keys[kidx];if(self.bqAdConfig.get("logOn"))konsole.log("bdr."+
key,JSON.stringify(placement.getBData(key)))}var slot=self.pf.addSlot({name:pfSlotName,sizes:placement.get("hbSizes"),elementId:divId,bidProviders:bidders});slot.setParam("placement",placement);slot.setParam("slotName",slotName);return slot},_createPfSlots:function(auctionId,slotInstances){var self=this;var allPlacements=self.bqAdConfig.getPlacements();var allPfSlots=[];if(self.bqAdConfig.get("logOn"))konsole.log("All bidders for this page (unsorted) \x3d ",self.bqAdConfig.getAllBidderNames());var plLookup=
{};for(var p=0;p<allPlacements.length;p++){var placement=allPlacements[p];plLookup[placement.get("name")]=placement}for(var q=0;q<slotInstances.length;q++){var slotInst=slotInstances[q];if(slotInst.getAuctionId()==auctionId){var placement=plLookup[slotInst.getSlotName()];var slot=self._pfSlot(placement.get("name"),placement.get("elementId"),placement);allPfSlots.push(slot);if(self.bqAdConfig.get("logOn"))konsole.log(" --------------------------------------------------")}}return allPfSlots},createPubfood:function(slotInstances){var self=
this;var pfArgs={auctionProviderCbTimeout:self.bqAdConfig.get("auctionTimeout"),bidProviderCbTimeout:self.bqAdConfig.get("timeout"),randomizeBidRequests:false};if(self.bqAdConfig.get("logOn"))konsole.log("pubfood args",pfArgs);self.pf=new pubfood(pfArgs);self.pf.omitDefaultBidKey(true);var allPfSlots=self._createPfSlots("main",slotInstances);if(self.bqAdConfig.get("logOn"))konsole.log("allPfSlots",allPfSlots);self.pf.timeout(self.bqPv.getVar("pubfood_timeout"));var pfst=(new Date).getTime();self.pf.observe(function(ev){var evtts=
(new Date).getTime();if(self.bqAdConfig.get("logOn"))konsole.log("bqAds event at "+(evtts-pfst)+" ms",ev);JsLOG.push("bqAds event: "+JSON.stringify(ev))});self.pf.observe("AUCTION_COMPLETE",function(ev){if(ev.annotations.auctionType.type=="init")self.mainAuction.runPostAuctionCmds();else{var auctCtrl=self.refreshAuction;self.refreshAuction=null;auctCtrl.runPostAuctionCmds()}});return self.pf},configureBdrp:function(){var self=this;var thr=CookieUtil.getRndGroup();var drpP=self.bqPv.getVar("drpP");
if(drpP>=thr){var bnames=self.bqAdConfig.getAllBidderNames();self.bqAdConfig.addBDNames(bnames);var bname;if(self.bqPv.getVar("forcebdrp"))bname=self.bqPv.getVar("forcebdrp");else bname=CookieUtil.getBdrDrp();if(!bname){var bidx=getRandomInt(0,bnames.length-1);bname=bnames[bidx]}if(self.bqAdConfig.get("logOn"))konsole.log("bdrp\x3d",bname);if(bname==="adxonlynofloors"||bname=="nofloors"){self.bqAdConfig.disableAFloors();self.evH.noFlr()}if(bname==="adxonly"||bname==="adxonlynofloors")self.bqAdConfig.removeAllBiddersFromPlacements();
else if(bname==="hbonly")self.bqAdConfig.setHBOnly();else if(bname!=="control")self.bqAdConfig.removeBidderFromPlacements(bname);self.bqAdConfig.bidderRem=bname;CookieUtil.setBdrDrp(bname)}},configureBidders:function(){var self=this;try{var bidderMap={};if(self.bqAdConfig.hasBidder("openx"))bidderMap["openx"]=new OpenXBidderLite(self.pf,self.bqAdConfig,self.bqPred,true);if(self.bqAdConfig.hasBidder("indexExchange"))bidderMap["indexExchange"]=new IdxOpenRTB(self.pf,self.bqAdConfig,self.bqPred);if(self.bqAdConfig.hasBidder("yieldbot"))bidderMap["yieldbot"]=
new YieldbotBidder(self.pf,self.bqAdConfig,false);if(self.bqAdConfig.hasBidder("amazon"))if(self.bqPv.getVar("a9SlotBidder"))bidderMap["amazon"]=new A9SlotBidder(self.pf,self.bqAdConfig);else bidderMap["amazon"]=new AmazonBidder(self.pf,self.bqAdConfig);if(self.bqAdConfig.hasBidder("appnexus"))bidderMap["appnexus"]=new AppNexusDirectBidder(self.pf,self.bqAdConfig,self.bqPred);if(self.bqAdConfig.hasBidder("sovrn"))bidderMap["sovrn"]=new SovrnBidder(self.pf,self.bqAdConfig,self.bqPred);if(self.bqAdConfig.hasBidder("aol"))bidderMap["aol"]=
new AOLFlooringBidder(self.pf,self.bqAdConfig,self.bqPred,self.bqPv.getVar("aolTag"));if(self.bqAdConfig.hasBidder("brealtime"))bidderMap["brealtime"]=new BRealTimeBidder(self.pf,self.bqAdConfig,self.bqPred);if(self.bqAdConfig.hasBidder("conversant"))bidderMap["conversant"]=new CnvBidder(self.pf,self.bqAdConfig,self.bqPred,self.bqPv);if(self.bqAdConfig.hasBidder("defy"))bidderMap["defy"]=new DefyBidder(self.pf,self.bqAdConfig,self.bqPred);if(self.bqAdConfig.hasBidder("districtm"))bidderMap["districtm"]=
new DistrictMBidder(self.pf,self.bqAdConfig,self.bqPred);if(self.bqAdConfig.hasBidder("rubicon"))bidderMap["rubicon"]=new RubiconFastlaneBidder(self.pf,self.bqAdConfig,self.bqPred,true);if(self.bqAdConfig.hasBidder("criteo"))bidderMap["criteo"]=new CriteoBidder(self.pf,self.bqAdConfig,self.bqPred);self.biddersToRun=self.evH.sortedBidders(bidderMap);self.log("biddersToRun",self.biddersToRun);self.headLoad=+new Date}catch(err){BQErrorLog.logError("configureBidders:  ",err)}},createAuction:function(evH,
pfConfig){var self=this;var auction=new GoogleAuction(self.pf,self.bqAdConfig,self.bqPv,evH,self.slotMgr,pfConfig);auction.create()},isADB:function(){return self.bqPv.getVar("abd")==true},start:function(){var self=this;try{if(self.isADB())return;if(self.biddersToRun.length>0)for(var bd=0;bd!=self.biddersToRun.length;bd++){var thisBidder=self.biddersToRun[bd];thisBidder.go()}else self.pf.addBidProvider({name:"adxonly",libUri:" ",init:function(slots,pushBid,done){done()},refresh:function(slots,pushBid,
done){}});var onStart=function(hasErrors,details){if(hasErrors)throw details;else if(self.bqAdConfig.get("logOn"))konsole.log("bqAds started without errors")};var now=+new Date;if(self.bqAdConfig.get("logOn"))konsole.log("pubfood starting after",(now-self.headLoad)/1E3+"s");self.gaTimings.pfStarted(self.headLoad,now,self.pf);self.tracking=new BQTracking(self.pf,self.bqAdConfig,self.bqPv);self.pf.addBidTransform(function(rawbids,params){var nestedself=self;nestedself.log("bid transform called",params);
var allbids=rawbids.slice(0);var prunedbids=nestedself._transformBids(rawbids,params);nestedself.tracking.trackBids(allbids);return prunedbids});self.pf.start(now,onStart);self.lastAuctionTs=now}catch(err){BQErrorLog.logError("startPubfood:  ",err)}},_transformBids:function(bids,params){var self=this;self.log("_transformBids ",bids);var bidsFloored=[];var hardFlr=self.bqAdConfig.getHardFlr();for(var i=0;i<bids.length;i++){var incl=true;var b=bids[i];if(b.value)if(hardFlr>0&&b.value<hardFlr){self.log("_transformBids drp "+
hardFlr,b);incl=false}if(incl){b.dropped=false;bidsFloored.push(b)}else b.dropped=true}return bidsFloored},updatePredictions:function(){var self=this;var bqLastScStr=self.bqPv.getVar("last_score_str");self.bqPred.updateForAuctionData(self.currentAuctionNum,bqLastScStr)},lastAuctionFinished:function(){var self=this;self.runRefreshAuctions()},runIfIdle:function(){var self=this;if(self.refreshAuction)self.log("already running an auction");else if(self.mainAuction.auctionCmdsRan)self.runRefreshAuctions();
else self.log("main auction still running")},runRefreshAuctions:function(){var self=this;var auctCtrl;if(self.auctionQueue.length>0){self.log("popping first from auctionQueue",self.auctionQueue);var auctCtrl=self.auctionQueue.pop();self.log("auctCtrl",auctCtrl);auctCtrl.createSlots(auctCtrl.getAuctionId());self.currentAuctionNum=auctCtrl.getAuctionNum();self._runRefreshAuction(auctCtrl)}else self.log("done with runRefreshAuctions")},_runRefreshAuction:function(auctCtrl){var self=this;if(self.refreshAuction)throw"Cannot run two refresh auctions concurrently";
if(self.mainAuction==auctCtrl)throw"Cannot run main auction as refresh";var auctionId=auctCtrl.getAuctionId();self.log("running refresh auction "+auctionId);self.updatePredictions();var slotAry=[];var slotNames=[];for(var plIdx=0;plIdx<self.bqAdConfig.plList.length;plIdx++){var placement=self.bqAdConfig.plList[plIdx];var slotName=placement.get("name");var multipleUnits=auctCtrl.getSlotInstanceMap();self.log("auctionId "+auctionId+" : multipleUnits "+multipleUnits);if(multipleUnits[slotName]){var slotInst=
multipleUnits[slotName];var slot;if(slotInst.getRefreshExistingSlot()){var slName=slotName;var slotName=placement.get("name");slot=self.pf.getSlot(slotName);if(slot==null)throw"Could not find slot with name "+slotName;self.log("reusing slot ",slot)}else{var slName=slotName+"_"+auctionId;var divName=placement.get("elementId")+"-"+auctionId;slot=self._pfSlot(slName,divName,placement);self.log("not reusing slot ",slot)}slotAry.push(slot);slotNames.push(slName)}}self.log("refreshing slots",slotAry);self.refreshAuction=
auctCtrl;self.pf.refresh(slotNames)},refreshAnchorAd:function(interval,slotInstance){var self=this;if(self.isADB())return;if(typeof self.lastAuctionTs==="undefined")throw"Refresh called before first auction run";var now=+new Date;var secSinceRefresh=(now-self.lastAuctionTs)/1E3;self.log("refreshAnchorAd secSinceRefresh",secSinceRefresh);self.log("refreshAnchorAd interval",interval);if(secSinceRefresh<interval)self.log("Skipping refresh, last refresh only "+secSinceRefresh+" seconds ago");else{self.lastAuctionTs=
now;self.log("refreshAnchorAd");var auctionId=slotInstance.getAuctionId();var auctCtrl=self.getAuctionById(auctionId);if(typeof auctCtrl==="undefined")auctCtrl=self.createRefreshAuction(auctionId);else throw"Auction already exists with id "+auctionId;auctCtrl.addSlotDivCombo(slotInstance);self.runIfIdle()}}};
;

/* /js/bq/advertising/BQAuctionCtrl */
var BQAuctionCtrl=function(bqAdConfig,bqPageVars,bqSlotMgr,auctionId,auctionNum){this._init(bqAdConfig,bqPageVars,bqSlotMgr,auctionId,auctionNum)};
BQAuctionCtrl.prototype={_init:function(bqAdConfig,bqPageVars,bqSlotMgr,auctionId,auctionNum){this.bqPv=bqPageVars;this.bqAdConfig=bqAdConfig;this.bqSlotMgr=bqSlotMgr;this.slotsToDisplay=[];this.postAuctionCmds=[];this.auctionCmdsRan=false;this.auctionId=auctionId;this.auctionNum=auctionNum;this.slotInstanceMap={}},log:function(msg){var self=this;if(self.bqAdConfig.get("logOn")){var newArgs=["[ BQAuctionCtrl - "+self.auctionId+" - ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);
konsole.log.apply(konsole,newArgs)}},getSlotInstanceMap:function(){var self=this;return self.slotInstanceMap},getAuctionNum:function(){var self=this;return self.auctionNum},getAuctionId:function(){var self=this;self.log("getAuctionId");self.log("self.auctionId",self.auctionId);return self.auctionId},createSlots:function(auctionId){var self=this;try{self.log("creating slots for auction ",auctionId);googletag.cmd.push(function(){for(var plIdx=0;plIdx<self.bqAdConfig.plList.length;plIdx++){var plData=
self.bqAdConfig.plList[plIdx].data;if(self.slotInstanceMap[plData.name]){var divId=self.slotInstanceMap[plData.name].getUniqueDivId();self.log("creating slots for div id  "+divId);var collapse=true;if(typeof plData["collapse"]==="boolean")collapse=plData["collapse"];self.bqSlotMgr.createSlotForDiv(plData.name,plData.sizes,divId,collapse)}}})}catch(err){BQErrorLog.logError("define slots err ",err)}},slotReadyToShow:function(slot){var self=this;self.log("slotReadyToShow for auction "+self.auctionId);
if(self.auctionCmdsRan)googletag.cmd.push(function(){self.log("slot event: refresh for slot div ",slot.getSlotElementId());googletag.pubads().refresh([slot])});else self.slotsToDisplay.push(slot)},showReadySlots:function(){var self=this;self.log("showReadySlots");if(self.slotsToDisplay.length>0){self.log("Showing "+self.slotsToDisplay.length+" slots");for(var i=0;i<self.slotsToDisplay.length;i++){var s=self.slotsToDisplay[i];self.log("Slot: ",s)}googletag.cmd.push(function(){googletag.pubads().refresh(self.slotsToDisplay);
self.slotsToDisplay=[]})}else self.log("No slots ready to show for auction "+self.auctionId)},displayAdDiv:function(slot,div,edgeDiv){var self=this;self.log("display called for div ",div);try{googletag.cmd.push(function(){googletag.display(div)});self.log("+++++++ Ad "+div+" is nearly/actually visible");self.slotReadyToShow(slot)}catch(err){BQErrorLog.logError("displayAdDiv",err)}},addSlotDivCombo:function(slotInstance){var self=this;var slotName=slotInstance.getSlotName();var divId=slotInstance.getUniqueDivId();
var edgeDiv=slotInstance.getEdgeDivId();self.slotInstanceMap[slotName]=slotInstance;self.log("postAuctionCmd for div",divId);self.postAuctionCmd(function(){self.log("Displaying div at",+new Date);self.log("Displaying div",divId);var slot=self.bqSlotMgr.getSlotForDiv(divId);self.log("getSlotForDiv "+divId,slot);self.displayAdDiv(slot,divId,edgeDiv)})},postAuctionCmd:function(func){var self=this;if(self.auctionCmdsRan)throw"Illegal state, function queued after auction already ran";self.log("adding cmd to queue");
self.postAuctionCmds.push(func)},runPostAuctionCmds:function(){var self=this;self.log("runPostAuctionCmds");if(self.auctionCmdsRan)throw"Illegal state, runPostAuctionCmds already ran";for(var i=0;i<self.postAuctionCmds.length;i++){var f=self.postAuctionCmds[i];f()}self.showReadySlots();self.auctionCmdsRan=true;adCtrl.lastAuctionFinished()}};
;

/* /js/bq/advertising/BQAuctionTargeting */
var BQAuctionTargeting=function(bqAdConfig,bqPv,pf,pfConfig,bqPredMgr,slotMgr,targeting,slotidx,auctionId){this._init(bqAdConfig,bqPv,pf,pfConfig,bqPredMgr,slotMgr,targeting,slotidx,auctionId)};
BQAuctionTargeting.prototype={_init:function(bqAdConfig,bqPv,pf,pfConfig,bqPredMgr,slotMgr,targeting,slotidx,auctionId){this.bqAdConfig=bqAdConfig;this.bqPv=bqPv;this.pf=pf;this.pfConfig=pfConfig;this.bqPredMgr=bqPredMgr;this.slotMgr=slotMgr;this.targeting=targeting;this.slotidx=slotidx;this.auctionId=auctionId;this.pfMaxBd={};this.pageVal=0},log:function(msg){var self=this;if(self.bqAdConfig.get("logOn")){var newArgs=["[ BQAuctionTargeting - auction #"+self.slotidx+" - ] ------\x3e"];for(var i=0;i<
arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},_processPageTargeting:function(pageTargeting){var self=this;for(var key in pageTargeting.targeting)if(pageTargeting.targeting.hasOwnProperty(key)){var pageTargetVal=""+pageTargeting.targeting[key];self.log("Setting page level targeting",key+":"+pageTargetVal);googletag.pubads().setTargeting(key,pageTargetVal)}},_processSlotTargeting:function(tgtObject){var self=this;self.log("getting slot",tgtObject);var gptslot=
self.slotMgr.getSlotForDiv(tgtObject.elementId);self.log("got slot",gptslot);if(!(typeof gptslot==="undefined")){for(var key in tgtObject.targeting)if(tgtObject.targeting.hasOwnProperty(key)){var targetVal=""+tgtObject.targeting[key];gptslot.setTargeting(key,targetVal);self.log("Setting slot level targeting for "+tgtObject.elementId,key+":"+targetVal)}self.log("done with targeting",tgtObject);try{var bidVal=0;if(tgtObject.bids)for(var bidI=0;bidI<tgtObject.bids.length;bidI++){var bid=tgtObject.bids[bidI];
try{if(bid.value&&bid.value!==""){if(Math.floor(bid.value)!==bid.value)throw"bid !int";validateBidValue(bid.value);if(bid.value>bidVal)bidVal=bid.value}}catch(err){JsLOG.push("bad bidData\x3d"+JSON.stringify({provider:bid.provider,divId:tgtObject.elementId,bid:bid}));BQErrorLog.logError(err.message+":"+bid.provider,err)}}self.log(tgtObject.elementId+" max bid",bidVal);self.pfMaxBd[tgtObject.elementId]=bidVal;self.pageVal=self.pageVal+bidVal}catch(err){BQErrorLog.logError("Error logging bid",err)}}else self.log("Targeting error, no slot found for slot "+
tgtObject.elementId)},_targetSlots:function(targeting){var self=this;var i;self.log("processing targeting",targeting);var slotLookup=slotsByDivs(self.pf.getSlots());var pfslots=[];for(i=0;i<targeting.length;i++){var tgtObject=targeting[i];if(tgtObject.name){var pfslot=slotLookup[tgtObject.elementId];pfslots.push(pfslot);self._processSlotTargeting(tgtObject)}else{self.log("processing page bid",tgtObject);self._processPageTargeting(tgtObject)}}return pfslots},_setupSlots:function(pfslots){var self=
this;self.log("_setupFloors called");var allData=self.bqPredMgr.getPredData();var bkts=allData.preds;var baseline=allData.baseline;self.log("pfslots",pfslots);self.log("bkts",bkts);self.log("baseline",baseline);var auctType="main";self.expPageVal=0;self.baselinePageVal=0;if(self.slotidx!=1)auctType="refresh";var bqAdT=new BQAdTargeting(self.bqAdConfig,self.pfConfig.getLowRatio(),self.pfConfig.getHighRatio(),bkts,self.pfMaxBd,self.pfConfig.getMxBdPercent(),pfslots);var flrPercent=bqAdT.getFloorPercent();
for(var pfi=0;pfi<pfslots.length;pfi++){var pfSlot=pfslots[pfi];self.log("processing floors for slot",pfSlot);var placement=pfSlot.getParam("placement");self.log("processing floors for placement",placement);var predDivId=placement.get("elementId");var bktDivId=pfSlot.elementId;var valN=bqAdT.getPValue(bktDivId);self.expPageVal=self.expPageVal+valN;self.baselinePageVal=self.baselinePageVal+baseline[predDivId];var dfpslot=self.slotMgr.getSlotForDiv(bktDivId);var isBs="n";var mb=bqAdT.getMaxBd(bktDivId);
self.log("bqAdT.getMaxBd("+bktDivId+")",mb);var mbBkt=bqAdT.getMaxBdBkt(bktDivId);if(mb>0)isBs="y";var valP=valN.toString();var flrV="0";var hflrV="0";if(self.bqAdConfig.aFloorEnabled()){flrV=bqAdT.getFlr(bktDivId).toString();self.log("adx floors enabled with value",flrV);hflrV=bqAdT.getHardFlr(bktDivId).toString();self.log("hard floors set to value",hflrV)}else self.log("adx floors disabled");dfpslot.setTargeting("bq_slotidx",self.slotidx);dfpslot.setTargeting("bq_valp",valP);if(self.bqAdConfig.get("test_group")==
"a")dfpslot.setTargeting("bq_grp_a_bkt",flrV);else dfpslot.setTargeting("bq_grp_b_bkt",flrV);dfpslot.setTargeting("bq_bkt",flrV);dfpslot.setTargeting("bq_hflr",hflrV);dfpslot.setTargeting("bq_bkt_percent",flrPercent.toString());dfpslot.setTargeting("bq_mb_percent",mbdPerc.toString());dfpslot.setTargeting("bq_pfbs",isBs);dfpslot.setTargeting("bq_pfbv",mbBkt.toString());dfpslot.setTargeting("bq_auct",auctType);var lastScr=self.bqPv.getVar("last_score_str");self.log("Setting dfp last score of ",lastScr);
dfpslot.setTargeting("bq_lastsc",""+lastScr);self._setPageNum(dfpslot)}},_setPageNum:function(dfpslot){var self=this;if(typeof CPAGE!=="undefined"){var auctId="pg"+CPAGE;if(self.auctionId!="main")if(self.auctionId=="a2")auctId=auctId+"_xtra";else auctId=self.auctionId;dfpslot.setTargeting("bq_auctid",auctId)}},doSlotTargeting:function(){var self=this;self.log("doSlotTargeting");var pfslots=self._targetSlots(self.targeting);self.log("pfMaxBd",self.pfMaxBd);self.log("page val",self.pageVal);self._setupSlots(pfslots)},
getScore:function(){var self=this;var score=0;self.log("pageVal",self.pageVal);self.log("baselinePageVal",self.baselinePageVal);self.log("expPageVal",self.expPageVal);if(self.baselinePageVal>0)score=Math.round(self.pageVal/self.baselinePageVal);self.log("new score",score);return score},saveAuctionData:function(){var self=this;var score=self.getScore();self.bqPv.setVar("last_score",score);var scoreRnd=bqRoundScore(score);var bqLastScStr=scoreRnd.toString();self.bqPv.setVar("last_score_str",bqLastScStr);
CookieUtil.setLastScore(score)}};
;

/* /js/bq/advertising/BQSlotInstance */
var BQSlotInstance=function(bqAdConfig,auctionId,slotName,rootDivId){this._init(bqAdConfig,auctionId,slotName,rootDivId)};
BQSlotInstance.prototype={_init:function(bqAdConfig,auctionId,slotName,rootDivId){this.bqAdConfig=bqAdConfig;this.auctionId=auctionId;this.slotName=slotName;this.rootDivId=rootDivId},log:function(msg){var self=this;if(self.bqAdConfig.get("logOn")){var newArgs=["[ BQSlotInstance ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},setRefreshExistingSlot:function(useExisting){this.useExisting=useExisting},getRefreshExistingSlot:function(){return this.useExisting},
getAuctionId:function(){var self=this;return self.auctionId},getSlotName:function(){var self=this;return self.slotName},getUniqueDivId:function(){var self=this;var divId=self.getRootDivId();if(self.auctionId!=="main"&&self.useExisting!=true)divId=divId+"-"+self.auctionId;return divId},getEdgeDivId:function(){var self=this;return self.getUniqueDivId()+"_edge"},getRootDivId:function(){var self=this;return self.rootDivId}};
;

/* /js/bq/advertising/BQPageCtrl */
var BQPageCtrl=function(bqPv,bqAdConfig,bqAdCtrl,gaMgr,anchorRefreshable,refreshInterval,firstInfScrollPos,infScrollSpacing,allAdPages){this._init(bqPv,bqAdConfig,bqAdCtrl,gaMgr,anchorRefreshable,refreshInterval,firstInfScrollPos,infScrollSpacing,allAdPages)};
BQPageCtrl.prototype={_init:function(bqPv,bqAdConfig,bqAdCtrl,gaMgr,anchorRefreshable,refreshInterval,firstInfScrollPos,infScrollSpacing,allAdPages){this.bqPv=bqPv;this.bqAdConfig=bqAdConfig;this.bqAdCtrl=bqAdCtrl;this.gaMgr=gaMgr;this.anchorRefreshable=anchorRefreshable;this.refreshInterval=refreshInterval;this.firstInfScrollPos=firstInfScrollPos;this.infScrollSpacing=infScrollSpacing;this.allAdPages=allAdPages},log:function(msg){var self=this;if(self.bqAdConfig.get("logOn")){var newArgs=["[ BQPageCtrl ] ------\x3e"];
for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},pageContentViewed:function(pageNum){var self=this;var placements=self.bqAdConfig.getPlacements();var slotInstance;for(var i=0;i<placements.length;i++){var placement=placements[i];var elId=placement.get("elementId");if(elId=="bq_mobile_anchor_placement"&&self.anchorRefreshable){var nm=placement.get("name");var auctionName="anchor"+pageNum;self.log("refreshing anchor");slotInstance=new BQSlotInstance(self.bqAdConfig,
auctionName,nm,elId);slotInstance.setRefreshExistingSlot(true)}}if(slotInstance)self.bqAdCtrl.refreshAnchorAd(self.refreshInterval,slotInstance)},setupGACallbackForPageDivId:function(elId,pageNum){var self=this;AlmostVisibleMonitor.notifyWhenVisible(elId,0,0,function(elementId){self.log("AlmostVisibleMonitor called for pageview for element",elementId);self.gaMgr.sendInfScrollPageview();self.pageContentViewed(pageNum)})},runAuctionForPage:function(slotsToAdd,pageNum,pageCount){var self=this;if(self.bqAdCtrl.isADB())return;
self.bqAdCtrl.addSlotsAndRun(slotsToAdd);self.log("Added slots ",slotsToAdd);if(pageNum==pageCount){self.bqAdCtrl.queueFooterAuction();self.log("Queued footer auction")}},slotsForPage:function(pageNum){var self=this;var auctionName="pg"+pageNum;var slotInstances;slotInstances=[];var placements=self.bqAdConfig.getPlacements();for(var i=0;i<placements.length;i++){var placement=placements[i];var reuseOk=placement.get("reuseOk");if(reuseOk){self.log("placement enabled for inf scroll",placement);var nm=
placement.get("name");var elId=placement.get("elementId");slotInstances.push(new BQSlotInstance(self.bqAdConfig,auctionName,nm,elId))}else self.log("placement not enabled for inf scroll",placement)}return slotInstances},setupPageUpdates:function(){var self=this;self.pageCtrls={};$(function(){if(typeof bish!=="undefined")bish.addPageLoadedListener(function(eventData){try{self.log("  "+BQInfScrollHelper.pageLoadedEvent+" Page #"+eventData.pg+" loaded because of: '"+eventData.reason+"' with "+eventData.qCount+
" quotes");var pageNum=eventData.pg;var pageCount=eventData.pageCount;var pageType=eventData.ptype;if(typeof pageType==="undefined")pageType="list";var slotsToAdd;var pageDivId;var allSlotsForPage=self.slotsForPage(pageNum);if(pageType=="list"){var pageUpdater=new BQListPageUpdateHandler(self.bqPv,self.bqAdConfig,self.firstInfScrollPos,self.infScrollSpacing,self.allAdPages);var quoteCount=eventData.qCount;pageDivId=pageUpdater.pageBorderDivId(pageNum);if(self.bqAdCtrl.isADB())slotsToAdd=[];else slotsToAdd=
pageUpdater.getListPageSlotsToAdd(allSlotsForPage,pageNum,pageCount,quoteCount)}else if(pageType==="r"){pageDivId="topof_"+pageNum;var slotsToAdd=[];for(var i=0;i<allSlotsForPage.length;i++){var slotDef=allSlotsForPage[i];var elId=slotDef.getUniqueDivId();if($("#"+elId).length>0)slotsToAdd.push(slotDef)}}self.setupGACallbackForPageDivId(pageDivId,pageNum);self.runAuctionForPage(slotsToAdd,pageNum,pageCount)}catch(err){BQErrorLog.logError("BQPageCtrl",err)}})})}};
;

/* /js/bq/advertising/BQSlotMgr */
var BQSlotMgr=function(bqAdConfig,bqPageVars){this._init(bqAdConfig,bqPageVars)};
BQSlotMgr.prototype={_init:function(bqAdConfig,bqPageVars){this.bqAdConfig=bqAdConfig;this.bqPv=bqPageVars;this.slotsByDiv={}},log:function(msg){var self=this;if(self.bqAdConfig.get("logOn")){var newArgs=["[ BQSlotMgr ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},createSlotForDiv:function(name,sizes,divId,collapse){var self=this;var slot=self.slotsByDiv[divId];if(slot)slot.clearTargeting();else{slot=googletag.defineSlot(name,sizes,
divId).addService(googletag.pubads());slot.setCollapseEmptyDiv(collapse)}self.slotsByDiv[divId]=slot;return slot},getSlotForDiv:function(divId){var self=this;return self.slotsByDiv[divId]}};
;

/* /js/bq/advertising/BQPfConfig */
var BQPfConfig=function(lowRatio,highRatio,mxBdPercent){this._init(lowRatio,highRatio,mxBdPercent)};BQPfConfig.prototype={_init:function(lowRatio,highRatio,mxBdPercent){this.lowRatio=lowRatio;this.highRatio=highRatio;this.mxBdPercent=mxBdPercent},getLowRatio:function(){return this.lowRatio},getHighRatio:function(){return this.highRatio},getMxBdPercent:function(){return this.mxBdPercent}};
;

/* /js/bq/advertising/BQTracking */
var BQTracking=function(pf,bqAdConfig,bqPv){this.pf=pf;this.bqAdConfig=bqAdConfig;this.bqPv=bqPv};
BQTracking.prototype={eventQueue:[],log:function(msg){var self=this;if(self.bqAdConfig.get("logOn")){var newArgs=["[ BQTracking ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},trackBids:function(bids){var self=this;try{if(self.pf){var bp=self.bqPv.getVar("btrkp");if(bp>0&&Math.random()*100<bp){self.log("bid tk enabled");self.log("adding all bids",bids);for(var i=0;i<bids.length;i++)self._addBid(bids[i]);self._sendEvents()}else self.log("bid tk disabled")}}catch(err){BQErrorLog.logError("bid track",
err)}},_addBid:function(bid){var self=this;var bidder=bid.provider;var slt=bid.slot;var value=bid.value;var drp=bid.dropped;self.log("tracking bid",bid);var bdata={b:bidder,slt:slt,val:value,drp:drp};self.eventQueue.push(bdata)},_sendEvents:function(){var self=this;self.log("_sendEvents",self.eventQueue);if(self.eventQueue.length>0){var q=self.eventQueue;self.eventQueue=[];var bdata={v:self.bqPv.getVar("version"),aId:self.pf.getAuctionId(),ab:self.bqPv.getVar("abgrp"),cc:self.bqPv.getVar("country"),
isMbl:IS_MBL,zd:q};var payl=JSON.stringify(bdata);$.ajax({type:"POST",url:"/api/btrk",contentType:"application/json",context:this,dataType:"json",data:payl,error:function(req,textStatus,errorThrown){konsole.log("[ERROR] btrk AJAX error:",textStatus,errorThrown)}})}}};
;

/* /js/pubfood/pubfood.min */
/*! Pubfood v1.1.0 - Copyright (c) 2015 Pubfood (http://pubfood.org) */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.pubfood=t()}}(function(){return function t(e,i,r){function o(s,a){if(!i[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(n)return n(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var h=i[s]={exports:{}};e[s][0].call(h.exports,function(t){var i=e[s][1][t];return o(i?i:t)},h,h.exports,t,e,i,r)}return i[s].exports}for(var n="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,i){"use strict";function r(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function o(){}var n=Object.prototype.hasOwnProperty,s="function"!=typeof Object.create&&"~";o.prototype._events=void 0,o.prototype.eventNames=function(){var t,e=this._events,i=[];if(!e)return i;for(t in e)n.call(e,t)&&i.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(t,e){var i=s?s+t:t,r=this._events&&this._events[i];if(e)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var o=0,n=r.length,a=new Array(n);o<n;o++)a[o]=r[o].fn;return a},o.prototype.emit=function(t,e,i,r,o,n){var a=s?s+t:t;if(!this._events||!this._events[a])return!1;var u,p,h=this._events[a],d=arguments.length;if("function"==typeof h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),d){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,i),!0;case 4:return h.fn.call(h.context,e,i,r),!0;case 5:return h.fn.call(h.context,e,i,r,o),!0;case 6:return h.fn.call(h.context,e,i,r,o,n),!0}for(p=1,u=new Array(d-1);p<d;p++)u[p-1]=arguments[p];h.fn.apply(h.context,u)}else{var c,l=h.length;for(p=0;p<l;p++)switch(h[p].once&&this.removeListener(t,h[p].fn,void 0,!0),d){case 1:h[p].fn.call(h[p].context);break;case 2:h[p].fn.call(h[p].context,e);break;case 3:h[p].fn.call(h[p].context,e,i);break;default:if(!u)for(c=1,u=new Array(d-1);c<d;c++)u[c-1]=arguments[c];h[p].fn.apply(h[p].context,u)}}return!0},o.prototype.on=function(t,e,i){var o=new r(e,i||this),n=s?s+t:t;return this._events||(this._events=s?{}:Object.create(null)),this._events[n]?this._events[n].fn?this._events[n]=[this._events[n],o]:this._events[n].push(o):this._events[n]=o,this},o.prototype.once=function(t,e,i){var o=new r(e,i||this,(!0)),n=s?s+t:t;return this._events||(this._events=s?{}:Object.create(null)),this._events[n]?this._events[n].fn?this._events[n]=[this._events[n],o]:this._events[n].push(o):this._events[n]=o,this},o.prototype.removeListener=function(t,e,i,r){var o=s?s+t:t;if(!this._events||!this._events[o])return this;var n=this._events[o],a=[];if(e)if(n.fn)(n.fn!==e||r&&!n.once||i&&n.context!==i)&&a.push(n);else for(var u=0,p=n.length;u<p;u++)(n[u].fn!==e||r&&!n[u].once||i&&n[u].context!==i)&&a.push(n[u]);return a.length?this._events[o]=1===a.length?a[0]:a:delete this._events[o],this},o.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[s?s+t:t]:this._events=s?{}:Object.create(null),this):this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.prefixed=s,"undefined"!=typeof e&&(e.exports=o)},{}],2:[function(t,e,i){"use strict";function r(){this.operators=[]}r.prototype.addOperator=function(t){this.operators.push(t)},r.prototype.process=function(t,e){for(var i=t,r=0;r<this.operators.length;r++)i=this.operators[r].process(i,e);return i},e.exports=r},{}],3:[function(t,e,i){"use strict";function r(){this.operators=[]}r.prototype.addOperator=function(t){this.operators.push(t)},r.prototype.process=function(t,e){for(var i=t,r=0;r<this.operators.length;r++)i=this.operators[r].process(i,e);return i},e.exports=r},{}],4:[function(t,e,i){"use strict";function r(t){this.name="OP-"+o.newId(),this.transform=t}var o=t("../util"),n=t("../event"),s=t("../errors");r.validate=function(t){return!!t&&"function"===o.asType(t)},r.withDelegate=function(t){if(!r.validate(t))return null;var e=new r(t);return e},r.prototype.setName=function(t){return this.name=t,this},r.prototype.process=function(t,e){if(!t)return null;var i=this.transform(t,e);return i||n.publish(n.EVENT_TYPE.ERROR,new s("no transform output")),i||null},e.exports=r},{"../errors":5,"../event":6,"../util":17}],5:[function(t,e,i){"use strict";function r(t){this.name=o,this.message=t||"Pubfood integration error.",this.stack=(new Error).stack}var o="PubfoodError";r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r.prototype.name=o,r.prototype.is=function(t){return t&&t.name===o},e.exports=r},{}],6:[function(t,e,i){"use strict";function r(){this.auctionId="pubfood:"+Date.now(),this.observeImmediate_={}}var o=t("./util"),n=t("./logger"),s=t("eventemitter3");r.prototype.setAuctionId=function(t){var e=o.asType(t);return"string"!==e&&"number"!==e||(this.auctionId=t),this.auctionId},r.prototype.EVENT_TYPE={PUBFOOD_API_LOAD:"PUBFOOD_API_LOAD",PUBFOOD_API_START:"PUBFOOD_API_START",PUBFOOD_API_REFRESH:"PUBFOOD_API_REFRESH",BID_LIB_START:"BID_LIB_START",BID_LIB_LOAD:"BID_LIB_LOAD",BID_LIB_LOADED:"BID_LIB_LOADED",BID_START:"BID_START",BID_PUSH_NEXT:"BID_PUSH_NEXT",BID_PUSH_NEXT_LATE:"BID_PUSH_NEXT_LATE",BID_COMPLETE:"BID_COMPLETE",BID_ASSEMBLER:"BID_ASSEMBLER",AUCTION_LIB_START:"AUCTION_LIB_START",AUCTION_LIB_LOAD:"AUCTION_LIB_LOAD",AUCTION_LIB_LOADED:"AUCTION_LIB_LOADED",AUCTION_GO:"AUCTION_GO",AUCTION_START:"AUCTION_START",AUCTION_TRIGGER:"AUCTION_TRIGGER",AUCTION_REFRESH:"AUCTION_REFRESH",AUCTION_COMPLETE:"AUCTION_COMPLETE",AUCTION_POST_RUN:"AUCTION_POST_RUN",ERROR:"ERROR",WARN:"WARN",INVALID:"INVALID"},r.prototype.publish=function(t,e,i){var r=+new Date;t===this.EVENT_TYPE.PUBFOOD_API_START&&e&&(r=e);var o={auctionId:this.auctionId,ts:r,type:t,annotations:i||{},data:e||""};return n.logEvent(t,this.auctionId,o),this.emit(t,o)},o.extendsObject(r,s),r.prototype.emit=function(t){var e=s.prototype.emit.apply(this,arguments);return e&&this.EVENT_TYPE.AUCTION_POST_RUN!==t||(e=!0,this.observeImmediate_[t]=this.observeImmediate_[t]||[],this.observeImmediate_[t].push(Array.prototype.slice.call(arguments,1))),e},r.prototype.on=function(t,e){var i=this.observeImmediate_[t]||null;if(i){for(var r=0;r<i.length;r++)e.apply(this,i[r]);return this}return s.prototype.on.apply(this,arguments)},r.prototype.removeAllListeners=function(){return s.prototype.removeAllListeners.call(this),this.observeImmediate_={},this},r.prototype.ANNOTATION_TYPE={FORCED_DONE:{NAME:"forcedDone",ERROR:"error",TIMEOUT:"timeout"},AUCTION_TYPE:{NAME:"auctionType",INIT:"init",REFRESH:"refresh"}},r.prototype.newEventAnnotation=function(t,e,i,r){var o=r||{};return o[t||"undefined"]={type:e||"undefined",message:i||""},o},e.exports=new r},{"./logger":8,"./util":17,eventemitter3:1}],7:[function(t,e,i){"use strict";var r={name:"",libUri:"",timeout:0,init:function(t,e){},refresh:function(t,e){}};r.optional={refresh:!0,timeout:!0};var o={name:"__default__",libUri:" ",timeout:0,init:function(t,e,i){i()},refresh:function(t,e,i){i()}};o.optional={libUri:!0,refresh:!0,timeout:!0};var n=function(t,e){},s={slot:"",value:"",sizes:[],targeting:{},label:""},a={name:"",elementId:"",sizes:[],bidProviders:[]};e.exports={BidDelegate:o,AuctionDelegate:r,SlotConfig:a,BidObject:s,TransformDelegate:n}},{}],8:[function(t,e,i){"use strict";var r={history:[],dumpLog:function(t){if(console&&console.log){var e;t&&(e=new RegExp(t,"g"));for(var i=0;i<this.history.length;i++){var r=this.history[i];e?(e.lastIndex=0,r.eventName&&e.test(r.eventName)&&console.log(r),r.functionName&&e.test(r.functionName)&&console.log(r)):console.log(r)}}},logCall:function(t,e,i){this.history.push({ts:+new Date,auctionId:e,functionName:t,args:Array.prototype.slice.call(i)})},logEvent:function(t,e,i){this.history.push({ts:+new Date,auctionId:e,eventName:t,event:i})}};e.exports=r},{}],9:[function(t,e,i){"use strict";function r(t){this.init_&&this.init_(),this.prefix=!t||!t.hasOwnProperty("prefix")||t.prefix,this.slotMap={},this.bidProviders={},this.auctionProvider=null,this.auctionRun={},this.timeout_=r.NO_TIMEOUT,this.trigger_=null,this.bidAssembler=new a,this.requestAssembler=new u,this.auctionIdx_=0,this.doneCallbackOffset_=r.DEFAULT_DONE_CALLBACK_OFFSET,this.omitDefaultBidKey_=!1,this.throwErrors_=!1,c.setAuctionId(this.getAuctionId())}var o=t("../util"),n=t("../model/slot"),s=t("../model/bid"),a=t("../assembler/bidassembler"),u=t("../assembler/requestassembler"),p=t("../assembler/transformoperator"),h=t("../provider/auctionprovider"),d=t("../provider/bidprovider"),c=t("../event"),l=t("../pubfoodobject");r.PAGE_BIDS="page",r.AUCTION_TYPE={START:c.ANNOTATION_TYPE.AUCTION_TYPE.INIT,REFRESH:c.ANNOTATION_TYPE.AUCTION_TYPE.REFRESH},r.IN_AUCTION={FALSE:!1,PENDING:"pending",DONE:"done"},r.NO_TIMEOUT=-1,r.DEFAULT_DONE_CALLBACK_OFFSET=5e3,r.prototype.validate=function(t){var e=!0,i={hasAuctionProvider:function(){return!!this.auctionProvider},hasBidProviders:function(){var t=!1;for(var e in this.bidProviders){t=!0;break}return t||c.publish(c.EVENT_TYPE.WARN,{msg:"Warn: no bid providers"}),t},hasSlots:function(){for(var t in this.slotMap)return!0;return!1},hasAllSlotsBidder:function(){var t=[];for(var e in this.slotMap){var i=this.slotMap[e];i.bidProviders&&i.bidProviders[0]||t.push(i.name)}return t.length>0&&c.publish(c.EVENT_TYPE.WARN,{msg:"Warn: no bidders - "+t.join(", ")}),0===t.length}};i.hasBidProviders.warn=!0;for(var r in i)if(e=i[r].call(this),e=!!i[r].warn||e,!e){c.publish(c.EVENT_TYPE.INVALID,{msg:"Failed: "+r});break}return e},r.prototype.newAuctionRun=function(t,e){var i=++this.auctionIdx_,n=[];if(o.isArray(e)&&e.length>0)for(var s=0;s<e.length;s++){var a=e[s];this.slotMap[a]?n.push(this.slotMap[a]):c.publish(c.EVENT_TYPE.WARN,"Can't refresh slot \""+a+"\", because it wasn't defined")}else for(var u in this.slotMap)n.push(this.slotMap[u]);var p={timeoutId:0,inAuction:r.IN_AUCTION.FALSE,slots:n,bids:[],lateBids:[],bidStatus:{},targeting:[],auctionType:t||r.AUCTION_TYPE.START};for(var u in this.bidProviders){var h=this.bidProviders[u];!h||h.name in p.bidStatus||!h.enabled()||(p.bidStatus[h.name]=!1)}return this.auctionRun[i]=p,i},r.prototype.getBidStatus=function(t,e){var i=[];if(e){var r=this.auctionRun[e],n=r?r.bidStatus[t]:"";i="boolean"===o.asType(n)?n:-1}else for(var s in this.auctionRun){var n=this.auctionRun[s].bidStatus[t];i.push("boolean"===o.asType(n)?n:-1)}return i},r.prototype.timeout=function(t){this.timeout_="number"===o.asType(t)&&t>0?t:r.NO_TIMEOUT},r.prototype.getTimeout=function(){return this.timeout_},r.prototype.doneCallbackOffset=function(t){this.doneCallbackOffset_="number"===o.asType(t)?t:r.DEFAULT_DONE_CALLBACK_OFFSET},r.prototype.getDoneCallbackOffset=function(){return this.doneCallbackOffset_},r.prototype.setAuctionProviderCbTimeout=function(t){this.initDoneTimeout_="number"===o.asType(t)&&t>0?t:this.doneCallbackOffset_},r.prototype.setAuctionTrigger=function(t){this.trigger_=t},r.prototype.startAuction_=function(t,e,i){clearTimeout(this.auctionRun[t].timeoutId),this.auctionRun[t].timeoutId=0,c.publish(c.EVENT_TYPE.BID_ASSEMBLER,"AuctionMediator"),this.bidAssembler.operators.length>0&&(this.auctionRun[t].bids=this.bidAssembler.process(this.auctionRun[t].bids)),this.processTargeting_(t,e,i)},r.prototype.startTimeout_=function(t,e){if(this.timeout_!==r.NO_TIMEOUT&&this.timeout_>=0){var i=t,n=e,s=o.bind(this.startAuction_,this);this.auctionRun[t].timeoutId=setTimeout(function(){s(i,n,!0)},this.timeout_)}return this},r.prototype.initAuctionTrigger_=function(t,e){function i(){this.auctionRun[r].inAuction||this.startAuction_(r,n)}if("function"!==o.asType(this.trigger_))return void this.startTimeout_(t,e);var r=t,n=e;return this.trigger_.apply(null,[o.bind(i,this)]),this},r.prototype.allBiddersDone=function(t){var e=!0,i=this.auctionRun[t].bidStatus;for(var r in i)if(!i[r]){e=!1;break}return e},r.prototype.checkBids_=function(t,e){this.allBiddersDone(t)&&!this.auctionRun[t].inAuction&&this.startAuction_(t,e)},r.prototype.getBidKey=function(t){return(this.prefix&&t.provider?t.provider+"_":"")+(t.label||"bid")},r.prototype.mergeKeys=function(t,e){t=o.mergeToObject(t,e)},r.prototype.getBidMap_=function(t){var e={};e[r.PAGE_BIDS]=[];for(var i=this.getAuctionRunBids(t),o=0;o<i.length;o++){var n=i[o];n.slot?(e[n.slot]=e[n.slot]||[],e[n.slot].push(n)):e[r.PAGE_BIDS].push(n)}return e},r.prototype.buildTargeting_=function(t){for(var e,i=[],o=this.getBidMap_(t),n=this.getAuctionRunSlots(t),s=0;s<n.length;s++){var a={bids:[],targeting:{}},u=n[s];a.name=u.name,a.id=u.id,a.elementId=u.elementId||"",a.sizes=u.sizes,a.type="slot",e=o[u.name]||[];for(var p=0;p<e.length;p++){var h=e[p];if(a.bids.push({value:h.value,provider:h.provider,id:h.id,targeting:h.targeting||{}}),!this.omitDefaultBidKey()){var d=this.getBidKey(h);a.targeting[d]=a.targeting[d]||h.value}this.mergeKeys(a.targeting,h.targeting)}i.push(a)}var c={bids:[],targeting:{}};e=o[r.PAGE_BIDS]||[];for(var l=0;l<e.length;l++){var h=e[l];if(c.bids.push({value:h.value,provider:h.provider,id:h.id,targeting:h.targeting}),!this.omitDefaultBidKey()){var d=this.getBidKey(h);c.targeting[d]=c.targeting[d]||h.value}this.mergeKeys(c.targeting,h.targeting)}return c.bids.length>0&&(c.type="page",i.push(c)),i},r.prototype.processTargeting_=function(t,e){if(!this.auctionRun[t].inAuction){this.auctionRun[t].inAuction=r.IN_AUCTION.PENDING;var i,o=this,n=!1,s=o.auctionProvider.name,a=t,u=o.auctionProvider.getTimeout(),p=this.auctionRun[t].timeoutId,h=function(t){var r={};c.newEventAnnotation(c.ANNOTATION_TYPE.AUCTION_TYPE.NAME,e,"Done auction type: "+e,r);for(var u in t)r[u]=t[u];n||(n=!0,clearTimeout(i),o.auctionDone(a,s,r))};i=setTimeout(function(){if(!n){p&&clearTimeout(p);var t='The auction done callback for "'+s+"\" hasn't been called within the allotted time ("+u/1e3+"sec)",e=c.newEventAnnotation(c.ANNOTATION_TYPE.FORCED_DONE.NAME,c.ANNOTATION_TYPE.FORCED_DONE.TIMEOUT,t);c.publish(c.EVENT_TYPE.WARN,"Warning:"+t),h(e)}},u),e===r.AUCTION_TYPE.START?(c.publish(c.EVENT_TYPE.AUCTION_GO,s),c.publish(c.EVENT_TYPE.AUCTION_START,s)):c.publish(c.EVENT_TYPE.AUCTION_REFRESH,s);var d=o.buildTargeting_(a);this.auctionRun[a].targeting=d;try{e===r.AUCTION_TYPE.START?o.auctionProvider.init(d,h):o.auctionProvider.refresh(d,h)}catch(l){c.publish(c.EVENT_TYPE.ERROR,l);var f=c.newEventAnnotation(c.ANNOTATION_TYPE.FORCED_DONE.NAME,c.ANNOTATION_TYPE.FORCED_DONE.ERROR,l.message);if(h(f),o.auctionProvider.throwErrors())throw l}}},r.prototype.auctionDone=function(t,e,i){this.auctionRun[t].inAuction=r.IN_AUCTION.DONE;var o=this.getAuctionRun(t).targeting;c.publish(c.EVENT_TYPE.AUCTION_COMPLETE,{name:e,targeting:o},i),setTimeout(function(){c.publish(c.EVENT_TYPE.AUCTION_POST_RUN,e)},0)},r.prototype.addSlot=function(t){var e=n.fromObject(t);return e?this.slotMap[e.name]=e:c.publish(c.EVENT_TYPE.WARN,"Invalid slot object: "+JSON.stringify(t||{})),e},r.prototype.getProviderDoneTimeout_=function(t){var e=this.timeout_+this.doneCallbackOffset_;return t.timeout&&(e=t.timeout),e},r.prototype.getBidProviderDoneTimeout_=function(t){var e=this.getProviderDoneTimeout_(t);return this.callbackTimeout_&&(e=this.callbackTimeout_),e},r.prototype.getAuctionProviderDoneTimeout_=function(t){var e=this.getProviderDoneTimeout_(t);return this.initDoneTimeout_&&(e=this.initDoneTimeout_),e},r.prototype.addBidProvider=function(t){var e=d.withDelegate(t);if(e)if(this.bidProviders[e.name])c.publish(c.EVENT_TYPE.WARN,"Warning: bid provider "+e.name+" is already added");else{var i=this.getBidProviderDoneTimeout_(t);e.timeout(i),e.throwErrors(this.throwErrors_),this.bidProviders[e.name]=e}else{var r=t&&t.name?t.name:"undefined";c.publish(c.EVENT_TYPE.WARN,"Warning: invalid bid provider: "+r)}return e},r.prototype.bidProviderExists_=function(t){return!!this.bidProviders[t]},r.prototype.setAuctionProvider=function(t){this.auctionProvider&&c.publish(c.EVENT_TYPE.WARN,"Warning: auction provider exists: "+this.auctionProvider.name);var e=h.withDelegate(t);if(e){var i=this.getAuctionProviderDoneTimeout_(t);e.timeout(i),e.throwErrors(this.throwErrors_),this.auctionProvider=e}else{var r=t&&t.name?t.name:"undefined";c.publish(c.EVENT_TYPE.WARN,"Warning: invalid auction provider: "+r)}return e},r.prototype.addRequestTransform=function(t){return this.requestAssembler.addOperator(new p(t)),this},r.prototype.addBidTransform=function(t){return this.bidAssembler.addOperator(new p(t)),this},r.prototype.loadProviders=function(t){var e,i=[];for(var r in this.bidProviders)i.push(r);t&&o.randomize(i);for(var n=0;n<i.length;n++){var s=i[n];if(this.bidProviders[s].libUri){c.publish(c.EVENT_TYPE.BID_LIB_LOAD,this.bidProviders[s].name),e=this.bidProviders[s].libUri()||"";var a=this.bidProviders[s].sync();o.loadUri(e,a)}}this.auctionProvider&&this.auctionProvider.libUri()&&(c.publish(c.EVENT_TYPE.AUCTION_LIB_LOAD,this.auctionProvider.name),e=this.auctionProvider.libUri(),o.loadUri(e))},r.prototype.getBidderSlots=function(t){var e,i,r={},o=[];for(e=0;e<t.length;e++){var n=t[e];for(i=0;i<n.bidProviders.length;i++){var s=n.bidProviders[i];r[s]=r[s]||[],r[s].push(n)}}for(i in this.bidProviders){var s=this.bidProviders[i];s&&s.enabled()&&o.push({provider:s,slots:r[i]||[]})}return o},r.prototype.start=function(t,e){if(!this.auctionProvider)return c.publish(c.EVENT_TYPE.WARN,"Warning: auction provider is not defined."),this;var i=this.newAuctionRun(r.AUCTION_TYPE.START);c.setAuctionId(this.getAuctionId(i)),c.publish(c.EVENT_TYPE.PUBFOOD_API_START,e),this.initAuctionTrigger_(i,r.AUCTION_TYPE.START),this.loadProviders(t);var o=this.getAuctionRunSlots(i),n=this.getBidderSlots(o);return this.processBids(i,r.AUCTION_TYPE.START,n),this},r.prototype.refresh=function(t){if(!this.auctionProvider)return c.publish(c.EVENT_TYPE.WARN,"Warning: auction provider is not defined."),this;var e=this.newAuctionRun(r.AUCTION_TYPE.REFRESH,t);c.setAuctionId(this.getAuctionId(e)),c.publish(c.EVENT_TYPE.PUBFOOD_API_REFRESH),this.initAuctionTrigger_(e,r.AUCTION_TYPE.REFRESH);var i=this.getAuctionRunSlots(e),o=this.getBidderSlots(i);return this.processBids(e,r.AUCTION_TYPE.REFRESH,o),this},r.prototype.processBids=function(t,e,i){for(var r=0;r<i.length;r++)this.getBids_(t,e,i[r].provider,i[r].slots)},r.prototype.setBidProviderCbTimeout=function(t){this.callbackTimeout_="number"===o.asType(t)&&t>0?t:this.doneCallbackOffset_},r.prototype.getBids_=function(t,e,i,o){var n,s=this,a=i.name,u=!1,p=t,h=i.getTimeout(),d=function(t){t.auctionIdx=p,s.pushBid(p,t,a)},l=function(t){var i={};c.newEventAnnotation(c.ANNOTATION_TYPE.AUCTION_TYPE.NAME,e,"Done auction type: "+e,i);for(var r in t)i[r]=t[r];u||(u=!0,clearTimeout(n),s.doneBid(p,e,a,i))};n=setTimeout(function(){if(!u){var t='The bid done callback for "'+a+"\" hasn't been called within the allotted time ("+h/1e3+"sec)";c.publish(c.EVENT_TYPE.WARN,"Warning: "+t);var e=c.newEventAnnotation(c.ANNOTATION_TYPE.FORCED_DONE.NAME,c.ANNOTATION_TYPE.FORCED_DONE.TIMEOUT,t);l(e)}},h),c.publish(c.EVENT_TYPE.BID_START,a);try{e===r.AUCTION_TYPE.START?i.init(o,d,l):i.refresh(o,d,l)}catch(f){c.publish(c.EVENT_TYPE.ERROR,f);var v=c.newEventAnnotation(c.ANNOTATION_TYPE.FORCED_DONE.NAME,c.ANNOTATION_TYPE.FORCED_DONE.ERROR,f.message);if(l(v),i.throwErrors())throw f}},r.prototype.pushBid=function(t,e,i){var r=s.fromObject(e);r?(r.provider=i,this.auctionRun[t].inAuction?(this.auctionRun[t].lateBids.push(r),c.publish(c.EVENT_TYPE.BID_PUSH_NEXT_LATE,r)):(this.auctionRun[t].bids.push(r),c.publish(c.EVENT_TYPE.BID_PUSH_NEXT,r))):c.publish(c.EVENT_TYPE.WARN,"Invalid bid object: "+JSON.stringify(e||{}))},r.prototype.doneBid=function(t,e,i,r){c.publish(c.EVENT_TYPE.BID_COMPLETE,i,r),this.auctionRun[t].bidStatus[i]=!0,this.checkBids_(t,e)},r.prototype.getAuctionCount=function(){return this.auctionIdx_},r.prototype.getAuctionId=function(t){var e=t||this.auctionIdx_;return this.id+":"+e},r.prototype.getAuctionRun=function(t){var e=this.auctionRun[t];return"undefined"===o.asType(e)?{}:e},r.prototype.getAuctionRunSlots=function(t){var e=this.auctionRun[t];return"undefined"===o.asType(e)?{}:e.slots},r.prototype.getAuctionRunBids=function(t){var e=this.auctionRun[t];return"undefined"===o.asType(e)?[]:e.bids},r.prototype.getAuctionRunLateBids=function(t){var e=this.auctionRun[t];return"undefined"===o.asType(e)?[]:e.lateBids},r.prototype.getAuctionRunTargeting=function(t){var e=this.auctionRun[t];return"undefined"===o.asType(e)?[]:e.targeting},r.prototype.getAuctionRunType=function(t){return this.auctionRun[t].auctionType},r.prototype.prefixDefaultBidKey=function(t){return"boolean"===o.asType(t)&&(this.prefix=t),this.prefix},r.prototype.omitDefaultBidKey=function(t){return"boolean"===o.asType(t)&&(this.omitDefaultBidKey_=t),this.omitDefaultBidKey_},r.prototype.throwErrors=function(t){if("boolean"===o.asType(t)){this.throwErrors_=t,this.throwErrors_=this.auctionProvider?this.auctionProvider.throwErrors(t):this.throwErrors_;for(var e in this.bidProviders){var i=this.bidProviders[e];this.throwErrors_=i?i.throwErrors(t):this.throwErrors_}}return this.throwErrors_},o.extendsObject(r,l),e.exports=r},{"../assembler/bidassembler":2,"../assembler/requestassembler":3,"../assembler/transformoperator":4,"../event":6,"../model/bid":10,"../model/slot":11,"../provider/auctionprovider":12,"../provider/bidprovider":13,"../pubfoodobject":16,"../util":17}],10:[function(t,e,i){"use strict";function r(t){this.init_&&this.init_(),this.sizes=[],this.slot,this.value="undefined"===o.asType(t)?"":t,this.type=o.asType(this.value),this.label,this.provider,this.targeting={}}var o=t("../util"),n=t("../pubfoodobject");r.fromObject=function(t){var e=new r,i=o.clone(t);for(var n in i)e[n]=i[n];var s=o.asType(e.value);return e.type="undefined"!==s?s:"",e},r.prototype.setValue=function(t){return this.value="undefined"===o.asType(t)?"":t,this.type=o.asType(this.value),this},r.prototype.addSize=function(t,e){var i=Math.abs(~~t),r=Math.abs(~~e);return this.sizes.push([i,r]),this},o.extendsObject(r,n),e.exports=r},{"../pubfoodobject":16,"../util":17}],11:[function(t,e,i){"use strict";function r(t,e){this.init_&&this.init_(),this.name=t,this.elementId=e,this.bidProviders=[],this.sizes=[]}var o=t("../util"),n=t("../pubfoodobject"),s=t("../interfaces").SlotConfig;r.validate=function(t){return!!t&&o.validate(s,t)},r.fromObject=function(t){if(!r.validate(t))return null;var e=new r;for(var i in t)e[i]=t[i];return e},r.prototype.addSizes=function(t){return Array.prototype.push.apply(this.sizes,t),this},r.prototype.addSize=function(t,e){var i=Math.abs(~~t),r=Math.abs(~~e);return this.sizes.push([i,r]),this},r.prototype.addBidProvider=function(t){return this.bidProviders.push(t),this},o.extendsObject(r,n),e.exports=r},{"../interfaces":7,"../pubfoodobject":16,"../util":17}],12:[function(t,e,i){"use strict";function r(t){this.init_&&this.init_();var e=t||{};this.name=e.name||"",this.auctionDelegate=e,this.timeout_=e&&e.timeout?e.timeout:0}var o=t("../util"),n=t("../interfaces").AuctionDelegate,s=t("../event"),a=t("./pubfoodprovider");r.withDelegate=function(t){if(!r.validate(t))return s.publish(s.EVENT_TYPE.INVALID,{msg:"Warn: invalid auction delegate - "+(t&&JSON.stringify(t))||""}),null;var e=new r(t);return e},r.validate=function(t){return o.validate(n,t)},r.prototype.libUri=function(){return this.auctionDelegate.libUri},r.prototype.init=function(t,e){this.auctionDelegate.init(t,e)},r.prototype.refresh=function(t,e){if(this.auctionDelegate&&this.auctionDelegate.refresh)this.auctionDelegate.refresh(t,e);else{var i="AuctionProvider.auctionDelegate.refresh not defined.";if(s.publish(s.EVENT_TYPE.WARN,i),"function"===o.asType(e)){var r=s.newEventAnnotation(s.ANNOTATION_TYPE.FORCED_DONE.NAME,s.ANNOTATION_TYPE.FORCED_DONE.ERROR,i);e(r)}}},r.prototype.timeout=function(t){this.timeout_="number"===o.asType(t)?t:0},r.prototype.getTimeout=function(){return this.timeout_},o.extendsObject(r,a),e.exports=r},{"../event":6,"../interfaces":7,"../util":17,"./pubfoodprovider":14}],13:[function(t,e,i){"use strict";function r(t){this.init_&&this.init_();var e=t||{};this.name=e.name||"",this.bidDelegate=e,this.enabled_=!0,this.timeout_=e&&e.timeout?e.timeout:0}var o=t("../util"),n=t("../interfaces").BidDelegate,s=t("../event"),a=t("./pubfoodprovider");r.withDelegate=function(t){if(!r.validate(t))return s.publish(s.EVENT_TYPE.WARN,{msg:"Warn: invalid bidder delegate - "+t||""}),null;var e=new r(t);return e},r.validate=function(t){return o.validate(n,t)},r.prototype.libUri=function(t){return t&&(this.bidDelegate.libUri=t),this.bidDelegate.libUri},r.prototype.sync=function(){var t=Array.prototype.slice.call(arguments);return t.length>0&&"boolean"===o.asType(t[0])&&(this.bidDelegate.sync=t[0]),!!this.bidDelegate.sync},r.prototype.init=function(t,e,i){this.bidDelegate.init(t,e,i)},r.prototype.refresh=function(t,e,i){var r=this.bidDelegate&&this.bidDelegate.refresh||null;if(r)r(t,e,i);else{var n="BidProvider.bidDelegate.refresh not defined.";if(s.publish(s.EVENT_TYPE.WARN,n),"function"===o.asType(i)){var a=s.newEventAnnotation(s.ANNOTATION_TYPE.FORCED_DONE.NAME,s.ANNOTATION_TYPE.FORCED_DONE.ERROR,n);i(a)}}},r.prototype.enabled=function(t){return"boolean"===o.asType(t)&&(this.enabled_=t),this.enabled_},r.prototype.timeout=function(t){this.timeout_="number"===o.asType(t)?t:0},r.prototype.getTimeout=function(){return this.timeout_},o.extendsObject(r,a),e.exports=r},{"../event":6,"../interfaces":7,"../util":17,"./pubfoodprovider":14}],14:[function(t,e,i){"use strict";function r(){this.throwErrors_=!1}var o=t("../pubfoodobject"),n=t("../util");r.prototype.throwErrors=function(t){return"boolean"===n.asType(t)&&(this.throwErrors_=t),this.throwErrors_},n.extendsObject(r,o),e.exports=r},{"../pubfoodobject":16,"../util":17}],15:[function(t,e,i){"use strict";var r=t("./event"),o=t("./util"),n=t("./logger"),s=t("./interfaces").BidDelegate,a=t("./mediator/auctionmediator");!function(t,i,r){t&&(e.exports=r(t,t.pfConfig||{}))}(window||{},void 0,function(e){if(e.pubfood)return e.pubfood.library.logger.logEvent(r.EVENT_TYPE.WARN,["multiple api load"]),e.pubfood;var i=function(t){return new i.library.init(t)};i.library=i.prototype={version:"1.1.0",PubfoodError:t("./errors"),logger:n};var u=function(t){var e=t.getBidProviders();for(var i in t.requiredApiCalls)0===t.requiredApiCalls[i]&&t.configErrors.push('"'+i+'" was not called');for(var r=t.getSlots(),o=0;o<r.length;o++)for(var n=0;n<r[o].bidProviders.length;n++){var s=r[o].bidProviders[n];e[s]||t.configErrors.push('No configuration found for bid provider "'+s+'"')}return{hasError:t.configErrors.length>0,details:t.configErrors}},p=i.library.init=function(t){return this.mediator=new a,t&&(this.randomizeBidRequests_=!!t.randomizeBidRequests,this.mediator.setBidProviderCbTimeout(t.bidProviderCbTimeout),this.mediator.setAuctionProviderCbTimeout(t.auctionProviderCbTimeout)),r.publish(r.EVENT_TYPE.PUBFOOD_API_LOAD),this.pushApiCall_("api.init",arguments),this.configErrors=[],this.requiredApiCalls={setAuctionProvider:0,addBidProvider:0},this.util=o,this};return p.prototype.pushApiCall_=function(t,e){this.library.logger.logCall(t,this.getAuctionId(),e)},p.prototype.getAuctionId=function(){return this.mediator.getAuctionId()},p.prototype.getAuctionCount=function(){return this.mediator.getAuctionCount()},p.prototype.getAuctionRun=function(t){return this.mediator.getAuctionRun(t)},p.prototype.dumpLog=function(t){this.library.logger.dumpLog(t)},p.prototype.addSlot=function(t){!o.isObject(t)||o.isArray(t.bidProviders)&&0!==t.bidProviders.length||(t.bidProviders=["__default__"],this.mediator.bidProviderExists_("__default__")||this.mediator.addBidProvider(s)),this.pushApiCall_("api.addSlot",arguments);var e=this.mediator.addSlot(t);return this.requiredApiCalls.addSlot++,e},p.prototype.getSlots=function(){this.pushApiCall_("api.getSlots",arguments);var t=[];for(var e in this.mediator.slotMap)t.push(this.mediator.slotMap[e]);return t},p.prototype.getSlot=function(t){return this.pushApiCall_("api.getSlot",arguments),this.mediator.slotMap[t]},p.prototype.setAuctionProvider=function(t){this.pushApiCall_("api.setAuctionProvider",arguments);var e=this.mediator.setAuctionProvider(t),i=t&&t.name?t.name:"undefined";return e?(this.requiredApiCalls.setAuctionProvider++,e):(this.configErrors.push("Invalid auction provider: "+i),null)},p.prototype.getAuctionProvider=function(){return this.pushApiCall_("api.getAuctionProvider",arguments),this.mediator.auctionProvider},p.prototype.addBidProvider=function(t){this.pushApiCall_("api.addBidProvider",arguments);var e=this.mediator.addBidProvider(t),i=t&&t.name?t.name:"undefined";return e?(this.requiredApiCalls.addBidProvider++,"function"===o.asType(t.init)&&3!==t.init.length&&this.configErrors.push("Bid provider "+i+"'s init method requires 3 arguments"),"function"===o.asType(t.refresh)&&3!==t.refresh.length&&this.configErrors.push("Bid provider "+i+"'s refresh method requires 3 arguments"),e):(this.configErrors.push("Invalid bid provider: "+i),null)},p.prototype.getBidProviders=function(){return this.pushApiCall_("api.getBidProviders",arguments),this.mediator.bidProviders},p.prototype.getBidProvider=function(t){return this.pushApiCall_("api.getBidProvider",arguments),this.mediator.bidProviders[t]},p.prototype.observe=function(t,e){if(this.pushApiCall_("api.observe",arguments),"function"==typeof t)for(var i in r.EVENT_TYPE)r.on(r.EVENT_TYPE[i],o.bind(t,this));else"string"==typeof t&&(r.EVENT_TYPE[t]?r.on(r.EVENT_TYPE[t],o.bind(e,this)):r.publish(r.EVENT_TYPE.WARN,'Warning: Invalid event type "'+t+'"'));return this},p.prototype.timeout=function(t){return this.pushApiCall_("api.timeout",arguments),"number"===o.asType(t)&&this.mediator.timeout(t),this.mediator.getTimeout()},p.prototype.doneCallbackOffset=function(t){return this.pushApiCall_("api.doneCallbackOffset",arguments),"number"===o.asType(t)&&this.mediator.doneCallbackOffset(t),this.mediator.getDoneCallbackOffset()},p.prototype.setAuctionTrigger=function(t){return this.pushApiCall_("api.setAuctionTrigger",arguments),this.mediator.setAuctionTrigger(t),this},p.prototype.addBidTransform=function(t){return this.pushApiCall_("api.addBidTransform",arguments),this.mediator.addBidTransform(t),this},p.prototype.addRequestTransform=function(t){return this.pushApiCall_("api.addRequestTransform",arguments),this.mediator.addRequestTransform(t),this},p.prototype.start=function(t,e){this.pushApiCall_("api.start",arguments);var i=u(this);return"function"==typeof e&&e(i.hasError,i.details),this.mediator.start(this.randomizeBidRequests_,t),this},p.prototype.refresh=function(t){return this.pushApiCall_("api.refresh",arguments),this.mediator.refresh(t),this},p.prototype.prefixDefaultBidKey=function(t){return this.mediator.prefixDefaultBidKey(t),this},p.prototype.omitDefaultBidKey=function(t){return this.mediator.omitDefaultBidKey(t),this},p.prototype.throwErrors=function(t){return this.mediator.throwErrors(t),this},p.prototype.library=i.library,e.pubfood=i,i})},{"./errors":5,"./event":6,"./interfaces":7,"./logger":8,"./mediator/auctionmediator":9,"./util":17}],16:[function(t,e,i){"use strict";function r(){this.id=o.newId(),this.params_={}}var o=t("./util");r.prototype.setParam=function(t,e){var i=o.asType(t);return"object"!==i&&"array"!==i&&"function"!==i&&"undefined"!==i&&(this.params_[t]=e),this},r.prototype.getParam=function(t){return this.params_[t]},r.prototype.getParamKeys=function(){var t=[];for(var e in this.params_)t.push(e);return t},e.exports=r},{"./util":17}],17:[function(t,e,i){"use strict";var r={asType:function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},newId:function(){return(+new Date).toString(36)+"xxxxxxxxxx".replace(/[x]/g,function(){return(0|36*Math.random()).toString(36)})},extendsObject:function(t,e){for(var i in e.prototype)t.prototype[i]=e.prototype[i];
t.prototype.parents=t.prototype.parents||[],t.prototype.parents.push(function(){return e}),t.prototype.init_=function(t,e,i,r,o){for(var n=this.parents||[],s=arguments.length,a=0;a<n.length;a++)switch(s){case 0:n[a]().call(this);break;case 1:n[a]().call(this,t);break;case 2:n[a]().call(this,t,e);break;case 3:n[a]().call(this,t,e,i);break;case 4:n[a]().call(this,t,e,i,r);break;default:n[a]().call(this,t,e,i,r,o)}}},hasFunctions:function(t,e){if(!t)return!1;for(var i=!0,o=0;o<e.length;o++){var n=e[o];if(!t[n]||"function"===!r.asType(t[n])){i=!1;break}}return i},loadUri:function(t,e){var i=document,r=t||"";if(e)if("complete"===i.readyState||"loaded"===i.readyState);else try{i.write('<script src="'+r+'"></script>')}catch(o){}else{var n=document.createElement("script");n.async=!0,n.src=r,(i.head||i.body||i.documentElement).appendChild(n)}},bind:function(t,e){return function(){t.apply(e,Array.prototype.slice.call(arguments))}},mergeToObject:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(this.isObject(e[i])?(t[i]||(t[i]={}),this.mergeToObject(t[i],e[i])):this.isArray(e[i])?(t[i]||(t[i]=[]),this.mergeToArray(t[i],e[i])):t[i]=e[i]);return t},mergeToArray:function(t,e){for(var i=0;i<e.length;i++)t.push(this.clone(e[i]));return t},isArray:function(t){return!!t&&"array"===this.asType(t)},isObject:function(t){return!!t&&"object"===this.asType(t)},clone:function(t){return this.isObject(t)?this.cloneObject(t):this.isArray(t)?this.cloneArray(t):t},cloneArray:function(t){return this.mergeToArray([],t)},cloneObject:function(t){return this.mergeToObject({},t)},values:function(t){var e=[];for(var i in t)e.push(t[i]);return e},validate:function(t,e){if(!e)return!1;var i=0;for(var o in t)if("optional"!==o){var n=!!t.optional&&!!t.optional[o],s=e.hasOwnProperty(o),a=this.asType(e[o]),u=!e.init,p=!0;if(("null"===a||"undefined"===a||"number"===a&&!isFinite(e[o])||"string"===a&&""===e[o])&&(p=!1),n||s&&p||++i,p&&u&&r.isArray(e[o])&&0===e[o].length&&++i,p&&!u&&r.asType(e[o])!==r.asType(t[o])&&++i,i>0)break}return!i}};r.randomize=function(t){for(var e,i,r=t.length;r;)i=Math.floor(Math.random()*r--),e=t[r],t[r]=t[i],t[i]=e;return t},e.exports=r},{}]},{},[15])(15)});
;

/* /js/bq/pubfood/bdr/openrtb/OpenRTBAuction */
var OpenRTBAuction=function(bqAdConfig,bqPv,dspMgr,dspVer){var self=this;self.bqAdConfig=bqAdConfig;self.bqPv=bqPv;self.dspMgr=dspMgr;self.dspVer=dspVer};
OpenRTBAuction.prototype={seqNum:0,log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=["[ OpenRTBAuction ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},rndI:function(){return Math.floor(1E6*Math.random())},nextSeq:function(){var self=this;if(self.seqNum===0)self.seqNum=self.rndI();else self.seqNum=self.seqNum+1;return self.seqNum},_getDNT:function(){return navigator.doNotTrack==="1"||window.doNotTrack==="1"||navigator.msDoNotTrack===
"1"||window.doNotTrack==="yes"},_getLocation:function(){var loc="";try{loc=window.top.location.href}catch(e){loc=window.location.href}return loc},generateNextId:function(){var self=this;return self.nextSeq().toString()},generateImpRequest:function(reqId,tagId,size){var self=this;var secure=0;if(document.location.protocol==="https:")secure=1;var tagRequest={id:reqId,banner:{w:size[0],h:size[1]},secure:secure,tagId:tagId,displaymanager:self.dspMgr,displaymanagerver:self.dspVer};return tagRequest},addBidFloor:function(bfMinDol,
placement,predData,ratio,tagRequest){var self=this;var bf=.2;if(!predData[placement.get("elementId")])self.log("no bf");else{bf=predData[placement.get("elementId")]*ratio;bf=Math.max(bf,bfMinDol);bf=bqMillRound(bf);self.log("bf",bf);tagRequest.bidfloor=bf;tagRequest.bidfloorcur="USD"}},generateSiteData:function(siteId){var self=this;var btimeout=self.bqAdConfig.get("timeout");var rfr=document.referrer?document.referrer:"";var site={"id":siteId,"privacypolicy":1,"tmax":btimeout,"domain":"www.brainyquote.com",
"page":self._getLocation(),"ref":rfr,"mobile":self.bqPv.isMobile()};return site},generateDeviceData:function(){var self=this;var dev={ua:navigator.userAgent,h:screen.height,w:screen.width,dnt:self._getDNT()?1:0,language:self.bqAdConfig.get("lang"),make:navigator.vendor?navigator.vendor:""};return dev}};
;

/* /js/bq/pubfood/bdr/anstyle/BidHandler */
var BidHandler=function(bidder,pubfood){var self=this;self.bidder=bidder;self.pubfood=pubfood;self.auctionId=self.pubfood.getAuctionId();self.bqAdConfig=bidder.bqAdConfig;self.predFactory=bidder.predFactory;self.bidRequests={};self.bidCount=0;self.bidsReceived=0;self.bhTs=(new Date).valueOf();self._setupReferrer();self.log("bid requests on init",self.bidRequests)};
BidHandler.prototype={endpoint:"//ib.adnxs.com/jpt",secureEndpoint:"//secure.adnxs.com/jpt",log:function(msg){var self=this;if(this.bqAdConfig.get("logOn")){var newArgs=["[ "+self.bidder.desc+" - "+self.auctionId+" ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},_hunCentsToCents:function(hunCents){return hunCents/1E4},_tenCentRound:function(bidInCents){return Math.floor(bidInCents*10)*10},_floorAtTwenty:function(bidInCents){return Math.min(bidInCents,
2E3)},_roundFloor:function(floor){return Math.floor(floor*100)/100},_discountBid:function(rawBid,disc){return rawBid*(1-disc)},_setSizesInParams:function(bidParams,sizes){var size="";var psizes=[];for(var x=0;x<sizes.length;x++){var s=sizes[x];var sizestr=s[0]+"x"+s[1];if(x===0)size=sizestr;else psizes.push(sizestr)}bidParams.size=size;if(psizes.length>0)bidParams.promo_sizes=psizes.join()},_checkForDone:function(){var self=this;if(self.bidsReceived===self.bidCount)self.doneCB()},_setupReferrer:function(){var self=
this;var ref="";try{ref=window.top.location.href}catch(e){ref=window.location.href}self.referrer=ref;self.log("referrer",self.referrer)},_bidResponse:function(bidRequest,bidResponse){var self=this;self.log("bidResponse",bidResponse);var disc=0;if(bidRequest.disc)disc=bidRequest.disc;var result=bidResponse.result;var rawBid=result.cpm;var discBid=self._discountBid(rawBid,disc);var bidInCents=self._hunCentsToCents(discBid);var roundedBid=self._tenCentRound(bidInCents);var finalBid=self._floorAtTwenty(roundedBid);
var sizes=[[result.width,result.height]];if(finalBid>0){try{var slot=self.slotForDiv(bidRequest.elementId);if(slot)if(result.ad){var slotTargeting={};slotTargeting[self.bidder.bidKey]=finalBid.toString();slotTargeting[self.bidder.adIdKey]=bidRequest.adId;self.log("slotTargeting",slotTargeting);self._saveAdData(bidRequest.adId,result.ad,result.width,result.height)}else throw"No ad found in response";else throw"Could not find slot for elementID "+bidRequest.elementId;}catch(e){BQErrorLog.logError("BidHandler invalid bid response for bidder "+
self.bidder.cn+", request:\n"+JSON.stringify(bidRequest)+"\nresponse:\n"+JSON.stringify(bidResponse)+"\nException:\n",e)}var bidObject={slot:slot.name,value:finalBid,sizes:sizes,targeting:slotTargeting};self.pushBidCB(bidObject)}else if(rawBid>0)self.log("Ignoring bid under 10 cents.")},_saveAdData:function(adId,adUrl,width,height){var self=this;self.bidder.adLookup[adId]={adUrl:adUrl,width:width,height:height}},_callForBid:function(bidRequest){var self=this;var url=document.location.protocol==="https:"?
self.secureEndpoint:self.endpoint;var ts=+new Date;var xhr=$.ajax({url:url,jsonp:"callback",dataType:"jsonp",data:bidRequest.params,error:function(error){self.bidsReceived=self.bidsReceived+1;self.log("error",error);self._checkForDone()},success:function(response){var ts2=+new Date;self.log(pf.getAuctionId()+" "+self.bidder.cn+" ajax call for "+url+" took "+(ts2-ts)+"ms");self.bidsReceived=self.bidsReceived+1;if(self.auctionId==self.pubfood.getAuctionId())self._bidResponse(bidRequest,response);else self.log("Received bid for previous auction "+
self.auctionId,response);self._checkForDone()}});return xhr},_addBidForPlacementWithDiv:function(bidderConfig,placement,elId,predData){var self=this;var plid=bidderConfig.get("plid");self.log("Placement ID:"+plid);var sizes=placement.get("hbSizes");var disc=0;if(bidderConfig.get("disc"))disc=bidderConfig.get("disc");var bfMinDol=self.predFactory.minFloorCents(disc);self.log("bfMinDol",bfMinDol);self.bidCount=self.bidCount+1;var adKey=self.bidder.cn+self.bidCount+"_"+self.bhTs;var callbackId=adKey+
"_"+Math.floor(1E7*Math.random());self.log("callbackId",callbackId);var bidParams={id:plid,psa:0,callback_uid:callbackId,referrer:self.referrer};if(bidderConfig.get("uf")){var ratio=bidderConfig.get("bfp");var bf=predData[placement.get("elementId")]*ratio;if(bf>0){bf=self._roundFloor(bf);self.log("bf",bf);bf=Math.max(bf,bfMinDol);bidParams["reserve"]=bf;self.log("BidHandler bf",bf)}}self.log("bidParams",bidParams);self._setSizesInParams(bidParams,sizes);self.bidRequests[elId]={elementId:elId,adId:adKey,
params:bidParams,disc:disc}},createBidRequests:function(bidderName,slotNameMap,predData){var self=this;var placements=self.bqAdConfig.getPlacements();for(var i=0;i<placements.length;i++){var placement=placements[i];var bidderConfig=placement.getBidder(bidderName);if(bidderConfig){var slot=slotNameMap[placement.get("name")];if(slot){var divId=slot.elementId;self._addBidForPlacementWithDiv(bidderConfig,placement,divId,predData);self.log(bidderName+" enabled on divId",divId)}}}},requestBids:function(){var self=
this;self.log("requestBids requesting",self.bidRequests);for(var bidId in self.bidRequests)if(self.bidRequests.hasOwnProperty(bidId)){var bidRequest=self.bidRequests[bidId];self.log(bidId+" -\x3e "+bidRequest);self._callForBid(bidRequest)}},_initCB:function(slots,pushBid,done){var self=this;try{self.doneCB=done;self.pushBidCB=pushBid;self.slotNameMap=slotsBySlotName(slots);self.slotMap=slotsByDivs(slots)}catch(err){BQErrorLog.logError(self.bidder.desc+" _initCB",err)}},slotForDiv:function(div){var self=
this;return self.slotMap[div]},_sendBidRequest:function(predData){var self=this;self.createBidRequests(self.bidder.bidderName,self.slotNameMap,predData);self.requestBids()},runAuction:function(slots,pushBid,done,pFactory){var self=this;self.log("runAuction called with slots",slots);self._initCB(slots,pushBid,done);pFactory.getPred(function(predData){self._sendBidRequest(predData)})}};
BidHandler.creativeCall=function(doc,adId,bidderObj){try{var adData=bidderObj.adLookup[adId];if(adData)BidHandler.renderAd(doc,adData);else throw"Could not find adId: "+adId+" in ad lookup "+JSON.stringify(bidderObj.adLookup);}catch(err){BQErrorLog.logError(bidderObj.desc+" render failed",err)}};
BidHandler.renderAd=function(doc,adData){try{var adUrl=adData.adUrl;var width=adData.width;var height=adData.height;doc.write('\x3cIFRAME SRC\x3d"'+adUrl+'" FRAMEBORDER\x3d"0" SCROLLING\x3d"no" MARGINHEIGHT\x3d"0" MARGINWIDTH\x3d"0" TOPMARGIN\x3d"0" LEFTMARGIN\x3d"0" ALLOWTRANSPARENCY\x3d"true" WIDTH\x3d"'+width+'" HEIGHT\x3d"'+height+'"\x3e\x3c/IFRAME\x3e');doc.close();if(doc.defaultView&&doc.defaultView.frameElement){doc.defaultView.frameElement.width=width;doc.defaultView.frameElement.height=height}}catch(err){BQErrorLog.logError("BidHandler renderAd error",
err)}};BidHandler.requiresDocumentOpen=function(){try{return navigator.userAgent.toString().toLowerCase().indexOf("msie")===-1}catch(e){return true}};
BidHandler.renderAdBody=function(doc,divId,width,height,adContent){document.getElementById(divId).innerHTML="";var ifr=document.createElement("iframe");ifr.width=width;ifr.height=height;ifr.style.border="0px";ifr.scrolling="no";ifr.frameborder=0;ifr.allowtransparency=!0;document.getElementById(divId).appendChild(ifr);var ifrDoc=ifr.contentWindow?ifr.contentWindow.document:ifr.contentDocument.document?ifr.contentDocument.document:ifr.contentDocument;if(BidHandler.requiresDocumentOpen())ifrDoc.open();
ifrDoc.write("\x3cstyle\x3ebody { margin: 0px !important; }\x3c/style\x3e");ifrDoc.write(adContent);if(BidHandler.requiresDocumentOpen())ifrDoc.close()};
;

/* /js/bq/pubfood/bdr/anstyle/AppNexusDirectBidder */
var AppNexusDirectBidder=function(pf,bqAdConfig,predFactory){var self=this;self.pubfood=pf;self.bqAdConfig=bqAdConfig;self.predFactory=predFactory;self.adLookup={};window.anBidder=self;window.renderAppNexusAd=window.renderAppNexusAd||function(doc,adId){BidHandler.creativeCall(doc,adId,window.anBidder)}};
AppNexusDirectBidder.prototype={cn:"AN",bidderName:"appnexus",bidKey:"hb_an",adIdKey:"hb_an_adid",desc:"AppNexus",go:function(){var self=this;try{self.pubfood.addBidProvider({name:self.bidderName,libUri:" ",init:function(slots,pushBid,done){self.bidHandler=new BidHandler(self,self.pubfood);self.bidHandler.runAuction(slots,pushBid,done,self.predFactory)},refresh:function(slots,pushBid,done){self.bidHandler=new BidHandler(self,self.pubfood);self.bidHandler.runAuction(slots,pushBid,done,self.predFactory)}})}catch(err){BQErrorLog.logError(self.desc+
" go",err)}}};
;

/* /js/bq/pubfood/bdr/anstyle/BRealTimeBidder */
var BRealTimeBidder=function(pf,bqAdConfig,predFactory){var self=this;self.pubfood=pf;self.bqAdConfig=bqAdConfig;self.predFactory=predFactory;self.adLookup={};window.brtBidder=self;window.renderBRTAd=window.renderBRTAd||function(doc,adId){BidHandler.creativeCall(doc,adId,window.brtBidder)}};
BRealTimeBidder.prototype={cn:"BRT",bidderName:"brealtime",bidKey:"hb_br",adIdKey:"hb_br_adid",desc:"bRealTime",go:function(){var self=this;try{self.pubfood.addBidProvider({name:self.bidderName,libUri:" ",init:function(slots,pushBid,done){self.bidHandler=new BidHandler(self,self.pubfood);self.bidHandler.runAuction(slots,pushBid,done,self.predFactory)},refresh:function(slots,pushBid,done){self.bidHandler=new BidHandler(self,self.pubfood);self.bidHandler.runAuction(slots,pushBid,done,self.predFactory)}})}catch(err){BQErrorLog.logError(self.desc+
" go",err)}}};
;

/* /js/bq/pubfood/bdr/anstyle/DefyBidder */
var DefyBidder=function(pf,bqAdConfig,predFactory){var self=this;self.pubfood=pf;self.bqAdConfig=bqAdConfig;self.predFactory=predFactory;self.adLookup={};window.dfBidder=self;window.renderDefyAd=window.renderDefyAd||function(doc,adId){BidHandler.creativeCall(doc,adId,window.dfBidder)}};
DefyBidder.prototype={cn:"DF",bidderName:"defy",bidKey:"hb_df",adIdKey:"hb_df_adid",desc:"DefyMedia",go:function(){var self=this;try{self.pubfood.addBidProvider({name:self.bidderName,libUri:" ",init:function(slots,pushBid,done){self.bidHandler=new BidHandler(self,self.pubfood);self.bidHandler.runAuction(slots,pushBid,done,self.predFactory)},refresh:function(slots,pushBid,done){self.bidHandler=new BidHandler(self,self.pubfood);self.bidHandler.runAuction(slots,pushBid,done,self.predFactory)}})}catch(err){BQErrorLog.logError(self.desc+
" go",err)}}};
;

/* /js/bq/pubfood/bdr/anstyle/DistrictMBidder */
var DistrictMBidder=function(pf,bqAdConfig,predFactory){var self=this;self.pubfood=pf;self.bqAdConfig=bqAdConfig;self.predFactory=predFactory;self.adLookup={};window.dmBidder=self;window.renderDistrictMAd=window.renderDistrictMAd||function(doc,adId){BidHandler.creativeCall(doc,adId,window.dmBidder)}};
DistrictMBidder.prototype={cn:"DM",bidderName:"districtm",bidKey:"hb_dm",adIdKey:"hb_dm_adid",desc:"DistrictM",go:function(){var self=this;try{self.pubfood.addBidProvider({name:self.bidderName,libUri:" ",init:function(slots,pushBid,done){self.bidHandler=new BidHandler(self,self.pubfood);self.bidHandler.runAuction(slots,pushBid,done,self.predFactory)},refresh:function(slots,pushBid,done){self.bidHandler=new BidHandler(self,self.pubfood);self.bidHandler.runAuction(slots,pushBid,done,self.predFactory)}})}catch(err){BQErrorLog.logError(self.desc+
" go",err)}}};
;

/* /js/bq/pubfood/bdr/AmazonBidder */
var amznads=amznads||{};var AmazonBidder=function(pf,bqAdConfig){this.pubfood=pf;this.bqAdConfig=bqAdConfig};
AmazonBidder.prototype={cn:"Amzn",log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=["[ "+this.cn+" ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},go:function(){var self=this;self.pubfood.addBidProvider({name:"amazon",libUri:"//c.amazon-adsystem.com/aax2/amzn_ads.js",init:function(slots,pushBid,done){try{var bidderTimeout=self.bqAdConfig.get("timeout");self.log("amzn timeout",bidderTimeout);amznads.asyncParams={"id":"3224",
"callbackFn":function(){try{if("amznslots"){amznads.targetingKey="amznslots";var amznvalues=amznads.getTokens();if(typeof amznvalues!=="undefined"&&amznvalues.length>0)for(var i=0;i<slots.length;i++){var slot=slots[i];var bid={slot:slot.name,targeting:{"amznslots":amznvalues}};pushBid(bid)}}done()}catch(e){BQErrorLog.logError("amzn cb:  ",e)}},"timeout":bidderTimeout}}catch(e){BQErrorLog.logError("amzn init:  ",e)}},refresh:function(slots,pushBid,done){self.log("refresh called with slots",slots);
done()}})}};
;

/* /js/bq/pubfood/bdr/A9SlotAuction */
var A9SlotAuction=function(bqAdConfig,slotMap,pushBid,done){this.bqAdConfig=bqAdConfig;this.slotMap=slotMap;this.bidCallback=pushBid;this.doneCallback=done};
A9SlotAuction.prototype={log:function(msg){if(true||this.bqAdConfig.get("logOn")){var newArgs=["[ A9SlotAuction ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},run:function(){var self=this;bqLoadWithCallback("//c.amazon-adsystem.com/aax2/apstag.js",function(){self.log("load complete");var bidderTimeout=self.bqAdConfig.get("timeout");self.log("amzn timeout",bidderTimeout);apstag.init({pubID:"3224",adServer:"googletag",bidTimeout:bidderTimeout});
apstag.debug("enable");window.apstagDEBUG={testBidTimeout:200};var slotDefs=[];for(var divId in self.slotMap){var slot=self.slotMap[divId];self.log("slot",slot);var elId=slot.elementId;self.log("elId",elId);var sizes=slot.sizes;self.log("sizes",sizes);slotDefs.push({slotID:elId,sizes:sizes})}apstag.fetchBids({slots:slotDefs,timeout:bidderTimeout},function(bids){self.log("fetch bids",bids);var amznKeysToTarget=["amznbid","amzniid"];bids.forEach(function(bid){var sizeStr=szStringtoAry(bid.size);var slotID=
bid.slotID;var slot=self.slotMap[slotID];var keyVals={};amznKeysToTarget.forEach(function(key){var val=bid[key];if(val)keyVals[key]=val});self.log("keyvals",keyVals);var bidObject={slot:slot.name,sizes:[sizeStr],targeting:keyVals};self.log("bidObject",bidObject);self.bidCallback(bidObject)});self.doneCallback()})})}};
;

/* /js/bq/pubfood/bdr/A9SlotBidder */
/* globals
     $, konsole, jQuery, BQErrorLog, JsLOG, pf,
     googletag
 */

var A9SlotBidder = function (pf,bqAdConfig) {
    this.pubfood = pf;
    this.bqAdConfig = bqAdConfig;
};

A9SlotBidder.prototype = {
    cn: "A9Slot",
    log: function(msg) {
        if (true || this.bqAdConfig.get("logOn")) {
            var newArgs = ["[ " + this.cn + " ] ------>"];
            for (var i = 0; i < arguments.length; i++) {
                newArgs.push(arguments[i]);
            }
            konsole.log.apply(konsole, newArgs);
        }
    },
    go: function () {
        var self = this;
        self.pubfood.addBidProvider({
            name: 'amazon',
            libUri: ' ',
            init: function (slots, pushBid, done) {
                try {
                    var slotMap = slotsByDivs(slots);
                    var a9Auction = new A9SlotAuction(self.bqAdConfig, slotMap, pushBid, done);
                    a9Auction.run();
                } catch (e) {
                    BQErrorLog.logError("amzn init:  ", e);
                }
            },
            refresh: function (slots, pushBid, done) {
                try {
                    self.log("refresh called with slots", slots)
                    var slotMap = slotsByDivs(slots);
                    var a9refresh = new A9SlotAuction(self.bqAdConfig, slotMap, pushBid, done);
                    a9refresh.run();
                } catch (e) {
                    BQErrorLog.logError("amzn init:  ", e);
                }
            }
        })
    }
};
;

/* /js/bq/pubfood/bdr/AOLFlooringBidder */
var AOLFlooringBidder=function(pf,bqAdConfig,bqpred,pubtaglib_script){this.pubfood=pf;this.bqAdConfig=bqAdConfig;this.url=pubtaglib_script;this.predFactory=bqpred;window.aolFlooringBidder=this};
AOLFlooringBidder.prototype={cn:"AOLFlr",aolSlots:[],doneCB:undefined,pushBidCB:undefined,adjustment:-15,log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=["[ AOLFlr ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},go:function(){var self=this;try{pf.addBidProvider({name:"aol",libUri:" ",init:function(slots,pushBid,done){self.log("init [start]");self.doneCB=done;self.pushBidCB=pushBid;self.aolSlots=slots;self.slotNameMap=
slotsBySlotName(slots);self.predFactory.getPred(function(predData){self.floorsReady(predData)});self.log("init [end]")},refresh:function(slots,pushBid,done){done()}});self.log("go [end]")}catch(err){BQErrorLog.logError("aol go",err)}},floorsReady:function(predData){var self=this;try{if(self.cn!=="AOLFlr")throw"Bad self";self.log("floorsReady [start]");if(bqAuctionRan){self.log("floorsReady [auction over]");return}self.log("floorsReady",predData);var bidTimeout=3E3;if(self.bqAdConfig.get("timeout"))bidTimeout=
self.bqAdConfig.get("timeout");bidRequestConfig={server:"adserver.adtechus.com",network:"10289.1",bidKey:"aolbid",onBidResponse:function(response){window.aolFlooringBidder._responseHandler(response)},onAllBidsResponses:function(){window.aolFlooringBidder._doneHandler()},bidResponseTimeout:bidTimeout,adjustment:self.adjustment,formatCpmToDecimal:false,roundingConfig:[{from:0,to:2E3,roundFunction:"tenCentsRound"},{from:2001,to:4E3,roundFunction:"hundredFloor"},{from:4001,to:-1,roundValue:4E3}]};dacBidRequestConfigs=
[];var isHTTPS="https:"===document.location.protocol;var plcmnts=self.bqAdConfig.getPlacements();for(var p=0;p<plcmnts.length;p++){var pl=plcmnts[p];if(self.slotNameMap[pl.get("name")]){var aolBidder=pl.getBidder("aol");var divId=pl.get("elementId");if(aolBidder){var bidRequest={placement:aolBidder.get("plid"),alias:aolBidder.get("name"),adContainerId:pl.get("elementId"),secure:isHTTPS,performScreenDetection:false,gpt:{adUnitPath:pl.get("name"),size:aolBidder.get("aolAdSizes")}};if(aolBidder.get("uf")){var bf=
"0.10";var ratio=.1;if(aolBidder.get("bfp"))ratio=aolBidder.get("bfp");if(predData[divId]){var bfN=self._calcFloor(predData[divId],ratio);bf=bfN.toString()}bidRequest.bidfloor=bf}else self.log("Request floors off");dacBidRequestConfigs.push(bidRequest)}}}self.log("dacBidRequestConfigs\x3d"+JSON.stringify(dacBidRequestConfigs));self._loadUrl(self.url)}catch(err){BQErrorLog.logError("aol floors ready",err)}},_calcFloor:function(pred,ratio){var self=this;var fl=.1;if(pred){fl=ratio*pred;var adj=1+self.adjustment/
100;fl=fl/adj;fl=fl.toFixed(2);self.log("bf",fl)}return fl},_loadUrl:function(libUrl){var self=this;try{if(self.cn!=="AOLFlr")throw"Bad self";self.log("Loading url",libUrl);bqLoadWithCallback(libUrl,function(){AOLFlooringBidder.loadedCallback()})}catch(err){BQErrorLog.logError("AOLFlr _loadUrl:",err)}},_responseHandler:function(response){var self=this,pfSlot={};try{if(self.cn!=="AOLFlr")throw"Bad self";if(!bqAuctionRan){var config=response.gpt;var slotName=response.adContainerId;var cpm=response.cpm;
if(!response.refreshed||cpm===null&&!config.slot){pfSlot="undefined_slot";for(var k=0;k<self.aolSlots.length;k++)if(slotName===self.aolSlots[k].elementId)pfSlot=self.aolSlots[k];if(cpm&&cpm!==""){try{cpm=adjustCentsBidM1(cpm);validateBidValue(cpm)}catch(err){JsLOG.push("aol badbid\x3d"+cpm);BQErrorLog.logError("(WARN) aol badbid",err)}self.log("Slot "+pfSlot.name+" got bid of "+cpm+" with alias\x3d"+response.alias);var aolT={};var cpmString=cpm.toString();aolT[response.bidKey]=[cpmString];aolT[response.mpAliasKey]=
[response.alias];var bidObject={slot:pfSlot.name,value:cpm,sizes:pfSlot.sizes,targeting:aolT};self.pushBidCB(bidObject)}else self.log("Slot "+pfSlot.name+" got a null bid")}else if(response.refreshed)self.log("ignoring refreshed response");else self.log("For slot "+response.alias+" ignored response with CPM \x3d "+cpm+" and config slot"+config.slot)}else{self.log("Skipping late AOL bid on slot",pfSlot.name);self.log("aol bid came in after auction ran")}self.log("_pubTagLibHandler [end]")}catch(err){konsole.log("error with bid response "+
response.alias+" c:"+response.cpm);JsLOG.push("error with bid response "+response.alias+" c:"+response.cpm);BQErrorLog.logError("aol bid response error",err)}},_doneHandler:function(){var self=this;self.log("_doneHandler called");if(!bqAuctionRan)self.doneCB()}};AOLFlooringBidder.loadedCallback=function(){for(var i=0;i<dacBidRequestConfigs.length;i++)ADTECH.loadPubAd(dacBidRequestConfigs[i].alias)};
;

/* /js/bq/pubfood/bdr/CriteoBidder */
var CriteoAuction=function(pf,bqAdConfig,bqpred,crtAuctionIdIn){this.pubfood=pf;this.bqAdConfig=bqAdConfig;this.predFactory=bqpred;this.crtAuctionId=crtAuctionIdIn};
CriteoAuction.prototype={log:function(msg){var self=this;if(this.bqAdConfig.get("logOn")){var newArgs=["[ CriteoAuction : "+self.crtAuctionId+" ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},requestBids:function(){var self=this;try{var plcmnts=self.bqAdConfig.getPlacements();self.responsesNeeded=0;self.responsesBack=0;var zonePlcmnt={};for(var p=0;p<plcmnts.length;p++){var pl=plcmnts[p];var plName=pl.get("name");var pfslot=self.slotNameMap[plName];
if(pfslot){var bidder=pl.getBidder("criteo");if(bidder){self.disc=bidder.get("disc");var zoneIds=bidder.get("zoneIds");if(typeof zoneIds!=="undefined")for(var z=0;z<zoneIds.length;z++){var zone=zoneIds[z];zonePlcmnt[zone]=plName;self.log("zonePlmnt",zonePlcmnt)}}}}window.Criteo=window.Criteo||{};window.Criteo.events=window.Criteo.events||[];function bidFromResponse(bidResponse){var bidObject={};var bidAdj=self._normalizeBid(bidResponse.cpm);self.log("raw bid",bidResponse.cpm);var cpmFlr=bqDollarFloorToCents(bidAdj);
self.log("floor bid",cpmFlr);bidObject.impid=bidResponse.impid;bidObject.bid=cpmFlr;bidObject.ad=bidResponse.creative;bidObject.width=bidResponse.width;bidObject.height=bidResponse.height;self.log("bidObject",bidObject);return bidObject}function bidResponseHandler(slots){return function(bidsResponse){try{self.log("bidResponseHandler slots",slots);var resp=JSON.parse(bidsResponse);self.log("bidResponseHandler resp",resp);var bestBids={};if(typeof resp.slots!=="undefined"){for(var j=0;j<resp.slots.length;j++){var bidResponse=
resp.slots[j];if(bidResponse){var zone=bidResponse.zoneid;var plName=zonePlcmnt[zone];var bidObject=bidFromResponse(bidResponse);var pfSlot=self.slotNameMap[plName];bidObject.pfSlot=pfSlot;var bb=bestBids[pl];if(bb){if(bidObject.bid>bb.bid){self.log("this bid best",bidObject);bestBids[plName]=bidObject}}else bestBids[plName]=bidObject}}self.log("best bids",bestBids);var bidPlacements=Object.keys(bestBids);for(var bp=0;bp<bidPlacements.length;bp++){var plName=bidPlacements[bp];var bb=bestBids[plName];
var bidVal=bb.bid;var slotTargeting={hb_crt:bidVal,hb_crt_adid:bb.impid};var pfSlot=self.slotNameMap[plName];self.log("plName",plName);self.log("pfSlot",pfSlot);var szAry=[bb.width,bb.height];var pfBid={slot:pfSlot.name,value:bb.bid,sizes:szAry,targeting:slotTargeting};var divId=pfSlot.elementId;window.crtbidder.saveAdImpression(divId,bb.impid,bb.ad,szAry);self.log("pfBid",pfBid);self.criteoPushBid(pfBid)}}}catch(err){BQErrorLog.logError("criteo bidResponseHandler failed for response "+JSON.stringify(bidsResponse),
err)}self.criteoDone()}}function timeoutHandler(slots){return function(){self.log("timeout for request on slots",slots);self.criteoDone()}}function errorHandler(slots){return function(){self.log("error for request on slots",slots);self.criteoDone()}}self.log("creating slots for zonePlcmnt",zonePlcmnt);var biddingEventFunc=function(){var pId=125;var cslots=[];var zones=Object.keys(zonePlcmnt);var impId=1;for(var i=0;i<zones.length;i++){var z=zones[i];var plCode=self.crtAuctionId+"_au"+impId;cslots.push(new Criteo.PubTag.DirectBidding.DirectBiddingSlot(plCode,
z,undefined,undefined));impId++}self.log("cslots",cslots);var isAudit=false;var biddingEvent=new Criteo.PubTag.DirectBidding.DirectBiddingEvent(pId,new Criteo.PubTag.DirectBidding.DirectBiddingUrlBuilder(isAudit),cslots,bidResponseHandler(cslots),errorHandler(cslots),timeoutHandler(cslots));window.criteo_pubtag.push(biddingEvent)};window.Criteo.events.push(biddingEventFunc);var _publisherTagUrl=window.location.protocol+"//static.criteo.net/js/ld/publishertag.js";bqLoadWithCallback(_publisherTagUrl,
function(){self.log("criteo load done")})}catch(err){BQErrorLog.logError("criteo bidder failed",err);self.criteoDone()}},_normalizeBid:function(rawBid){var self=this;return rawBid*(1-self.disc)},runAuction:function(slots,pushBid,done){var self=this;self.criteoSlotMap=slotsByDivs(slots);self.slotNameMap=slotsBySlotName(slots);self.log("criteoSlotMap",self.criteoSlotMap);self.criteoPushBid=pushBid;self.criteoDone=done;self.requestBids()}};
var CriteoBidder=function(pf,bqAdConfig,bqpred){var self=this;self.pubfood=pf;self.bqAdConfig=bqAdConfig;self.predFactory=bqpred;self.crtAuctionMap={};self.crtAdLookup={};self.crtAuctionNum=1;window.crtbidder=this;window.rendercriteoAd=window.rendercriteoAd||function(doc,adid){try{var adObj=window.crtbidder.crtAdLookup[adid];if(adObj){window.crtbidder.log("rendering criteo ad",adObj);var width=adObj.size[0];var height=adObj.size[1];BidHandler.renderAdBody(doc,adObj.divId,width,height,adObj.script)}}catch(err){BQErrorLog.logError("criteo render failed",
err)}}};
CriteoBidder.prototype={cn:"CRT",log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=["[ CriteoBidder ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},saveAdImpression:function(divId,impId,script,size){var self=this;self.crtAdLookup[impId]={divId:divId,impId:impId,script:script,size:size};self.log("crtAdLookup",self.crtAdLookup)},go:function(){var self=this;if(self.cn!=="CRT")throw"Bad self";self.log("criteo go [start]");try{self.pubfood.addBidProvider({name:"criteo",
libUri:" ",init:function(slots,pushBid,done){try{self.log("criteo init [start]");var auctionId="first";var mainAuction=new CriteoAuction(self.pubfood,self.bqAdConfig,self.predFactory,auctionId);self.crtAuctionMap[auctionId]=mainAuction;mainAuction.runAuction(slots,pushBid,done)}catch(err){BQErrorLog.logError("criteo init",err)}},refresh:function(slots,pushBid,done){try{self.crtAuctionNum=self.crtAuctionNum+1;var auctionId="a"+self.crtAuctionNum;var refreshAuction=new CriteoAuction(self.pubfood,self.bqAdConfig,
self.predFactory,auctionId);self.crtAuctionMap[auctionId]=refreshAuction;refreshAuction.runAuction(slots,pushBid,done)}catch(err){BQErrorLog.logError("criteo refresh",err)}}})}catch(err){BQErrorLog.logError("criteo go",err)}}};
;

/* /js/bq/pubfood/bdr/IdxOpenRTB */
var IdxAuction=function(pf,bqAdConfig,bqpred){var self=this;self.pubfood=pf;self.bqAdConfig=bqAdConfig;self.predFactory=bqpred;self.slotNameMap={}};
IdxAuction.prototype={jsonpParam:"fn",seqNum:0,bidKey:"hb_idx",adIdKey:"hb_idx_adid",log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=["[ IdxAuction ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},rndI:function(){return Math.floor(1E6*Math.random())},nextSeq:function(){var self=this;if(self.seqNum===0)self.seqNum=self.rndI();else self.seqNum=self.seqNum+1;return self.seqNum},_initCB:function(slots,pushBid,done){var self=
this;try{self.doneCB=done;self.pushBidCB=pushBid;self.slotNameMap=slotsBySlotName(slots)}catch(err){BQErrorLog.logError("IdxOpenRTB _initCB",err)}},_getLocation:function(){var loc="";try{loc=window.top.location.href}catch(e){loc=window.location.href}return loc},_normalizeBid:function(rawBid){var self=this;return rawBid*(1-self.disc)},_priceLevelToPrice:function(pricelevel){var p=0;var prcAry=pricelevel.split("_");if(prcAry&&prcAry.length){var pstr=prcAry[prcAry.length-1];if(pstr)p=pstr}return p},
_sendBidRequest:function(predData){var self=this;var httpEndPoint="http://as.casalemedia.com/cygnus";var httpsEndPoint="https://as-sec.casalemedia.com/cygnus";var url=document.location.protocol==="https:"?httpsEndPoint:httpEndPoint;var procfg=self.bqAdConfig.getProCfg("indexExchange");self.disc=procfg.disc;var params={pid:183450,v:7,s:164175};var bidRequest={};bidRequest.id=self.nextSeq().toString();var ref=document.referrer;bidRequest.site={"ref":ref,"page":self._getLocation()};bidRequest.imp=[];
var placements=self.bqAdConfig.getPlacements();self.bidRequests={};self.bidRequestLookup={};for(var i=0;i<placements.length;i++){var placement=placements[i];var bidConfig=placement.getBidder("indexExchange");if(bidConfig){var slot=self.slotNameMap[placement.get("name")];if(slot){self.log("placementConfig.bdrs.indexExchange",bidConfig);var tags=bidConfig.get("tags");if(tags){var pname=placement.get("name");self.bidRequests[pname]=[];for(var j=0;j<tags.length;j++){var tag=tags[j];var reqId=self.nextSeq().toString();
var tagRequest={"id":reqId,"banner":{"w":tag.width,"h":tag.height,"topframe":0},"ext":{"sid":tag.tagNum.toString(),"siteID":tag.tagId}};if(bidConfig.get("uf")){var bf=.2;if(predData[placement.get("elementId")]){var ratio=bidConfig.get("bfp");bf=predData[placement.get("elementId")]*ratio;var bfMinDol=self.predFactory.minFloorCents(self.disc);self.log("bfMinDol",bfMinDol);bf=Math.max(bf,bfMinDol);self.log("bf after max",bf);bf=bqMillRound(bf);tagRequest.bidfloor=bf;tagRequest.bidfloorcur="USD"}}else self.log("bid floors disabled");
bidRequest.imp.push(tagRequest);self.bidRequests[pname].push(tagRequest);self.bidRequestLookup[reqId]=tagRequest}}}}}params.r=JSON.stringify(bidRequest);$.ajax({url:url,jsonp:self.jsonpParam,dataType:"jsonp",data:params,error:function(error){self.log("error",error);self.doneCB()},success:function(response){self._bidResponse(response);self.doneCB()}})},_bidResponse:function(bids){var self=this;self.log("got response",bids);var bidLookup={};if(bids&&bids.seatbid&&bids.seatbid[0]&&bids.seatbid[0].bid){for(var i=
0;i<bids.seatbid.length;i++){var seatbid=bids.seatbid[i];for(var j=0;j<seatbid.bid.length;j++){var bid=seatbid.bid[j];if(bid.impid&&bid.adm&&bid.ext.pricelevel){var price=self._priceLevelToPrice(bid.ext.pricelevel);self.log("raw price",price);price=self._normalizeBid(price);self.log("_normalizeBid price",price);bidLookup[bid.impid]={bid:bid,price:price}}}}self.log("bidLookup",bidLookup);for(var k=0;k<self.bqAdConfig.getPlacements().length;k++){var placement=self.bqAdConfig.getPlacements()[k];var bidderConf=
placement.getBidder("indexExchange");if(bidderConf){var reqsForSlot=self.bidRequests[placement.get("name")];var bestBid=null;if(reqsForSlot){for(var m=0;m<reqsForSlot.length;m++){var req=reqsForSlot[m];var bidData=bidLookup[req.id];if(bidData){self.log("Found bid ",bidData);self.log("For request ",req);if(!bestBid||bidData.price>bestBid.price)bestBid=bidData;else self.log("Discarding bid due to better (or same) value bid on same slot",bidData)}else self.log("No bid for request ",req)}if(bestBid){self.log("Pushing best bid for slot "+
placement.get("name"),bestBid);var bval=IdxOpenRTB.roundFunc(bestBid.price);if(bval>0){self.log("Best bid value",bval);var pfSlot=self.slotNameMap[placement.get("name")];self.log("Bid slot",pfSlot);self.log("best bid",bestBid);self.log("best bid bid",bestBid.bid);var reqId=bestBid.bid.impid;self.log("best bid bid reqId",reqId);var reqForBid=self.bidRequestLookup[reqId];self.log("reqForBid",reqForBid);var bidSizes=[[reqForBid.banner.w,reqForBid.banner.h]];var adm=bestBid.bid.adm;var plDiv=placement.get("elementId");
var slotDiv=pfSlot.elementId;self.log("divId for placement",plDiv);self.log("divId for bid",slotDiv);window.idxBidder.adLookup[reqId]={"w":reqForBid.banner.w,"h":reqForBid.banner.h,"adBody":adm,"divId":slotDiv};var slotTargeting={};slotTargeting[self.adIdKey]=reqId;slotTargeting[self.bidKey]=bval;var bidObject={slot:pfSlot.name,value:bval,sizes:bidSizes,targeting:slotTargeting};self.log("best bid",bidObject);self.pushBidCB(bidObject)}else self.log("ignoring bid under 10 cents")}}}}}else self.log("no bids")},
runAuction:function(slots,pushBid,done){var self=this;self._initCB(slots,pushBid,done);self.log("predFactory",self.predFactory);self.predFactory.getPred(function(predData){self._sendBidRequest(predData)})}};
var IdxOpenRTB=function(pf,bqAdConfig,bqpred){var self=this;self.pubfood=pf;self.bqAdConfig=bqAdConfig;self.predFactory=bqpred;self.adLookup={};window.idxBidder=self;window.renderIdxAd=window.renderIdxAd||function(doc,adId){try{window.idxBidder.log("rendering Index Exchange ad with adId",adId);var adData=window.idxBidder.adLookup[adId];if(adData){window.idxBidder.log("rendering Index Exchange ad to divId",adData.divId);BidHandler.renderAdBody(doc,adData.divId,adData.w,adData.h,adData.adBody)}else throw"No adId "+
adId+" in lookup "+JSON.stringify(window.idxBidder.adLookup);}catch(err){BQErrorLog.logError("Index Exchange render failed",err)}}};
IdxOpenRTB.prototype={cn:"Idx",log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=["[ IdxOpenRTB ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},go:function(){var self=this;try{self.pubfood.addBidProvider({name:"indexExchange",libUri:" ",init:function(slots,pushBid,done){self.log("init called with slots",slots);self.mainAuction=new IdxAuction(self.pf,self.bqAdConfig,self.predFactory);self.mainAuction.runAuction(slots,pushBid,
done)},refresh:function(slots,pushBid,done){self.log("refresh called");self.refreshAuction=new IdxAuction(self.pf,self.bqAdConfig,self.predFactory);self.refreshAuction.runAuction(slots,pushBid,done)}})}catch(err){BQErrorLog.logError("IdxOpenRTB go",err)}}};IdxOpenRTB.roundFunc=function(price){var bval=Math.floor(price/10)*10;if(bval>2E3)bval=Math.floor(bval/100)*100;if(bval>4E3)bval=4E3;return bval};
;

/* /js/openx/hblite.min */
(function(window){var k="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},m="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function p(){p=function(){};m.Symbol||(m.Symbol=t)}var u=0;function t(a){return"jscomp_symbol_"+(a||"")+u++}
function x(){p();var a=m.Symbol.iterator;a||(a=m.Symbol.iterator=m.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&k(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return y(this)}});x=function(){}}function y(a){var b=0;return z(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})}function z(a){x();a={next:a};a[m.Symbol.iterator]=function(){return this};return a}function A(a){x();var b=a[Symbol.iterator];return b?b.call(a):y(a)}
function B(a,b){if(b){for(var c=m,d=a.split("."),e=0;e<d.length-1;e++){var f=d[e];f in c||(c[f]={});c=c[f]}d=d[d.length-1];e=c[d];f=b(e);f!=e&&null!=f&&k(c,d,{configurable:!0,writable:!0,value:f})}}function C(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{v:e,G:f}}return{v:-1,G:void 0}}B("Array.prototype.find",function(a){return a?a:function(a,c){return C(this,a,c).G}});
B("Promise",function(a){function b(a){this.b=0;this.h=void 0;this.a=[];var b=this.f();try{a(b.resolve,b.reject)}catch(h){b.reject(h)}}function c(){this.a=null}if(a)return a;c.prototype.b=function(a){this.a||(this.a=[],this.f());this.a.push(a)};c.prototype.f=function(){var a=this;this.c(function(){a.h()})};var d=m.setTimeout;c.prototype.c=function(a){d(a,0)};c.prototype.h=function(){for(;this.a&&this.a.length;){var a=this.a;this.a=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(n){this.g(n)}}}this.a=
null};c.prototype.g=function(a){this.c(function(){throw a;})};b.prototype.f=function(){function a(a){return function(f){c||(c=!0,a.call(b,f))}}var b=this,c=!1;return{resolve:a(this.P),reject:a(this.g)}};b.prototype.P=function(a){if(a===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof b)this.T(a);else{var c;a:switch(typeof a){case "object":c=null!=a;break a;case "function":c=!0;break a;default:c=!1}c?this.M(a):this.A(a)}};b.prototype.M=function(a){var b=void 0;
try{b=a.then}catch(h){this.g(h);return}"function"==typeof b?this.V(b,a):this.A(a)};b.prototype.g=function(a){this.B(2,a)};b.prototype.A=function(a){this.B(1,a)};b.prototype.B=function(a,b){if(0!=this.b)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.b);this.b=a;this.h=b;this.L()};b.prototype.L=function(){if(this.a){for(var a=this.a,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.a=null}};var e=new c;b.prototype.T=function(a){var b=this.f();a.c(b.resolve,b.reject)};b.prototype.V=
function(a,b){var c=this.f();try{a.call(b,c.resolve,c.reject)}catch(n){c.reject(n)}};b.prototype.then=function(a,c){function d(a,b){return"function"==typeof a?function(b){try{e(a(b))}catch(O){f(O)}}:b}var e,f,g=new b(function(a,b){e=a;f=b});this.c(d(a,e),d(c,f));return g};b.prototype["catch"]=function(a){return this.then(void 0,a)};b.prototype.c=function(a,b){function c(){switch(d.b){case 1:a(d.h);break;case 2:b(d.h);break;default:throw Error("Unexpected state: "+d.b);}}var d=this;this.a?this.a.push(function(){e.b(c)}):
e.b(c)};b.resolve=function(a){return a instanceof b?a:new b(function(b){b(a)})};b.reject=function(a){return new b(function(b,c){c(a)})};b.race=function(a){return new b(function(c,d){for(var e=A(a),f=e.next();!f.done;f=e.next())b.resolve(f.value).c(c,d)})};b.all=function(a){var c=A(a),d=c.next();return d.done?b.resolve([]):new b(function(a,e){function f(b){return function(c){g[b]=c;h--;h||a(g)}}var g=[],h=0;do g.push(void 0),h++,b.resolve(d.value).c(f(g.length-1),e),d=c.next();while(!d.done)})};b.$jscomp$new$AsyncExecutor=
function(){return new c};return b});B("Array.prototype.findIndex",function(a){return a?a:function(a,c){return C(this,a,c).v}});function D(a){for(var b in a)a.hasOwnProperty(b)&&(a[b]||delete a[b]);return Object.keys(a).map(function(b){return b+"\x3d"+a[b]}).join("\x26")}function E(a){return a.substring(a.indexOf("?")+1).split("\x26").reduce(function(a,c){var b=c.split("\x3d");a[b[0]]=b[1];return a},{})};function F(a,b){return a.map(function(a){return a.oxAdUnitId&&"display"===a.type||G(a)?a:b.find(function(b){return a.getSlotElementId&&b.divId===a.getSlotElementId()})}).filter(function(a){return a})}function H(a){return a.reduce(function(a,c){G(c)?a[1].push(c):a[0].push(c);return a},[[],[]])}function G(a){return a.oxAdUnitId&&"video"===a.type};function I(a){return a.reduce(function(a,c){return a.concat(Array.isArray(c)?I(c):c)},[])};function J(a,b,c,d){if(!Array.isArray(b))return"";var e=K(b),f=c.self!==c.top,g={};g.auid=L(b);g.aus=M(b);g.bc=a;g.be=1;g.ch=c.document.a||c.document.characterSet;g.ifr=f;g.jr=c.document.referrer;g.ju=c.location.href&&encodeURIComponent(c.location.href);g.res=c.screen.width+"x"+c.screen.height+"x"+c.screen.colorDepth;a=c;b=c.document;f?(a=c.top,b=c.top.document,f=b.documentElement,b=b.body,c=a.innerWidth||f.clientWidth||b.clientWidth,a=a.innerHeight||f.clientHeight||b.clientHeight):(f=b.documentElement,
c=a.innerWidth||f.clientWidth,a=a.innerHeight||f.clientHeight);g.tws=c+"x"+a;g.tz=(new Date).getTimezoneOffset();d&&(g.callback=d);e&&(g.aumf=e);return D(g)}function P(a,b,c,d){var e={};e.url=c.location.href&&encodeURIComponent(c.location.href);e.be=!0;e.auid=b.oxAdUnitId;e.bc=a;e.test=1;d&&(e.jsonp=d);return D(e)}
function K(a){var b=a.reduce(function(a,b){if(!a[b.oxAdUnitId]&&b.floor||a[b.oxAdUnitId]<b.floor)a[b.oxAdUnitId]=b.floor;return a},{});return Object.keys(b).reduce(function(a,d){a.push(d+":"+Math.round(1E3*b[d]));return a},[]).join(",")}function L(a){return a.map(function(a){return a.oxAdUnitId}).join("%2C")}function M(a){return a.map(function(a){return Array.isArray(a.sizes)?a.sizes.map(function(a){return Array.isArray(a)?a[0]+"x"+a[1]:String(a)}).join(","):String(a.sizes)}).join("|")};function Q(a){var b=Math.pow(10,3);return Math.round(a*b)/b};var R=1;
function S(a,b){a=a?a:{};b=b?b:{};this.id=R++;this.adUnit=a;this.adMapping=b;this.o=1;this.a="initialized";G(b)?(this.type="video",this.m=a.cache_key,this.pub_rev=a.pub_rev?1E3*parseFloat(a.pub_rev):0,this.cpm=a.pub_rev?Q(parseFloat(a.pub_rev)):0):(this.type="display",this.divId=b.divId,this.m=a.ts,this.pub_rev=a.pub_rev?parseInt(a.pub_rev,10):0,this.cpm=a.pub_rev?Q(parseInt(a.pub_rev,10)/1E3):0,this.width,this.height,this.ad=a.html,a.creative&&0<a.creative.length&&(this.width=parseInt(a.creative[0].width,10),
this.height=parseInt(a.creative[0].height,10),this.tracking=a.creative[0].tracking))}S.prototype.u=function(){return[this.s(),T(this.cpm)].join("_")};S.prototype.getOxTargetingValue=S.prototype.u;S.prototype.s=function(){return this.width+"x"+this.height};S.prototype.getOxSize=S.prototype.s;S.prototype.F=function(){this.a="targeted"};S.prototype.setTargeted=S.prototype.F;S.prototype.K=function(){return"targeted"===this.a};S.prototype.isTargeted=S.prototype.K;S.prototype.D=function(){this.a="displayed"};
S.prototype.setDisplayed=S.prototype.D;S.prototype.O=function(){this.a="initialized"};S.prototype.resetBidState=S.prototype.O;S.prototype.w=function(){return"displayed"===this.a};S.prototype.isDisplayed=S.prototype.w;function T(a){var b;b||(b=1);a=1E3*a/b;b=Math.min(a,2E4);0<b&&25>b&&(b=25);return 1E3>a?5*Math.round(b/50):5E3>a?10*Math.round(b/100):50*Math.round(b/500)};function U(a,b,c){var d=c&&c.document||window.document;c=(c&&c.document||window.document).createElement("iframe");c.id="openx-pd";c.width="0";c.height="0";c.border="0px";c.frameBorder="0";c.hspace="0";c.marginHeight="0";c.marginWidth="0";c.scrolling="no";c.src=a||"about:blank";c.style.border="0";c.style.display="none";c.vspace="0";(a=d.body)&&(b&&b.parentNode?b.parentNode.replaceChild(c,b):a.appendChild(c))}
function V(a,b,c,d,e){var f=a.tracking&&a.tracking.impression.match(/([^?]+\/)ri\?/),g={};g.bd=+new Date-b;g.bp=a.pub_rev;g.bs=d;g.bsq=a.o;g.bt=c;g.ca=0;g.ts=a.m;g.br=e?"t":a.pub_rev?"p":"0";f&&((new Image).src=f[1]+"bo?"+D(g),a.o++)};function W(a,b){this.N;this.adMappings=[];this.j=[];this.i=1;this.singleRequest=!1;this.namespace="oxhbjs";this.timeLimit=2500;this.l="hb_lite_0.1.1";this.window=b||window;this.C(a);this.cmds={push:function(a){return a()}};return this}
W.prototype.C=function(a){a=a?a:{};this.deliveryDomain=a.deliveryDomain;this.timeLimit=a.timeLimit||this.timeLimit;this.singleRequest=void 0!==a.singleRequest?a.singleRequest:this.singleRequest;this.namespace=a.namespace||this.namespace;this.window[this.namespace]=this.window[this.namespace]||{};this.adMappings=a.adMappings||this.adMappings;return this};W.prototype.setConfig=W.prototype.C;
W.prototype.J=function(a,b){function c(a,b,c,d,f){return new Promise(function(h){if(a){var q=(new Date).valueOf(),l=P(e.l,a,f,b+"_videoAdResponseHandler"+c);X("//"+g+"/v/1.0/av?"+l);f[b+"_videoAdResponseHandler"+c]=function(a,b,c,d){var f=!1,g=setTimeout(function(){f||(f=!0,d())},b);return function(h){h=new S(h,a);f||(f=!0,clearTimeout(g),d(h));e.j.push(h);V(h,q,b,c,f)}}(a,d,f.location.hostname,h)}else h()})}a=a?a:{};var d=this;if(this.deliveryDomain){var e=this,f=a.timeLimit||this.timeLimit,g=a.deliveryDomain||
this.deliveryDomain,h=void 0!==a.singleRequest?a.singleRequest:this.singleRequest,n=[],l=[];Array.isArray(a.adMappings)?l=F(a.adMappings,this.adMappings):l=this.adMappings;var r=A(H(l)),l=r.next().value,r=r.next().value;n.push(function(a,b,c,d,f,h){return new Promise(function(l){function q(a,b,c){var d=!1,f=setTimeout(function(){d||(d=!0,c(v))},b);return function(g){var l=d,q=Y(a,g.ads.ad||[]);r--;v=v.concat(q);d||r||(d=!0,clearTimeout(f),c(v));e.j=e.j.concat(q);g.ads&&g.ads.pixels&&U(g.ads.pixels,
e.N,h);q.forEach(function(a){V(a,n,b,h.location.hostname,l)})}}if(b.length&&b.length){var n=(new Date).valueOf(),r=a?1:b.length,v=[],w;if(a){w="window."+c+".displayAdResponseHandler"+d;var N=J(e.l,b,h,w);X("//"+g+"/w/1.0/arj?"+N);h[c]["displayAdResponseHandler"+d]=q(b,f,l)}else b.forEach(function(a){w="window."+c+".displayAdResponseHandler"+d;var b=J(e.l,[a],h,w);X("//"+g+"/w/1.0/arj?"+b);h[c]["displayAdResponseHandler"+d]=q([a],f,l);d++})}else l([])})}(h,l,this.namespace,this.i,f,this.window));this.i+=
h?1:l.length;h=r.map(function(a){a=c(a,d.namespace,d.i,f,d.window);d.i++;return a});return Promise.all(n.concat(h)).then(function(a){a=I(a).filter(function(a){return a});b&&b(a);return a})}console.error("OX Header Bidder: getBids() Error: deliveryDomain not defined")};W.prototype.getBids=W.prototype.J;function X(a){var b=document.createElement("script");b.async=!0;b.src=a;a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)}
W.prototype.R=function(a,b){if(a){var c=function(a,b){var c=a.getSlotElementId();return b.find(function(a){return a.divId===c&&!a.I&&!a.w()})}(a,b),d;c?d=c.width&&c.height?c.u():a.getSizes()[0].getWidth()+"x"+a.getSizes()[0].getHeight()+"_"+T(c.cpm):d=a.getSizes()[0].getWidth()+"x"+a.getSizes()[0].getHeight()+"_t";try{a.setTargeting("oxb",d),c&&(a.setTargeting("oxb_bid_id",c.id),a.setTargeting("oxb_bid_namespace",this.namespace),c.F())}catch(e){console.error("AuctionEvents.ERROR","Unexpected error in setOxTargeting",
e)}}};W.prototype.setOxTargetingForGoogletagSlot=W.prototype.R;
W.prototype.S=function(a,b,c){var d=b.oxb_bid_id&&parseInt(b.oxb_bid_id[0],10);if((a=c.document)&&d)try{var e=this.j.find(function(a){return a.id===d});if(e){e.D();e.I=e.U=!0;var f=e.height,g=e.width,h=e.W,n=e.ad;a===document||"video"===e.X?console.error("Error trying to write ad. Ad render call ad id "+d+" was prevented from writing to the main document."):n?(a.write(n),a.close(),a.defaultView&&a.defaultView.frameElement&&(a.defaultView.frameElement.width=g,a.defaultView.frameElement.height=f)):
h?(a.write('\x3cIFRAME SRC\x3d"'+h+'" FRAMEBORDER\x3d"0" SCROLLING\x3d"no" MARGINHEIGHT\x3d"0" MARGINWIDTH\x3d"0" TOPMARGIN\x3d"0" LEFTMARGIN\x3d"0" ALLOWTRANSPARENCY\x3d"true" WIDTH\x3d"'+g+'" HEIGHT\x3d"'+f+'"\x3e\x3c/IFRAME\x3e'),a.close(),a.defaultView&&a.defaultView.frameElement&&(a.defaultView.frameElement.width=g,a.defaultView.frameElement.height=f)):console.error("Error trying to write ad. No ad for bid response id: "+d)}else console.error("Error trying to write ad. Cannot find ad by given id : "+
d)}catch(l){console.error("Error trying to write ad Id :"+d+" to the page:"+l.message)}else console.error("Error trying to write ad Id :"+d+" to the page. Missing document or adId")};W.prototype.showAd=W.prototype.S;
W.prototype.H=function(a,b){a=void 0===a?"":a;if(!b)return a;var c=a.substring(0,a.indexOf("?")+1),d=E(a),e=encodeURIComponent("ff\x3d"+b.m+"\x26oxb\x3d"+d.sz+"_"+T(b.cpm));d.url=window.location.href&&encodeURIComponent(window.location.href);d.description_url=window.location.hostname&&encodeURIComponent(window.location.hostname);d.cust_params=d.cust_params?d.cust_params+"%26"+e:e;return c+D(d)};W.prototype.buildVastUrl=W.prototype.H;
function Y(a,b){var c=b.slice();return a.map(function(a){var b=c.findIndex(function(b){return String(a.oxAdUnitId)===String(b.adunitid)&&Z(b,a)&&!b.U});if(0<=b){if(b=c.splice(b,1)[0],b.pub_rev)return new S(b,a)}else return new S(void 0,a)}).filter(function(a){return a})}function Z(a,b){var c=a.creative&&a.creative[0];return b.sizes&&b.sizes.length?c?b.sizes.some(function(a){var b=A(a);a=b.next().value;b=b.next().value;return a==c.width&&b==c.height}):!1:!0};window.HeaderBidder=W;})(window)
;

/* /js/bq/pubfood/bdr/OpenXBidderLite */
var OpenXBidderLiteAuction=function(pf,bqAdConfig,bqpred,oxAuctionId){this.pubfood=pf;this.bqAdConfig=bqAdConfig;this.predFactory=bqpred;this.oxAuctionId=oxAuctionId};
OpenXBidderLiteAuction.prototype={log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=["[ OpenXBidderLiteAuction ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},_normalizeBid:function(rawBid){var self=this;return rawBid*(1-self.disc)},renderAd:function(win,adid){var self=this;var targetingMap={"oxb_bid_id":[adid]};self.log("targetingMap",targetingMap);self.log("self.auctionhb",self.auctionhb);self.log("rendered ad",parseInt(targetingMap.oxb_bid_id[0],
10));self.auctionhb.showAd(null,targetingMap,win)},requestBids:function(predData){var self=this;try{var procfg=self.bqAdConfig.getProCfg("openx");self.disc=procfg.disc;var mappings=[];var plcmnts=self.bqAdConfig.getPlacements();for(var p=0;p<plcmnts.length;p++){var pl=plcmnts[p];var pfslot=self.slotNameMap[pl.get("name")];if(pfslot){var bidder=pl.getBidder("openx");self.log("openx bidder",bidder);var slotName=pl.get("name");var rootDiv=pl.get("elementId");var divId=pfslot.elementId;var szAryStr;if(bidder.get("openxAdSizes")){self.log("openxAdSizes"+
bidder.get("openxAdSizes"));szAryStr=bidder.get("openxAdSizes")}else szAryStr=pl.get("hbSizes");var mapping={type:"display",divId:divId,adUnit:slotName,sizes:szAryStr,oxAdUnitId:bidder.get("oxAdUnitId")};if(bidder.get("uf")){var flrRatio=bidder.get("bfp");var bf=.05;if(predData[rootDiv]){bf=calcFloorDollars(predData[rootDiv],flrRatio);self.log("bf",bf);var bfMinDol=self.predFactory.minFloorCents(self.disc);self.log("bfMinDol",bfMinDol);bf=Math.max(bf,bfMinDol);self.log("bf",bf);mapping["floor"]=bf;
self.log("mapping",mapping)}}mappings.push(mapping)}}var bidderTimeout=self.bqAdConfig.get("timeout");var bidderConfig={timeLimit:bidderTimeout,deliveryDomain:"brainyquote-d.openx.net",singleRequest:false,adMappings:mappings};self.log("openx bidderConfig",JSON.stringify(bidderConfig));var oxhbjs=new HeaderBidder(bidderConfig);self.auctionhb=oxhbjs;try{var oxBidRequestPromise=oxhbjs.getBids();oxBidRequestPromise.then(function(bids){self.log("oxBidRequestPromise bids",JSON.stringify(bids));for(var i=
0;i<bids.length;i++){var bid=bids[i];if(bid.cpm>0){var bidId=bid.id;var bidDiv=bid.divId;self.log("cpm for div"+bidDiv,bid.cpm);var bidCpm=self._normalizeBid(bid.cpm);self.log("bidCpm",bidCpm);var cpmCents=bidCpm*100;var lineItemVal=bqCpmFromBid(cpmCents);self.log("lineItemVal",lineItemVal);var w=bid.width;var h=bid.height;var bidSizes=[[w,h]];self.log("ox bid size",bidSizes);var keyval=w+"x"+h+"_"+lineItemVal;var pfSlot=self.openXSlotMap[bidDiv];self.log("ox bid slot",pfSlot);var divId=pfSlot.elementId;
self.log("ox bid divId",divId);if(bidDiv!=divId)throw"bid div "+bidDiv+" doesn't match ad div "+divId;var slotTargeting={};slotTargeting["oxb"]=keyval;slotTargeting["oxb_ad_id"]=bidId;slotTargeting["bq_ox_auct"]=self.oxAuctionId;var bidObject={slot:pfSlot.name,value:lineItemVal,sizes:bidSizes,targeting:slotTargeting};self.log("bidObject",bidObject);self.openXPushBid(bidObject)}else self.log("no bid on div",bid.divId)}self.log("oxBidRequestPromise done");self.openXDone()})}catch(err){self.log("openx error",
err);self.openXDone()}}catch(err){BQErrorLog.logError("openx",err);self.openXDone()}},runAuction:function(slots,pushBid,done){var self=this;self.openXSlotMap=slotsByDivs(slots);self.slotNameMap=slotsBySlotName(slots);self.openXPushBid=pushBid;self.openXDone=done;self.predFactory.getPred(function(predData){self.requestBids(predData)})}};
var OpenXBidderLite=function(pf,bqAdConfig,bqpred,refreshSupported){var self=this;self.pubfood=pf;self.bqAdConfig=bqAdConfig;self.predFactory=bqpred;self.oxAuctionMap={};self.refreshSupported=refreshSupported;window.OpenXBidderLite=this;window.renderOxHblAd=window.renderOxHblAd||function(win,oxAuctId,adid){try{self.log("rendering ox ad ",adid);self.log("render for ox auction ",oxAuctId);if(adid){self.oxAuction=self.oxAuctionMap[oxAuctId];self.oxAuction.renderAd(win,adid)}}catch(err){BQErrorLog.logError("ox_hbl ad render error",
err)}}};
OpenXBidderLite.prototype={cn:"OXBL",oxAuctionNum:1,log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=["[ OpenXBidderLite ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},go:function(){var self=this;if(self.cn!=="OXBL")throw"Bad self";self.log("openx go [start]");try{self.pubfood.addBidProvider({name:"openx",libUri:" ",init:function(slots,pushBid,done){try{self.log("openx init [start]");var auctionId="first";var mainAuction=new OpenXBidderLiteAuction(self.pubfood,
self.bqAdConfig,self.predFactory,auctionId);self.oxAuctionMap[auctionId]=mainAuction;mainAuction.runAuction(slots,pushBid,done)}catch(err){BQErrorLog.logError("openx init",err)}},refresh:function(slots,pushBid,done){self.log("refresh called with slots",slots);if(self.refreshSupported){self.oxAuctionNum=self.oxAuctionNum+1;var auctionId="a"+self.oxAuctionNum;var refreshAuction=new OpenXBidderLiteAuction(self.pubfood,self.bqAdConfig,self.predFactory,auctionId);self.oxAuctionMap[auctionId]=refreshAuction;
refreshAuction.runAuction(slots,pushBid,done)}else{self.log("refresh support is disabled");done()}}})}catch(err){BQErrorLog.logError("openx go",err)}}};
;

/* /js/bq/pubfood/bdr/RubiconFastlaneBidder */
var RubiconAuction=function(pf,bqAdConfig,bqpred,rbAuctionId){this.pubfood=pf;this.bqAdConfig=bqAdConfig;this.predFactory=bqpred;this.rbAuctionId=rbAuctionId;this.bidRequests=[]};
RubiconAuction.prototype={account_id:15348,site_id:95814,RUBICON_SIZE_MAP:{1:[468,60],2:[728,90],8:[120,600],9:[160,600],10:[300,600],15:[300,250],16:[336,280],19:[300,100],43:[320,50],44:[300,50],48:[300,300],54:[300,1050],55:[970,90],57:[970,250],58:[1E3,90],59:[320,80],61:[1E3,1E3],65:[640,480],67:[320,480],68:[1800,1E3],72:[320,320],73:[320,160],83:[480,300],94:[970,310],96:[970,210],101:[480,320],102:[768,1024],113:[1E3,300],117:[320,100],125:[800,250],126:[200,600]},log:function(msg){var self=
this;if(this.bqAdConfig.get("logOn")){var newArgs=["[ RubiconAuction : "+self.rbAuctionId+" ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},requestBids:function(predData){var self=this;try{var plcmnts=self.bqAdConfig.getPlacements();self.responsesNeeded=0;self.responsesBack=0;self.requestByZone={};for(var p=0;p<plcmnts.length;p++){var pl=plcmnts[p];var pfslot=self.slotNameMap[pl.get("name")];if(pfslot){var bidder=pl.getBidder("rubicon");
self.disc=bidder.get("disc");var slotName=pfslot.name;var rootDiv=pl.get("elementId");var divId=pfslot.elementId;var zone=bidder.get("zone");var sizekey=bidder.get("sizekey");var position=bidder.get("pos");var intName="custom";var screenRes=window.screen.width+"x"+window.screen.height;var url=window.location.href;var r=Math.random();var params={"account_id":self.account_id,"size_id":sizekey,"p_pos":position,"rf":url,"p_screen_res":screenRes,"site_id":self.site_id,"zone_id":zone,"tk_flint":intName,
"tg_fl.eid":divId,"rand":r};var bf=.01;if(bidder.get("uf")){var flrRatio=bidder.get("bfp");self.log("flrRatio",flrRatio);if(predData[rootDiv]){bf=calcFloorDollars(predData[rootDiv],flrRatio);self.log("bf",bf);var bfMinDol=self.predFactory.minFloorCents(self.disc);self.log("bfMinDol",bfMinDol);bf=Math.max(bf,bfMinDol);self.log("bf",bf)}}params["rp_floor"]=bf;self.log("params",params);var bidRequest={};bidRequest.params=params;bidRequest.divId=divId;bidRequest.slotName=slotName;self.bidRequests.push(bidRequest);
self.requestByZone[zone]=bidRequest}}self.bidCall()}catch(err){self.log("rubicon error",err);self.rubiconDone()}},bidCall:function(){var self=this;self.responsesNeeded=self.bidRequests.length;var rbUrl="//fastlane.rubiconproject.com/a/api/fastlane.json";self.log("all bidRequests",self.bidRequests);for(var i=0;i<self.bidRequests.length;i++){var bidRequest=self.bidRequests[i];$.ajax({url:rbUrl,data:bidRequest.params,dataType:"json",error:function(error){self.log("error",error);self.bidderDone()},success:function(response){self.log("success",
response);try{self.handleBidResponse(response)}catch(err){BQErrorLog.logError("Rubicon handleBidResponse failed",err)}finally{self.bidderDone()}},xhrFields:{withCredentials:true}})}},bidderDone:function(){var self=this;self.responsesBack=self.responsesBack+1;if(self.responsesBack>=self.responsesNeeded)self.rubiconDone()},_normalizeBid:function(rawBid){var self=this;return rawBid*(1-self.disc)},handleBidResponse:function(response){var self=this;if(typeof response!=="object")throw"bad rubicon response"+
response;if(response.status!=="ok"){var title="Rubicon handleBidResponse failed with reason "+response.reason+" error code : "+response.error_code;var detail="Received rubicon response "+JSON.stringify(response);self.log(title);self.log(detail)}else{var bidRequest=self.requestByZone[response.zone_id];self.log("response",response);var ads=response.ads;if(!Array.isArray(ads)||ads.length<1)throw"invalid rubicon ad response";var ad=bqGetBestAd(ads);self.log("best ad",ad);self.log("bidRequest",bidRequest);
var divId=bidRequest.divId;var slotName=bidRequest.slotName;if(ad.cpm){var normCpm=self._normalizeBid(ad.cpm);var bidVal=adjustCentsBidM1(normCpm*100);if(bidVal>0){var sizeId=bidRequest.params.size_id;var adSize=self.RUBICON_SIZE_MAP[sizeId];var impId=ad.impression_id;var scr=ad.script;window.rbFastlaneBidder.saveAdImpression(divId,impId,scr,adSize);var slotTargeting={hb_rb:bidVal,hb_rb_adid:impId};var bidObject={slot:slotName,value:bidVal,sizes:[adSize],targeting:slotTargeting};self.log("bidObject",
bidObject);self.rubiconPushBid(bidObject)}}else self.log("No bid for div",divId)}},runAuction:function(slots,pushBid,done){var self=this;self.rubiconSlotMap=slotsByDivs(slots);self.slotNameMap=slotsBySlotName(slots);self.log("slotNameMap",self.slotNameMap);self.log("rubiconSlotMap",self.rubiconSlotMap);self.rubiconPushBid=pushBid;self.rubiconDone=done;self.predFactory.getPred(function(predData){self.requestBids(predData)})}};
var RubiconFastlaneBidder=function(pf,bqAdConfig,bqpred,refreshSupported){var self=this;self.pubfood=pf;self.bqAdConfig=bqAdConfig;self.predFactory=bqpred;self.rbAuctionMap={};self.refreshSupported=refreshSupported;self.rbAdLookup={};self.rbAuctionNum=1;window.rbFastlaneBidder=this;window.renderRubiconAd=window.renderRubiconAd||function(doc,impId){try{var self=window.rbFastlaneBidder;self.log("rb: rendering rubicon ad with impId",impId);var adData=self.rbAdLookup[impId];self.log("self.rbAdLookup[impId]",
adData);if(adData&&adData.script&&adData.impId){var w=adData.size[0];var h=adData.size[1];var adContent="\x3chtml\x3e\n"+"\x3chead\x3e\x3cscript type\x3d'text/javascript'\x3einDapIF\x3dtrue;\x3c/script\x3e\x3c/head\x3e\n"+"\x3cbody style\x3d'margin : 0; padding: 0;'\x3e\n"+"\x3c!-- Rubicon Project Ad Tag Pubfood render --\x3e\n"+"\x3cdiv data-rp-impression-id\x3d'"+impId+"'\x3e\n"+"\x3cscript type\x3d'text/javascript'\x3e"+adData.script+"\x3c/script\x3e\n"+"\x3c/div\x3e\x3c/body\x3e\x3c/html\x3e";
BidHandler.renderAdBody(doc,adData.divId,w,h,adContent)}else throw"Could not find impId: "+impId+" in ad lookup "+JSON.stringify(self.rbAdLookup);}catch(err){BQErrorLog.logError("Rubicon render failed",err)}}};
RubiconFastlaneBidder.prototype={cn:"RBFL",log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=["[ RubiconFastlaneBidder ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},saveAdImpression:function(divId,impId,script,size){var self=this;self.rbAdLookup[impId]={divId:divId,impId:impId,script:script,size:size}},go:function(){var self=this;if(self.cn!=="RBFL")throw"Bad self";self.log("rubicon go [start]");try{self.pubfood.addBidProvider({name:"rubicon",
libUri:" ",init:function(slots,pushBid,done){try{self.log("rubicon init [start]");var auctionId="first";var mainAuction=new RubiconAuction(self.pubfood,self.bqAdConfig,self.predFactory,auctionId);self.rbAuctionMap[auctionId]=mainAuction;mainAuction.runAuction(slots,pushBid,done)}catch(err){BQErrorLog.logError("rubicon init",err)}},refresh:function(slots,pushBid,done){try{self.log("refresh called with slots",slots);if(self.refreshSupported){self.rbAuctionNum=self.rbAuctionNum+1;var auctionId="a"+self.rbAuctionNum;
var refreshAuction=new RubiconAuction(self.pubfood,self.bqAdConfig,self.predFactory,auctionId);self.rbAuctionMap[auctionId]=refreshAuction;refreshAuction.runAuction(slots,pushBid,done)}else{self.log("refresh support is disabled");done()}}catch(err){BQErrorLog.logError("rubicon refresh",err)}}})}catch(err){BQErrorLog.logError("rubicon go",err)}}};
;

/* /js/bq/pubfood/bdr/SovrnBidder */
var SovrnTierController=function(sovrnBidder,bqAdConfig){this.sovrnBidder=sovrnBidder;this.bqAdConfig=bqAdConfig};
SovrnTierController.prototype={log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=["[ SovrnTierController ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},runTiers:function(slots,pushBid,done){var self=this;if(slots.length==0){self.log("Sovrn running with empty slots, returning immediately.");done();return}var sovrnAuctionId=self.sovrnBidder.nextSeq();var auctionT1=new SovrnBidderAuction(sovrnAuctionId,self.sovrnBidder,1);
self.sovrnBidder.auctionsById[sovrnAuctionId]=auctionT1;auctionT1.runAuction(slots,pushBid,function(){self.log("main auction done");var slotsLeft=auctionT1.slotsNeedingBids();self.log("slotsNeedingBids",slotsLeft);if(slotsLeft.length>0){var sovrnAuctionId2=self.sovrnBidder.nextSeq();var auctionT2=new SovrnBidderAuction(sovrnAuctionId2,self.sovrnBidder,2);self.sovrnBidder.auctionsById[sovrnAuctionId2]=auctionT2;auctionT2.runAuction(slotsLeft,pushBid,done)}else done()})}};
var SovrnBidderAuction=function(sovrnAuctionId,sovrnBidder,tierIn){this.sovrnAuctionId=sovrnAuctionId;this.sovrnBidder=sovrnBidder;this.pubfood=sovrnBidder.pf;this.bqAdConfig=sovrnBidder.bqAdConfig;this.predFactory=sovrnBidder.predFactory;this.tier=tierIn;this.sec=false;if(document.location.protocol==="https:")this.sec=true};
SovrnBidderAuction.prototype={doneCB:undefined,pushBidCB:undefined,sovrnRequests:{},slotsNeedingBids:function(){var self=this;var slotsNoBids=[];for(var k=0;k<self.allSlots.length;k++){var slt=self.allSlots[k];if(self.slotsWithBids.indexOf(slt)==-1)slotsNoBids.push(slt)}return slotsNoBids},_curTierFloor:function(sovrnConfig,pred){var self=this;var ratio=.01;var ratioTier2=.01;if(sovrnConfig.get("uf")){if(sovrnConfig.get("bfp"))ratio=sovrnConfig.get("bfp");var bfpt2=sovrnConfig.get("bfp2");if(bfpt2==
0||bfpt2)ratioTier2=bfpt2}var finalRatio=ratio;if(self.tier==2)finalRatio=ratioTier2;var bf=self._calcFloor(pred,finalRatio);self.log("bf",bf);var bfMinDol=self.predFactory.minFloorCents(self.disc);self.log("bfMinDol",bfMinDol);bf=Math.max(bf,bfMinDol);self.log("bf",bf);return bf},_sendBidRequest:function(predData){var self=this;var sovrnUrl="//ap.lijit.com/rtb/bid";var bf="0.60";var procfg=self.bqAdConfig.getProCfg("sovrn");self.disc=procfg.disc;var bidRequest={};bidRequest.id=self.sovrnAuctionId;
bidRequest.site={"domain":"brainyquote.com","page":self.bqAdConfig.get("curi")};bidRequest.imp=[];var placements=self.bqAdConfig.getPlacements();for(var i=0;i<placements.length;i++){var placement=placements[i];var sovrnConfig=placement.getBidder("sovrn");if(sovrnConfig){self.log("self.slotNameMap",self.slotNameMap);var slot=self.slotNameMap[placement.get("name")];if(slot){var pred=.1;if(predData[placement.get("elementId")])pred=predData[placement.get("elementId")];self.log("placementConfig.bdrs.sovrn",
sovrnConfig);var sovrnTags=sovrnConfig.get("tags");if(sovrnTags){self.sovrnRequests[placement.get("name")]=[];for(var j=0;j<sovrnTags.length;j++){var tag=sovrnTags[j];if(tag.tier==self.tier){var bfThisTier=self._curTierFloor(sovrnConfig,pred);var sovrnTagRequest={"id":self.sovrnBidder.nextSeq(),"banner":{"w":tag.width,"h":tag.height},"tagid":tag.tagId};if(sovrnConfig.get("uf"))sovrnTagRequest["bidfloor"]=bfThisTier;if(this.sec)sovrnTagRequest["secure"]=1;self.log("Adding BR ",tag.width,"x",tag.height,
" id\x3d",tag.tagId," bf\x3d",bfThisTier," t\x3d",tag.tier);bidRequest.imp.push(sovrnTagRequest);self.sovrnRequests[placement.get("name")].push(sovrnTagRequest)}}}}}}if(bidRequest.imp.length>0){var params={br:JSON.stringify(bidRequest),rand:self.sovrnBidder.rndI()};$.ajax({url:sovrnUrl,dataType:"jsonp",data:params,error:function(error){SovrnBidder.bidError(error)},success:function(response){self.log("success",response);SovrnBidder.bidResponseCB(response)}})}else{self.log("no imp, skipping request");
self.doneCB()}},log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=["[ SovrnAuction ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},_initCB:function(slots,pushBid,done){var self=this;try{self.log("_initCB() [start]");self.doneCB=done;self.pushBidCB=pushBid;self.slotNameMap=slotsBySlotName(slots);self.slotsWithBids=[];self.allSlots=slots;self.log("_initCB() [end]")}catch(err){BQErrorLog.logError("sovrn _initCB",err)}},_normalizeBid:function(rawBid){var self=
this;return rawBid*(1-self.disc)},_calcFloor:function(pred,ratio){var self=this;var fl=.1;if(pred){fl=ratio*pred;fl=Math.round(fl*100)/100;self.log("bidfloor",fl)}return fl},auctionBids:function(bids){var self=this;try{var bidLookup={};if(bids&&bids.seatbid&&bids.seatbid[0]&&bids.seatbid[0].bid){for(var j=0;j<bids.seatbid[0].bid.length;j++){var bid=bids.seatbid[0].bid[j];if(bid.impid&&bid.adm&&bid.nurl&&bid.price>0)bidLookup[bid.impid]=bid}for(var k=0;k<self.bqAdConfig.getPlacements().length;k++){var placement=
self.bqAdConfig.getPlacements()[k];var sovrnConf=placement.getBidder("sovrn");if(sovrnConf){var slotByNameInst=self.slotNameMap[placement.get("name")];if(slotByNameInst){var reqsForSlot=self.sovrnRequests[placement.get("name")];var bestBid=null;for(var m=0;m<reqsForSlot.length;m++){var req=reqsForSlot[m];var bd=bidLookup[req.id];if(bd){self.log("Found bid ",bd);self.log("For request ",req);if(!bestBid||bd.price>bestBid.price)bestBid=bd;else self.log("Discarding bid due to better bid on same slot",
bd)}else self.log("No bid for request ",req)}if(bestBid){self.log("Pushing best sovrn bid for slot "+placement.get("name"),bestBid);var dBid=self._normalizeBid(bestBid.price);self.log("_normalizeBid sovrn bid value",dBid);var bval=SovrnBidder.roundFunc(dBid);self.log("Best sovrn bid value",bval);var pfSlot=self.slotNameMap[placement.get("name")];self.log("sovrn bid slot",pfSlot);self.slotsWithBids.push(pfSlot);var bidSizes=[[bestBid.w,bestBid.h]];self.log("sovrn bid size",bidSizes);var divId=pfSlot.elementId;
self.log("sovrn bid divId",divId);window.sovrnAdLookup[bestBid.impid]={"bid":bestBid,"div":divId};var slotTargeting={};slotTargeting.hb_svrn_adid=bestBid.impid;slotTargeting.hb_svrn_bid=bval;var bidObject={slot:pfSlot.name,value:bval,sizes:bidSizes,targeting:slotTargeting};self.pushBidCB(bidObject)}}}}}self.log("window.sovrnAdLookup",window.sovrnAdLookup);self.doneCB()}catch(err){BQErrorLog.logError("sovrn _bidResponseCB",err)}},runAuction:function(slots,pushBid,done){var self=this;self._initCB(slots,
pushBid,done);self.predFactory.getPred(function(predData){self._sendBidRequest(predData)})}};var SovrnBidder=function(pf,bqAdConfig,bqpred){var self=this;this.pubfood=pf;this.bqAdConfig=bqAdConfig;this.predFactory=bqpred;window.sovrnBidder=self;window.sovrnAdLookup={};window.renderSovrnAd=window.renderSovrnAd||function(doc,adid){self.log("rendering sovrn ad ",adid);self.log("rendering sovrn ad body ",window.sovrnAdLookup[adid]);self._renderAd(document,adid)}};
SovrnBidder.prototype={cn:"Svrn",seqNum:0,auctionsById:{},nextSeq:function(){var self=this;if(self.seqNum===0)self.seqNum=self.rndI();else self.seqNum=self.seqNum+1;return self.seqNum},rndI:function(){return Math.floor(1E6*Math.random())},log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=["[ SovrnBidder ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},_renderAd:function(doc,adid){try{var adObj=window.sovrnAdLookup[adid];
if(adObj){var bidObj=adObj.bid;var divId=adObj.div;var width=bidObj.w;var height=bidObj.h;var nurl=bidObj.nurl;var adContent=bidObj.adm;(new Image).src=decodeURIComponent(nurl);var svrn_ad=decodeURIComponent(adContent);BidHandler.renderAdBody(doc,divId,width,height,svrn_ad)}}catch(err){BQErrorLog.logError("sovrn render failed",err)}},go:function(){var self=this;try{self.log("go() [start]");var sovrnTiers=new SovrnTierController(self,self.bqAdConfig);self.pubfood.addBidProvider({name:"sovrn",libUri:" ",
init:function(slots,pushBid,done){self.log("init called",slots);sovrnTiers.runTiers(slots,pushBid,done)},refresh:function(slots,pushBid,done){self.log("refresh called",slots);sovrnTiers.runTiers(slots,pushBid,done)}});self.log("go() [end]")}catch(err){BQErrorLog.logError("sovrn go",err)}}};SovrnBidder.roundFunc=function(price){return bqDollarFloorToCents(price)};
SovrnBidder.bidResponseCB=function(response){window.sovrnBidder.log("response",response);var auctionId=response["id"];var auction=window.sovrnBidder.auctionsById[auctionId];auction.auctionBids(response)};SovrnBidder.bidError=function(error){self.log("error",error)};
;

/* /js/bq/pubfood/bdr/auction/YieldbotAuction */
var YieldbotAuction=function(pf,bqAdConfig,bqpred,rbAuctionId){this.pubfood=pf;this.bqAdConfig=bqAdConfig};
YieldbotAuction.prototype={cn:"YbtA",pubfood:null,bqAdConfig:null,slots:null,pushBidCB:undefined,doneCB:undefined,ybNameMap:null,isRefresh:false,log:function(){if(this.bqAdConfig.get("logOn")){var newArgs=["[ YBotA ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},_normalizeBid:function(rawBid){var self=this;return rawBid*(1-self.disc)},detailLog:function(){},setIsRefresh:function(refresh){this.isRefresh=refresh},_sizeToString:function(sizeArray){if(sizeArray==
null)return"null";var result="";for(var i=0;i!=sizeArray.length;i++){if(i!=0)result+=" ";result+="["+sizeArray[i][0]+"x"+sizeArray[i][1]+"]"}return result},runAuction:function(slots,pushBid,done,ybNameMap){var self=this;try{self.detailLog("ybA runAuction withybNameMap:",ybNameMap);for(var i=0;i!=slots.length;i++){var slot=slots[i];self.detailLog("ybA runAuction PubFood slot ",i,"; slotAndAuctionName\x3d",slot.name," slotName\x3d",slot.getParam("slotName"))}self.slots=slots;self.pushBidCB=pushBid;
self.doneCB=done;self.ybNameMap=ybNameMap;var slotMap={};var refreshSlots={};self.bidRequestMade=false;ybotq.push(function(){try{var procfg=self.bqAdConfig.getProCfg("yieldbot");self.disc=procfg.disc;self.log("Publisher disc is ",self.disc);self.psn=procfg.pubid;self.log("Publisher ID is ",self.psn);yieldbot.pub(self.psn);var didAddASlot=false;for(var k=0;k<slots.length;k++){var slot=slots[k];var slotAndAuctionName=slot.name;var slotName=slot.getParam("slotName");var ybSlotName=self.ybNameMap[slotName];
if(!ybSlotName)throw"yb define could not find slot "+slot;else{if(this.isRefresh)ybSlotName=slotAndAuctionName;var filteredSizes=[];for(var i=0;i!=slot.sizes.length;i++){var sl=slot.sizes[i];if(!(sl[0]===970&&sl[1]===250))filteredSizes.push(sl)}self.detailLog("Doing defineSlot for ",ybSlotName," with sizes:",self._sizeToString(filteredSizes));yieldbot.defineSlot(ybSlotName,{sizes:filteredSizes});didAddASlot=true;slotMap[ybSlotName]=slotAndAuctionName;refreshSlots[ybSlotName]=filteredSizes}}if(didAddASlot){yieldbot.enableAsync();
if(self.isRefresh)yieldbot.nextPageview(refreshSlots);else yieldbot.go();self.bidRequestMade=true}else self.log("yb skipping auction, 0 slots were defined")}catch(err){BQErrorLog.logError("yb cb1:",err)}});ybotq.push(function(){if(self.bidRequestMade)try{var pageCriteria=yieldbot.getPageCriteria();self.detailLog(" [[ yieldbot ]] Got bids back: ",pageCriteria);var pageSlots=pageCriteria!==""?pageCriteria.split(","):[];for(var i=0;i<pageSlots.length;i++){var slotInfo=pageSlots[i].split(":");var slot=
slotInfo[0];var slt=slotMap[slot];if(!slt)throw"Got unexpected bid for slot "+slot;else{var size=slotInfo[1];var sizes=size.split("x");sizes[0]=parseInt(sizes[0],10);sizes[1]=parseInt(sizes[1],10);var ybTgt={ybot_pubid:self.psn,ybot_size:size,ybot_ad:"y",ybot_slot:slot};var bid=0;if(slotInfo.length&&slotInfo[2]){bid=parseFloat(slotInfo[2],10);self.log("raw bid",bid);bid=self._normalizeBid(bid);self.log("_normalizeBid",bid);bid=adjustCentsYieldBot(bid);if(bid>0){ybTgt["ybot_cpm"]=bid;self.log(" *** BID *** value\x3d",
bid," ybot_size\x3d",size," ybot_slot\x3d",slot);var bidObject={slot:slt,value:bid,sizes:sizes,targeting:ybTgt};if(bidObject.slot)self.pushBidCB(bidObject);else throw"invalid yb bid, no slot found for "+slot+" : "+JSON.stringify(pageCriteria);}else;}}}}catch(err){BQErrorLog.logError("yb cb2:",err)}self.doneCB()})}catch(err){BQErrorLog.logError("ybA runAuction:",err)}self.log("ybA runAuction [done]")}};
;

/* /js/bq/pubfood/bdr/YieldbotBidder */
var YieldbotBidder=function(pf,bqAdConfig,refreshDisabled){this.pubfood=pf;this.bqAdConfig=bqAdConfig;this.refreshOff=refreshDisabled};
YieldbotBidder.prototype={cn:"Ybt",slotParams:null,log:function(){if(this.bqAdConfig.get("logOn")){var newArgs=["[ YBot ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},go:function(){var self=this;if(self.cn!=="Ybt")throw"Bad self";self.log("yb go [start]");try{self.ybNameMap={};var plList=self.bqAdConfig.getPlacements();for(var i=0;i!==plList.length;i++){var pl=plList[i];var yBidder=pl.getBidder("yieldbot");if(yBidder){var plName=pl.get("name");
var yName=yBidder.get("name");self.ybNameMap[plName]=yName}}self.log(" ybNameMap\x3d",self.ybNameMap);pf.addBidProvider({name:"yieldbot",libUri:"//cdn.yldbt.com/js/yieldbot.intent.js",slotParams:self.ybNameMap,init:function(slots,pushBid,done){self.log("init called with slots",slots);var ybAuction=new YieldbotAuction(self.pubfood,self.bqAdConfig);ybAuction.runAuction(slots,pushBid,done,self.ybNameMap)},refresh:function(slots,pushBid,done){self.log("refresh called with slots",slots);if(self.refreshOff)self.log("yb refresh\x3doff");
else{var ybAuction=new YieldbotAuction(self.pubfood,self.bqAdConfig);ybAuction.setIsRefresh(true);ybAuction.runAuction(slots,pushBid,done,self.ybNameMap)}}})}catch(err){BQErrorLog.logError("yb go; ",err)}self.log("yb go [done]")}};
;

/* /js/bq/pubfood/bdr/CnvBidder */
var CnvAuction=function(pf,bqAdConfig,bqpred,bidKey,adIdKey,bqPv){var self=this;self.pubfood=pf;self.bqAdConfig=bqAdConfig;self.predFactory=bqpred;self.bidKey=bidKey;self.adIdKey=adIdKey;self.bqPv=bqPv;self.disc=0;self.testMode=false;self.slotNameMap={};self.ortb=new OpenRTBAuction(self.bqAdConfig,self.bqPv,"brainyquote","1.0.0")};
CnvAuction.prototype={endPoint:"//media.msg.dotomi.com/s2s/header/24",mobileSiteId:"111907",desktopSiteId:"111902",log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=["[ CnvAuction ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},_initCB:function(slots,pushBid,done){var self=this;try{self.doneCB=done;self.pushBidCB=pushBid;self.slotNameMap=slotsBySlotName(slots)}catch(err){BQErrorLog.logError("CnvAuction _initCB",err)}},
_normalizeBid:function(rawBid){var self=this;return rawBid*(1-self.disc)},_sendBidRequest:function(predData){var self=this;var procfg=self.bqAdConfig.getProCfg("conversant");self.disc=procfg.disc;var bidRequest={};bidRequest.id=self.ortb.generateNextId();var siteId;if(self.bqPv.isMobile())siteId=self.mobileSiteId;else siteId=self.desktopSiteId;bidRequest.imp=[];var placements=self.bqAdConfig.getPlacements();self.bidRequests={};self.bidRequestLookup={};for(var i=0;i<placements.length;i++){var placement=
placements[i];var bidConfig=placement.getBidder("conversant");if(bidConfig){var slot=self.slotNameMap[placement.get("name")];if(slot){var cnvSizes=bidConfig.get("cnvSizes");var cnvSiteOvr=bidConfig.get("cnvTestSiteId");var hbSizes=placement.get("hbSizes");cnvSizes=bqFilterSizes(cnvSizes,hbSizes);self.testMode=false;if(cnvSiteOvr){self.testMode=true;siteId=cnvSiteOvr}if(cnvSizes){var pname=placement.get("name");self.bidRequests[pname]=[];for(var j=0;j<cnvSizes.length;j++){var size=cnvSizes[j];var reqId=
self.ortb.generateNextId();var tagRequest=self.ortb.generateImpRequest(reqId,pname,size);if(bidConfig.get("uf")&&!self.testMode){var ratio=bidConfig.get("bfp");var bfMinDol=self.predFactory.minFloorCents(self.disc);self.log("bfMinDol",bfMinDol);self.ortb.addBidFloor(bfMinDol,placement,predData,ratio,tagRequest)}else self.log("bid floors disabled");bidRequest.imp.push(tagRequest);self.bidRequests[pname].push(tagRequest);self.bidRequestLookup[reqId]=tagRequest}}}}}if(bidRequest.imp.length>0){var url=
self.endPoint;bidRequest.site=self.ortb.generateSiteData(siteId);bidRequest.device=self.ortb.generateDeviceData();bidRequest.at=1;self.log("bidRequest",bidRequest);var requestPostParam=JSON.stringify(bidRequest);$.ajax({type:"POST",url:url,dataType:"json",data:requestPostParam,error:function(error){self.log("error",error);self.doneCB()},success:function(response){self.log("response",response);try{self._process_response(response)}catch(e){BQErrorLog.logError("Error processing conversant response",
e)}finally{self.doneCB()}},xhrFields:{withCredentials:true}})}else{self.log("No impressions to bid on");self.doneCB()}},_process_response:function(rsp){var self=this;self.log("got resp",rsp);bids=rsp.seatbid;self.log("bids",bids);var bidLookup={};for(var i=0;i<rsp.seatbid.length;i++){var seatBid=rsp.seatbid[i];if(seatBid.bid&&seatBid.bid.length>0){var bids=seatBid.bid;for(var j=0;j<bids.length;j++){var bidResponse=bids[j];if(bidResponse.price>0&&bidResponse.adm){if(!bidLookup[bidResponse.impid])bidLookup[bidResponse.impid]=
{bid:bidResponse,price:bidResponse.price};else throw"Bid already exists for impid "+bidResponse.impid+" cannot process response "+JSON.stringify(rsp);self.log("setting bid for imp "+bidResponse.impid+" to ",bidLookup[bidResponse.impid])}}}}self._processBids(bidLookup)},_processBids:function(bidLookup){var self=this;self.log("bidLookup",bidLookup);for(var k=0;k<self.bqAdConfig.getPlacements().length;k++){var placement=self.bqAdConfig.getPlacements()[k];var bidderConf=placement.getBidder("conversant");
if(bidderConf){var reqsForSlot=self.bidRequests[placement.get("name")];var bestBid=null;if(reqsForSlot){for(var m=0;m<reqsForSlot.length;m++){var req=reqsForSlot[m];var bidData=bidLookup[req.id];if(bidData){self.log("Found bid ",bidData);self.log("For request ",req);if(!bestBid||bidData.price>bestBid.price)bestBid=bidData;else self.log("Discarding bid due to better (or same) value bid on same slot",bidData)}else self.log("No bid for request ",req)}if(bestBid){self.log("Pushing best bid for slot "+
placement.get("name"),bestBid);var adjBid=self._normalizeBid(bestBid.price);var bval=bqDollarFloorToCents(adjBid);self.log("bval",bval);if(self.testMode)bval=500;if(bval>0){self.log("Best bid value",bval);var pfSlot=self.slotNameMap[placement.get("name")];self.log("Bid slot",pfSlot);self.log("best bid",bestBid);self.log("best bid bid",bestBid.bid);var reqId=bestBid.bid.impid;self.log("best bid bid reqId",reqId);var reqForBid=self.bidRequestLookup[reqId];self.log("reqForBid",reqForBid);var bidSizes=
[[reqForBid.banner.w,reqForBid.banner.h]];var adm=bestBid.bid.adm;self.log("adm",adm);var nurl=bestBid.bid.nurl;self.log("nurl",nurl);var plDiv=placement.get("elementId");var slotDiv=pfSlot.elementId;self.log("divId for placement",plDiv);self.log("divId for bid",slotDiv);window.cnvBidder.adLookup[reqId]={"w":reqForBid.banner.w,"h":reqForBid.banner.h,"adBody":adm,"nurl":nurl,"divId":slotDiv};var slotTargeting={};slotTargeting[self.adIdKey]=reqId;slotTargeting[self.bidKey]=bval;var bidObject={slot:pfSlot.name,
value:bval,sizes:bidSizes,targeting:slotTargeting};self.log("best bid",bidObject);self.pushBidCB(bidObject)}else self.log("ignoring bid under 10 cents")}}}}},runAuction:function(slots,pushBid,done){var self=this;try{self._initCB(slots,pushBid,done);self.predFactory.getPred(function(predData){self._sendBidRequest(predData)})}catch(err){BQErrorLog.logError("CnvAuction runAuction",err)}}};
var CnvBidder=function(pf,bqAdConfig,bqpred,bqPv){var self=this;self.pubfood=pf;self.bqAdConfig=bqAdConfig;self.predFactory=bqpred;self.bqPv=bqPv;self.adLookup={};window.cnvBidder=self;window.renderCnvAd=window.renderCnvAd||function(doc,adId){try{window.cnvBidder.log("rendering Conversant ad with adId",adId);var adData=window.cnvBidder.adLookup[adId];window.cnvBidder.log("Conversant adData",adData);if(adData){window.cnvBidder.log("rendering Conversant ad to divId",adData.divId);var adToRender=adData.adBody+
'\x3cimg src\x3d"'+adData.nurl+'" /\x3e';BidHandler.renderAdBody(doc,adData.divId,adData.w,adData.h,adToRender)}else throw"No adId "+adId+" in lookup "+JSON.stringify(window.cnvBidder.adLookup);}catch(err){BQErrorLog.logError("Conversant render failed",err)}}};
CnvBidder.prototype={cn:"Idx",bidKey:"hb_cnv",adIdKey:"hb_cnv_adid",log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=["[ CnvBidder ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},go:function(){var self=this;try{self.pubfood.addBidProvider({name:"conversant",libUri:" ",init:function(slots,pushBid,done){self.log("init called with slots",slots);self.mainAuction=new CnvAuction(self.pf,self.bqAdConfig,self.predFactory,self.bidKey,
self.adIdKey,self.bqPv);self.mainAuction.runAuction(slots,pushBid,done)},refresh:function(slots,pushBid,done){self.log("refresh called");self.refreshAuction=new CnvAuction(self.pf,self.bqAdConfig,self.predFactory,self.bidKey,self.adIdKey,self.bqPv);self.refreshAuction.runAuction(slots,pushBid,done)}})}catch(err){BQErrorLog.logError("CnvBidder go",err)}}};
;

/* /js/bq/pubfood/auction/GoogleAuction */
var GoogleAuction=function(pf,bqAdConfig,bqPageVarsIn,evHIn,slotMgr,pfConfig){this.pf=pf;this.bqAdConfig=bqAdConfig;this.bqPageVars=bqPageVarsIn;this.evHandler=evHIn;this.slotMgr=slotMgr;this.pfConfig=pfConfig;this.adNameById={63918:"Amazon",177890658:"AOL",200451258:"AppNexus",103068:"BrainyQuote",199160058:"BRealTime",225310938:"Conversant",61700898:"Criteo",214010778:"Defy Media",200449938:"District_M",62118:"Google",92837298:"IndexExchange",11550378:"OpenX",104418:"Rubicon",87215778:"sovrn",14591178:"YieldBot"}};
GoogleAuction.prototype={log:function(msg){if(this.bqAdConfig.get("logOn")){var newArgs=["[ GoogleAuction ] ------\x3e"];for(var i=0;i<arguments.length;i++)newArgs.push(arguments[i]);konsole.log.apply(konsole,newArgs)}},_logAuctions:function(){var self=this;var ac=self.pf.getAuctionCount();var aid=self.pf.getAuctionId();var aRun=self.pf.getAuctionRun(ac);self.log("auction count",ac);self.log("auction id",aid);self.log("auction run",aRun)},_setupSlotRendered:function(){var self=this;googletag.cmd.push(function(){googletag.pubads().addEventListener("slotRenderEnded",
function(event){try{var lineitem="unknown";if(event.lineItemId)lineitem=event.lineItemId;var slot=event.slot;var msg="";if(slot){msg=msg+"\ndivId: "+slot.getSlotElementId()+":\nLine item: "+lineitem;var size="";if(event.size){size="size ["+event.size[0]+"x"+event.size[1]+"]";msg=msg+"\n"+size+"\n"}var rinfo=event.slot.getResponseInformation();if(rinfo){var advertiserId=rinfo["advertiserId"];var lineItemId=rinfo["lineItemId"];for(var rinf in rinfo)msg=msg+", "+rinf+" \x3d "+rinfo[rinf];var adDiv="("+
slot.getSlotElementId()+")";try{adDiv=$("#"+slot.getSlotElementId()).get(0)}catch(err){}if(typeof RDRLOG!=="undefined"&&RDRLOG)konsole.log("Rendering ",self.adNameById[advertiserId],"(",advertiserId,") ad; ",size," , LI_id\x3d",lineItemId," for div ",adDiv)}}msg=msg+"\nisEmpty: "+event.isEmpty;self.log("slotRenderEnded event",event);self.log("slot event: slotRenderEnded detail: Rendering ",self.adNameById[advertiserId],"(",advertiserId,") ad; ",msg);BQNewMsnry.layout(".new-msnry-grid")}catch(err){BQErrorLog.logError("slotRenderEnded error",
err)}})})},_runAuction:function(targeting,slotidx,auctionId){var self=this;var auctionTargeting=new BQAuctionTargeting(self.bqAdConfig,self.bqPageVars,self.pf,self.pfConfig,bqpred,self.slotMgr,targeting,slotidx,auctionId);auctionTargeting.doSlotTargeting();self._logAuctions();return auctionTargeting},_setupPageMetaData:function(){var self=this;if(self.bqAdConfig.get("test_group")=="b")googletag.pubads().setTargeting("test_group","btest");else googletag.pubads().setTargeting("test_group","atest");
if(self.bqAdConfig.get("lang"))googletag.pubads().setTargeting("bq_lang",self.bqAdConfig.get("lang"));googletag.pubads().setTargeting("bq_vide",bqVide);if(self.bqAdConfig.bidderRem)if(bqMbl=="n")googletag.pubads().setTargeting("bq_bdrp_d",self.bqAdConfig.bidderRem);else googletag.pubads().setTargeting("bq_bdrp_m",self.bqAdConfig.bidderRem);var uaStr=self.bqAdConfig.pageVars.getVar("userAgent");if(uaStr)googletag.pubads().setTargeting("bq_ua",uaStr);if(self.bqAdConfig.hbOnly!=null)googletag.pubads().setTargeting(self.bqAdConfig.hbOnly,
"off");for(var key in ctTarg)if(ctTarg.hasOwnProperty(key))googletag.pubads().setTargeting(key,ctTarg[key]);if(CookieUtil.hasLI())googletag.pubads().setTargeting("bq_m","y");else googletag.pubads().setTargeting("bq_m","n");googletag.pubads().setTargeting("bq_mbl",bqMbl);googletag.pubads().setTargeting("bq_loc",bqTgtLoc);googletag.pubads().setTargeting("bq_dytm",dtKey);if("https:"==document.location.protocol)googletag.pubads().setTargeting("bq_https","y");else googletag.pubads().setTargeting("bq_https",
"n");var contVal;try{contVal=self.evHandler.getCName()}catch(err){var msg="Error determining cont";if(typeof edata!=="undefined")msg=msg+" from edata : "+JSON.stringify(edata);else msg=msg+" edata undefined";BQErrorLog.logError(msg,err);contVal="error"}googletag.pubads().setTargeting("bq_cont",contVal);self._setupDebugging()},_kickoffDFP:function(){var self=this;googletag.pubads().enableAsyncRendering();if(self.bqAdConfig.pageVars.getVar("delayed"))googletag.pubads().disableInitialLoad();else googletag.pubads().enableSingleRequest();
googletag.pubads().collapseEmptyDivs();googletag.enableServices();bqAuctionRan=true},_setupDebugging:function(){var offPref=CookieUtil.getPreference("onlyboff");if(offPref){konsole.log("+++  Setting ",offPref," to off");googletag.pubads().setTargeting(offPref,"off")}},create:function(){var self=this;try{self.pf.setAuctionProvider({name:"Google",libUri:"//www.googletagservices.com/tag/js/gpt.js",init:function(targeting,done){try{self._setupSlotRendered();googletag.cmd.push(function(){try{self._setupPageMetaData();
var auction=self._runAuction(targeting,1,"main");self._kickoffDFP();JsLOG.push("Google auction done");done();auction.saveAuctionData()}catch(err){BQErrorLog.logError("google init ",err)}})}catch(err){BQErrorLog.logError("google auction ",err)}},refresh:function(targeting,done){self.log("refresh called with targeting",targeting);var auctCtrl=adCtrl.getRefreshAuction();googletag.cmd.push(function(){try{var auction=self._runAuction(targeting,auctCtrl.getAuctionNum(),auctCtrl.getAuctionId());JsLOG.push("Google refresh done");
auction.saveAuctionData();done()}catch(err){BQErrorLog.logError("google refresh ",err)}})}})}catch(err){BQErrorLog.logError("GoogleAuction create",err)}}};
;

/* /js/bq/evolve/BQEvHandler */
var BQEvHandler=function(data){this._init(data)};
BQEvHandler.prototype={_init:function(data){this.cNum=data.cNum;this.cName=data.cName;this.dataForSeq={};this.disableFlr=false;var dataAryForSeq=data.d;for(var i=0;i<data.v.length;i++){var vi=data.v[i];var val=dataAryForSeq[i];this.dataForSeq[vi]=val}this.setContenderCookie()},setContenderCookie:function(){CookieUtil.createCookieWithMinExpiry("bqContNum",this.cNum,30)},noFlr:function(){this.disableFlr=true},getVar:function(varName){var result;if(this.dataForSeq[varName])result=this.dataForSeq[varName];
return result},getOvr:function(varName,v){var r=v;var ovr=this.getVar(varName);if(ovr)r=ovr;return r},sortedBidders:function(bidderMap){var self=this;var bidderNames=Object.keys(bidderMap);bidderNames.sort(function(a,b){var varsuf="_pri";var aPri=50;var bPri=50;var evPriA=self.getVar(a+varsuf);var evPriB=self.getVar(b+varsuf);if(typeof evPriA==="number")aPri=evPriA;if(typeof evPriB==="number")bPri=evPriB;return bPri-aPri});var bidders=[];for(var i=0;i<bidderNames.length;i++){var bname=bidderNames[i];
bidders.push(bidderMap[bname])}return bidders},getBidderOvr:function(bidderName,varName,v,isMobile){var r=v;if(varName=="bfp"){var bidderVarName=bidderName+"_"+"bfp";if(isMobile)bidderVarName+="_m";else bidderVarName+="_d";var ovr=this.getVar(bidderVarName);if(ovr)r=ovr/100}else if(varName=="uf")if(this.disableFlr)r=false;return r},getCName:function(){return this.cName}};